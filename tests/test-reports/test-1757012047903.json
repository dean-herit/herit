{
  "executionId": "test-1757012047903",
  "timestamp": "2025-09-04T18:54:07.907Z",
  "status": "failed",
  "overallSuccess": false,
  "results": {
    "backendTests": {
      "command": "npm run test:unit -- tests/api",
      "status": "failed",
      "output": "\n> herit@0.1.0 test:unit\n> NODE_ENV=test vitest run tests/api\n\n\n RUN  v3.2.4 /Users/dean/code/Herit\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Core Functionality > handles POST requests with valid personal info data\nReceived data: {\n  firstName: \u001b[32m'John'\u001b[39m,\n  lastName: \u001b[32m'Doe'\u001b[39m,\n  phoneNumber: \u001b[32m'+353871234567'\u001b[39m,\n  dateOfBirth: \u001b[32m'1990-01-01'\u001b[39m,\n  ppsNumber: \u001b[32m'1234567T'\u001b[39m,\n  addressLine1: \u001b[32m'123 Test Street'\u001b[39m,\n  addressLine2: \u001b[32m'Apt 4'\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  photo_url: \u001b[1mnull\u001b[22m,\n  photoMarkedForDeletion: \u001b[33mfalse\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Core Functionality > handles POST requests with valid personal info data\nCurrent user query result: {\n  id: \u001b[32m'4487fcc9-5257-40f2-a354-864ec88201e7'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012062554-b1bef668@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mtrue\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:54:22.603Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:54:22.603Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m'John Doe'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012062554-b1bef668@example.com'\u001b[39m,\n  phone: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m'1234567T'\u001b[39m,\n  address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n  address_line_2: \u001b[32m'Apt 4'\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mtrue\u001b[39m,\n  data: {\n    name: \u001b[32m'John Doe'\u001b[39m,\n    email: \u001b[32m'test-auth-1757012062554-b1bef668@example.com'\u001b[39m,\n    phone: \u001b[32m'+353871234567'\u001b[39m,\n    pps_number: \u001b[32m'1234567T'\u001b[39m,\n    address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n    address_line_2: \u001b[32m'Apt 4'\u001b[39m,\n    city: \u001b[32m'Dublin'\u001b[39m,\n    county: \u001b[32m'Dublin'\u001b[39m,\n    eircode: \u001b[32m'D01 X123'\u001b[39m,\n    country: \u001b[32m'Ireland'\u001b[39m,\n    date_of_birth: \u001b[32m'1990-01-01'\u001b[39m\n  }\n}\nOld data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nNew data: {\n  first_name: \u001b[32m'John'\u001b[39m,\n  last_name: \u001b[32m'Doe'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m'1234567T'\u001b[39m,\n  address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n  address_line_2: \u001b[32m'Apt 4'\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Core Functionality > handles POST requests with valid personal info data\nAbout to compare fields - oldData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nAbout to compare fields - newData: {\n  first_name: \u001b[32m'John'\u001b[39m,\n  last_name: \u001b[32m'Doe'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m'1234567T'\u001b[39m,\n  address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n  address_line_2: \u001b[32m'Apt 4'\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Error States > validates required personal info fields\nReceived data: {\n  firstName: \u001b[32m''\u001b[39m,\n  lastName: \u001b[32m''\u001b[39m,\n  phoneNumber: \u001b[32m'invalid-phone'\u001b[39m,\n  dateOfBirth: \u001b[32m'invalid-date'\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Error States > validates required personal info fields\nCurrent user query result: {\n  id: \u001b[32m'a5af8399-bff3-44d2-b6c8-b1f960bb41bd'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012067812-caaab4ae@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mtrue\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:54:27.961Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:54:27.961Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m''\u001b[39m,\n  email: \u001b[32m'test-auth-1757012067812-caaab4ae@example.com'\u001b[39m,\n  phone: \u001b[32m'invalid-phone'\u001b[39m,\n  date_of_birth: \u001b[32m'invalid-date'\u001b[39m,\n  pps_number: \u001b[32m''\u001b[39m,\n  address_line_1: \u001b[32m''\u001b[39m,\n  address_line_2: \u001b[32m''\u001b[39m,\n  city: \u001b[32m''\u001b[39m,\n  county: \u001b[32m''\u001b[39m,\n  eircode: \u001b[32m''\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mfalse\u001b[39m,\n  error: ZodError: [\n    {\n      \"origin\": \"string\",\n      \"code\": \"too_small\",\n      \"minimum\": 1,\n      \"inclusive\": true,\n      \"path\": [\n        \"name\"\n      ],\n      \"message\": \"Name is required\"\n    },\n    {\n      \"origin\": \"string\",\n      \"code\": \"invalid_format\",\n      \"format\": \"regex\",\n      \"pattern\": \"/^(\\\\+353|0)[1-9]\\\\d{7,9}$/\",\n      \"path\": [\n        \"phone\"\n      ],\n      \"message\": \"Invalid Irish phone number (e.g., +353 1 234 5678)\"\n    }\n  ]\n      at new ZodError \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/zod@4.0.17/node_modules/\u001b[4mzod\u001b[24m/v4/core/core.js:30:39\u001b[90m)\u001b[39m\n      at Module.<anonymous> \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/zod@4.0.17/node_modules/\u001b[4mzod\u001b[24m/v4/core/parse.js:40:20\u001b[90m)\u001b[39m\n      at _.inst.safeParse \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/zod@4.0.17/node_modules/\u001b[4mzod\u001b[24m/v4/classic/schemas.js:30:46\u001b[90m)\u001b[39m\n      at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/personal-info/route.ts:288:49\u001b[90m)\u001b[39m\n  \u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n      at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/personal-info/personal-info.test.ts:142:24\n      at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n}\n\n ❯ tests/api/beneficiaries/count/count.test.ts (10 tests | 1 failed) 26439ms\n   ✓ /api/beneficiaries/count > Core Functionality > handles GET requests with valid authentication  6134ms\n   ✓ /api/beneficiaries/count > Core Functionality > returns consistent response format  5949ms\n   ✓ /api/beneficiaries/count > Error States > returns proper error for unauthenticated requests 0ms\n   ✓ /api/beneficiaries/count > Security > requires valid JWT authentication 0ms\n   ✓ /api/beneficiaries/count > Security > validates JWT signature integrity 0ms\n   ✓ /api/beneficiaries/count > Performance > responds within acceptable time with real authentication  3425ms\n   ✓ /api/beneficiaries/count > Database Integrity > maintains data consistency with real database operations  2312ms\n   ✓ /api/beneficiaries/count > Integration Scenarios > integrates with authentication workflow  4155ms\n   ✓ /api/beneficiaries/count > Compliance > meets API standards with proper authentication  4458ms\n   × /api/beneficiaries/count > Edge Cases > handles edge cases appropriately 2ms\n     → expected 500 to be less than 500\n ❯ tests/api/will/status/status.test.ts (10 tests | 1 failed) 27980ms\n   ✓ /api/will/status > Core Functionality > handles GET requests with valid authentication  6157ms\n   × /api/will/status > Core Functionality > handles POST requests with valid data 5548ms\n     → expected 404 to be less than 300\n   ✓ /api/will/status > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/will/status > Security > requires valid JWT authentication 0ms\n   ✓ /api/will/status > Security > validates JWT signature integrity 0ms\n   ✓ /api/will/status > Performance > responds within acceptable time with real authentication  3762ms\n   ✓ /api/will/status > Database Integrity > maintains data consistency with real database operations  2375ms\n   ✓ /api/will/status > Integration Scenarios > integrates with authentication workflow  4825ms\n   ✓ /api/will/status > Compliance > meets API standards with proper authentication  3789ms\n   ✓ /api/will/status > Edge Cases > handles malformed JSON appropriately  1520ms\n ❯ tests/api/auth/create-test-user/create-test-user.test.ts (10 tests | 4 failed) 28405ms\n   ✓ /api/auth/create-test-user > Core Functionality > handles GET requests with valid authentication  5922ms\n   ✓ /api/auth/create-test-user > Core Functionality > handles POST requests with valid data  5576ms\n   × /api/auth/create-test-user > Error States > returns proper error for unauthenticated requests 355ms\n     → expected 200 to be greater than or equal to 400\n   × /api/auth/create-test-user > Security > requires valid JWT authentication 499ms\n     → expected 200 to be greater than or equal to 400\n   × /api/auth/create-test-user > Security > validates JWT signature integrity 481ms\n     → expected 200 to be greater than or equal to 400\n   ✓ /api/auth/create-test-user > Performance > responds within acceptable time with real authentication  2968ms\n   ✓ /api/auth/create-test-user > Database Integrity > maintains data consistency with real database operations  2154ms\n   ✓ /api/auth/create-test-user > Integration Scenarios > integrates with authentication workflow  4837ms\n   ✓ /api/auth/create-test-user > Compliance > meets API standards with proper authentication  3658ms\n   × /api/auth/create-test-user > Edge Cases > handles malformed JSON appropriately 1952ms\n     → expected 200 to be greater than or equal to 400\n ❯ tests/api/beneficiaries/beneficiaries.test.ts (10 tests | 2 failed) 28800ms\n   × /api/beneficiaries > Core Functionality > handles authenticated requests with real JWT tokens 7515ms\n     → Test timed out in 5000ms.\nIf this is a long-running test, pass a timeout value as the last argument or configure it globally with \"testTimeout\".\n   × /api/beneficiaries > Core Functionality > handles POST requests with valid data 3862ms\n     → expected 400 to be less than 300\n   ✓ /api/beneficiaries > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/beneficiaries > Security > requires valid JWT authentication 0ms\n   ✓ /api/beneficiaries > Security > validates JWT signature integrity 0ms\n   ✓ /api/beneficiaries > Performance > responds within acceptable time with real authentication  4295ms\n   ✓ /api/beneficiaries > Database Integrity > maintains data consistency with real database operations  2113ms\n   ✓ /api/beneficiaries > Integration Scenarios > integrates with authentication workflow  4825ms\n   ✓ /api/beneficiaries > Compliance > meets API standards with proper authentication  4294ms\n   ✓ /api/beneficiaries > Edge Cases > handles malformed requests appropriately  1892ms\n ❯ tests/api/auth/google/callback/callback.test.ts (10 tests | 6 failed) 29520ms\n   × /api/auth/google/callback > Core Functionality > handles GET requests with valid authentication 6121ms\n     → expected 307 to be less than 300\n   × /api/auth/google/callback > Core Functionality > handles POST requests with valid data 5278ms\n     → POST is not a function\n   × /api/auth/google/callback > Error States > returns proper error for unauthenticated requests 457ms\n     → expected 307 to be greater than or equal to 400\n   × /api/auth/google/callback > Security > requires valid JWT authentication 774ms\n     → expected 307 to be greater than or equal to 400\n   × /api/auth/google/callback > Security > validates JWT signature integrity 534ms\n     → expected 307 to be greater than or equal to 400\n   ✓ /api/auth/google/callback > Performance > responds within acceptable time with real authentication  2989ms\n   ✓ /api/auth/google/callback > Database Integrity > maintains data consistency with real database operations  3485ms\n   ✓ /api/auth/google/callback > Integration Scenarios > integrates with authentication workflow  4724ms\n   ✓ /api/auth/google/callback > Compliance > meets API standards with proper authentication  3148ms\n   × /api/auth/google/callback > Edge Cases > handles malformed JSON appropriately 2008ms\n     → POST is not a function\n ❯ tests/api/rules/rules.test.ts (10 tests | 1 failed) 31856ms\n   ✓ /api/rules > Core Functionality > handles GET requests with valid authentication  7289ms\n   × /api/rules > Core Functionality > handles POST requests with valid data 4322ms\n     → expected 400 to be less than 300\n   ✓ /api/rules > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/rules > Security > requires valid JWT authentication 0ms\n   ✓ /api/rules > Security > validates JWT signature integrity 0ms\n   ✓ /api/rules > Performance > responds within acceptable time with real authentication  4224ms\n   ✓ /api/rules > Database Integrity > maintains data consistency with real database operations  3737ms\n   ✓ /api/rules > Integration Scenarios > integrates with authentication workflow  5208ms\n   ✓ /api/rules > Compliance > meets API standards with proper authentication  3196ms\n   ✓ /api/rules > Edge Cases > handles malformed JSON appropriately  3876ms\nstdout | tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Core Functionality > handles POST requests with valid data\nOnboarding completion check: {\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  allStepsCompleted: \u001b[33mtrue\u001b[39m,\n  alreadyCompleted: \u001b[33mfalse\u001b[39m\n}\n\nstdout | tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Core Functionality > handles POST requests with valid data\nMarked onboarding complete for user 00943ec6-7995-4e7e-962c-9ea4cadb74bc\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Database Integrity > creates proper audit trail for personal info updates\nReceived data: {\n  firstName: \u001b[32m'Updated'\u001b[39m,\n  lastName: \u001b[32m'Name'\u001b[39m,\n  phoneNumber: \u001b[32m'+353871234567'\u001b[39m,\n  dateOfBirth: \u001b[32m'1990-01-01'\u001b[39m,\n  addressLine1: \u001b[32m'123 New Street'\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Database Integrity > creates proper audit trail for personal info updates\nCurrent user query result: {\n  id: \u001b[32m'2d7f42b7-b09d-4261-905d-4b3fc057b191'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012090194-183fa3a5@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mtrue\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:54:50.258Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:54:50.258Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m'Updated Name'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012090194-183fa3a5@example.com'\u001b[39m,\n  phone: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m''\u001b[39m,\n  address_line_1: \u001b[32m'123 New Street'\u001b[39m,\n  address_line_2: \u001b[32m''\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mtrue\u001b[39m,\n  data: {\n    name: \u001b[32m'Updated Name'\u001b[39m,\n    email: \u001b[32m'test-auth-1757012090194-183fa3a5@example.com'\u001b[39m,\n    phone: \u001b[32m'+353871234567'\u001b[39m,\n    pps_number: \u001b[32m''\u001b[39m,\n    address_line_1: \u001b[32m'123 New Street'\u001b[39m,\n    address_line_2: \u001b[32m''\u001b[39m,\n    city: \u001b[32m'Dublin'\u001b[39m,\n    county: \u001b[32m'Dublin'\u001b[39m,\n    eircode: \u001b[32m'D01 X123'\u001b[39m,\n    country: \u001b[32m'Ireland'\u001b[39m,\n    date_of_birth: \u001b[32m'1990-01-01'\u001b[39m\n  }\n}\nOld data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nNew data: {\n  first_name: \u001b[32m'Updated'\u001b[39m,\n  last_name: \u001b[32m'Name'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[32m'123 New Street'\u001b[39m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Database Integrity > creates proper audit trail for personal info updates\nAbout to compare fields - oldData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nAbout to compare fields - newData: {\n  first_name: \u001b[32m'Updated'\u001b[39m,\n  last_name: \u001b[32m'Name'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[32m'123 New Street'\u001b[39m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Integration Scenarios > handles complete onboarding workflow progression\nReceived data: {\n  firstName: \u001b[32m'Test'\u001b[39m,\n  lastName: \u001b[32m'User'\u001b[39m,\n  phoneNumber: \u001b[32m'+353871234567'\u001b[39m,\n  dateOfBirth: \u001b[32m'1990-01-01'\u001b[39m,\n  addressLine1: \u001b[32m'123 Test Street'\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Integration Scenarios > handles complete onboarding workflow progression\nCurrent user query result: {\n  id: \u001b[32m'f4e1088b-c7ef-416a-bca0-36e323a1d11e'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012097302-e4cbdb8e@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mfalse\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mfalse\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mfalse\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mfalse\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mfalse\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:54:57.343Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:54:57.343Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m'Test User'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012097302-e4cbdb8e@example.com'\u001b[39m,\n  phone: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m''\u001b[39m,\n  address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n  address_line_2: \u001b[32m''\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mtrue\u001b[39m,\n  data: {\n    name: \u001b[32m'Test User'\u001b[39m,\n    email: \u001b[32m'test-auth-1757012097302-e4cbdb8e@example.com'\u001b[39m,\n    phone: \u001b[32m'+353871234567'\u001b[39m,\n    pps_number: \u001b[32m''\u001b[39m,\n    address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n    address_line_2: \u001b[32m''\u001b[39m,\n    city: \u001b[32m'Dublin'\u001b[39m,\n    county: \u001b[32m'Dublin'\u001b[39m,\n    eircode: \u001b[32m'D01 X123'\u001b[39m,\n    country: \u001b[32m'Ireland'\u001b[39m,\n    date_of_birth: \u001b[32m'1990-01-01'\u001b[39m\n  }\n}\nOld data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mfalse\u001b[39m\n}\nNew data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\n ❯ tests/api/onboarding/signature/signature.test.ts (10 tests | 1 failed) 21365ms\n   ✓ /api/onboarding > Core Functionality > handles authenticated requests with real JWT tokens  3667ms\n   × /api/onboarding > Core Functionality > handles POST requests with valid data 3857ms\n     → expected 400 to be less than 300\n   ✓ /api/onboarding > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/onboarding > Security > requires valid JWT authentication 0ms\n   ✓ /api/onboarding > Security > validates JWT signature integrity 0ms\n   ✓ /api/onboarding > Performance > responds within acceptable time with real authentication  3050ms\n   ✓ /api/onboarding > Database Integrity > maintains data consistency with real database operations  3303ms\n   ✓ /api/onboarding > Integration Scenarios > integrates with authentication workflow  1743ms\n   ✓ /api/onboarding > Compliance > meets API standards with proper authentication  2708ms\n   ✓ /api/onboarding > Edge Cases > handles malformed requests appropriately  3034ms\nstdout | tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Edge Cases > handles malformed JSON appropriately\nOnboarding completion check: {\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  allStepsCompleted: \u001b[33mtrue\u001b[39m,\n  alreadyCompleted: \u001b[33mfalse\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Integration Scenarios > handles complete onboarding workflow progression\nAbout to compare fields - oldData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mfalse\u001b[39m\n}\nAbout to compare fields - newData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Edge Cases > handles malformed JSON appropriately\nMarked onboarding complete for user 6cc71ee3-5241-4912-9acb-3fddfd88c8e9\n\n ❯ tests/api/onboarding/verification/verification.test.ts (10 tests | 1 failed) 22501ms\n   ✓ /api/onboarding > Core Functionality > handles authenticated requests with real JWT tokens  5538ms\n   × /api/onboarding > Core Functionality > handles POST requests with valid data 2672ms\n     → expected 400 to be less than 300\n   ✓ /api/onboarding > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/onboarding > Security > requires valid JWT authentication 0ms\n   ✓ /api/onboarding > Security > validates JWT signature integrity 0ms\n   ✓ /api/onboarding > Performance > responds within acceptable time with real authentication  3127ms\n   ✓ /api/onboarding > Database Integrity > maintains data consistency with real database operations  2212ms\n   ✓ /api/onboarding > Integration Scenarios > integrates with authentication workflow  2230ms\n   ✓ /api/onboarding > Compliance > meets API standards with proper authentication  3530ms\n   ✓ /api/onboarding > Edge Cases > handles malformed requests appropriately  3189ms\n ❯ tests/api/debug/verification/verification.test.ts (10 tests | 3 failed) 23063ms\n   ✓ /api/debug/verification > Core Functionality > handles GET requests with valid authentication  6088ms\n   × /api/debug/verification > Core Functionality > handles POST requests with valid data 2847ms\n     → POST is not a function\n   × /api/debug/verification > Error States > returns proper error for unauthenticated requests 1ms\n     → POST is not a function\n   ✓ /api/debug/verification > Security > requires valid JWT authentication 0ms\n   ✓ /api/debug/verification > Security > validates JWT signature integrity 0ms\n   ✓ /api/debug/verification > Performance > responds within acceptable time with real authentication  2972ms\n   ✓ /api/debug/verification > Database Integrity > maintains data consistency with real database operations  2150ms\n   ✓ /api/debug/verification > Integration Scenarios > integrates with authentication workflow  2436ms\n   ✓ /api/debug/verification > Compliance > meets API standards with proper authentication  3482ms\n   × /api/debug/verification > Edge Cases > handles malformed JSON appropriately 3084ms\n     → POST is not a function\n ❯ tests/api/onboarding/complete/complete.test.ts (10 tests | 9 failed) 22310ms\n   × /api/onboarding/complete > Core Functionality > handles GET requests with valid authentication 5126ms\n     → GET is not a function\n   ✓ /api/onboarding/complete > Core Functionality > handles POST requests with valid data  3428ms\n   × /api/onboarding/complete > Error States > returns proper error for unauthenticated requests 1ms\n     → GET is not a function\n   × /api/onboarding/complete > Security > requires valid JWT authentication 0ms\n     → GET is not a function\n   × /api/onboarding/complete > Security > validates JWT signature integrity 0ms\n     → GET is not a function\n   × /api/onboarding/complete > Performance > responds within acceptable time with real authentication 2910ms\n     → GET is not a function\n   × /api/onboarding/complete > Database Integrity > maintains data consistency with real database operations 1733ms\n     → GET is not a function\n   × /api/onboarding/complete > Integration Scenarios > integrates with authentication workflow 2210ms\n     → GET is not a function\n   × /api/onboarding/complete > Compliance > meets API standards with proper authentication 2955ms\n     → GET is not a function\n   × /api/onboarding/complete > Edge Cases > handles malformed JSON appropriately 3943ms\n     → expected 200 to be greater than or equal to 400\n ❯ tests/api/rules/[id]/[id].test.ts (11 tests | 3 failed) 21963ms\n   × /api/rules/[id] > Core Functionality > handles GET requests with valid authentication 6080ms\n     → expected 500 to be less than 300\n   × /api/rules/[id] > Core Functionality > handles PUT requests with valid data 3502ms\n     → expected 500 to be less than 300\n   × /api/rules/[id] > Core Functionality > handles DELETE requests with authentication 2172ms\n     → expected 500 to be less than 500\n   ✓ /api/rules/[id] > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/rules/[id] > Security > requires valid JWT authentication 1ms\n   ✓ /api/rules/[id] > Security > validates JWT signature integrity 1ms\n   ✓ /api/rules/[id] > Performance > responds within acceptable time with real authentication  1135ms\n   ✓ /api/rules/[id] > Database Integrity > maintains data consistency with real database operations  2999ms\n   ✓ /api/rules/[id] > Integration Scenarios > integrates with authentication workflow  3260ms\n   ✓ /api/rules/[id] > Compliance > meets API standards with proper authentication  2810ms\n   ✓ /api/rules/[id] > Edge Cases > handles edge cases appropriately 1ms\n ❯ tests/api/auth/refresh/refresh.test.ts (10 tests | 1 failed) 20739ms\n   ✓ /api/auth > Core Functionality > handles authenticated requests with real JWT tokens  4659ms\n   × /api/auth > Core Functionality > handles POST requests with valid data 3005ms\n     → expected 401 to be less than 300\n   ✓ /api/auth > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/auth > Security > requires valid JWT authentication 0ms\n   ✓ /api/auth > Security > validates JWT signature integrity 0ms\n   ✓ /api/auth > Performance > responds within acceptable time with real authentication  2396ms\n   ✓ /api/auth > Database Integrity > maintains data consistency with real database operations  1069ms\n   ✓ /api/auth > Integration Scenarios > integrates with authentication workflow  2917ms\n   ✓ /api/auth > Compliance > meets API standards with proper authentication  3473ms\n   ✓ /api/auth > Edge Cases > handles malformed requests appropriately  3217ms\nstdout | tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Core Functionality > handles POST requests with valid data\n=== CONSENT SIGNATURE API HIT ===\n\nstdout | tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Core Functionality > handles POST requests with valid data\nSession check: {\n  isAuthenticated: \u001b[33mtrue\u001b[39m,\n  userId: \u001b[32m'd2d04a6f-725b-49c6-994f-ab3f4379a77c'\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Compliance > validates Irish compliance requirements\nReceived data: {\n  firstName: \u001b[32m'Seán'\u001b[39m,\n  lastName: \u001b[32m'Ó Súilleabháin'\u001b[39m,\n  phoneNumber: \u001b[32m'+353871234567'\u001b[39m,\n  dateOfBirth: \u001b[32m'1990-01-01'\u001b[39m,\n  ppsNumber: \u001b[32m'1234567T'\u001b[39m,\n  addressLine1: \u001b[32m'123 Sráid na hÉireann'\u001b[39m,\n  city: \u001b[32m'Baile Átha Cliath'\u001b[39m,\n  county: \u001b[32m'Átha Cliath'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Compliance > validates Irish compliance requirements\nCurrent user query result: {\n  id: \u001b[32m'af5748fc-4999-45f3-89a8-f0669ba57dbe'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012108602-caa7ad49@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mtrue\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:55:08.656Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:55:08.656Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m'Seán Ó Súilleabháin'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012108602-caa7ad49@example.com'\u001b[39m,\n  phone: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m'1234567T'\u001b[39m,\n  address_line_1: \u001b[32m'123 Sráid na hÉireann'\u001b[39m,\n  address_line_2: \u001b[32m''\u001b[39m,\n  city: \u001b[32m'Baile Átha Cliath'\u001b[39m,\n  county: \u001b[32m'Átha Cliath'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mfalse\u001b[39m,\n  error: ZodError: [\n    {\n      \"code\": \"invalid_value\",\n      \"values\": [\n        \"\",\n        \"Antrim\",\n        \"Armagh\",\n        \"Carlow\",\n        \"Cavan\",\n        \"Clare\",\n        \"Cork\",\n        \"Derry\",\n        \"Donegal\",\n        \"Down\",\n        \"Dublin\",\n        \"Fermanagh\",\n        \"Galway\",\n        \"Kerry\",\n        \"Kildare\",\n        \"Kilkenny\",\n        \"Laois\",\n        \"Leitrim\",\n        \"Limerick\",\n        \"Longford\",\n        \"Louth\",\n        \"Mayo\",\n        \"Meath\",\n        \"Monaghan\",\n        \"Offaly\",\n        \"Roscommon\",\n        \"Sligo\",\n        \"Tipperary\",\n        \"Tyrone\",\n        \"Waterford\",\n        \"Westmeath\",\n        \"Wexford\",\n        \"Wicklow\"\n      ],\n      \"path\": [\n        \"county\"\n      ],\n      \"message\": \"Invalid option: expected one of \\\"\\\"|\\\"Antrim\\\"|\\\"Armagh\\\"|\\\"Carlow\\\"|\\\"Cavan\\\"|\\\"Clare\\\"|\\\"Cork\\\"|\\\"Derry\\\"|\\\"Donegal\\\"|\\\"Down\\\"|\\\"Dublin\\\"|\\\"Fermanagh\\\"|\\\"Galway\\\"|\\\"Kerry\\\"|\\\"Kildare\\\"|\\\"Kilkenny\\\"|\\\"Laois\\\"|\\\"Leitrim\\\"|\\\"Limerick\\\"|\\\"Longford\\\"|\\\"Louth\\\"|\\\"Mayo\\\"|\\\"Meath\\\"|\\\"Monaghan\\\"|\\\"Offaly\\\"|\\\"Roscommon\\\"|\\\"Sligo\\\"|\\\"Tipperary\\\"|\\\"Tyrone\\\"|\\\"Waterford\\\"|\\\"Westmeath\\\"|\\\"Wexford\\\"|\\\"Wicklow\\\"\"\n    }\n  ]\n      at new ZodError \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/zod@4.0.17/node_modules/\u001b[4mzod\u001b[24m/v4/core/core.js:30:39\u001b[90m)\u001b[39m\n      at Module.<anonymous> \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/zod@4.0.17/node_modules/\u001b[4mzod\u001b[24m/v4/core/parse.js:40:20\u001b[90m)\u001b[39m\n      at _.inst.safeParse \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/zod@4.0.17/node_modules/\u001b[4mzod\u001b[24m/v4/classic/schemas.js:30:46\u001b[90m)\u001b[39m\n      at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/personal-info/route.ts:288:49\u001b[90m)\u001b[39m\n  \u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n      at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/personal-info/personal-info.test.ts:397:24\n      at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n}\n\nstdout | tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Edge Cases > handles malformed JSON appropriately\n=== CONSENT SIGNATURE API HIT ===\n\nstdout | tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Edge Cases > handles malformed JSON appropriately\nSession check: {\n  isAuthenticated: \u001b[33mtrue\u001b[39m,\n  userId: \u001b[32m'dba07477-b5e5-4c36-be90-c259cd47557c'\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Edge Cases > handles photo deletion workflow\nReceived data: {\n  firstName: \u001b[32m'Test'\u001b[39m,\n  lastName: \u001b[32m'User'\u001b[39m,\n  phoneNumber: \u001b[32m'+353871234567'\u001b[39m,\n  dateOfBirth: \u001b[32m'1990-01-01'\u001b[39m,\n  photoMarkedForDeletion: \u001b[33mtrue\u001b[39m,\n  photo_url: \u001b[1mnull\u001b[22m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Edge Cases > handles photo deletion workflow\nCurrent user query result: {\n  id: \u001b[32m'0313b7a3-bec1-42fb-9f26-96c01314b4c9'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012118839-2aac6d47@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mtrue\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:55:18.890Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:55:18.890Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m'Test User'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012118839-2aac6d47@example.com'\u001b[39m,\n  phone: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m''\u001b[39m,\n  address_line_1: \u001b[32m''\u001b[39m,\n  address_line_2: \u001b[32m''\u001b[39m,\n  city: \u001b[32m''\u001b[39m,\n  county: \u001b[32m''\u001b[39m,\n  eircode: \u001b[32m''\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mtrue\u001b[39m,\n  data: {\n    name: \u001b[32m'Test User'\u001b[39m,\n    email: \u001b[32m'test-auth-1757012118839-2aac6d47@example.com'\u001b[39m,\n    phone: \u001b[32m'+353871234567'\u001b[39m,\n    pps_number: \u001b[32m''\u001b[39m,\n    address_line_1: \u001b[32m''\u001b[39m,\n    address_line_2: \u001b[32m''\u001b[39m,\n    city: \u001b[32m''\u001b[39m,\n    county: \u001b[32m''\u001b[39m,\n    eircode: \u001b[32m''\u001b[39m,\n    country: \u001b[32m'Ireland'\u001b[39m,\n    date_of_birth: \u001b[32m'1990-01-01'\u001b[39m\n  }\n}\nOld data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nNew data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\n ❯ tests/api/onboarding/consent-signature/consent-signature.test.ts (10 tests | 9 failed) 21879ms\n   × /api/onboarding/consent-signature > Core Functionality > handles GET requests with valid authentication 4203ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Core Functionality > handles POST requests with valid data 2211ms\n     → expected 400 to be less than 300\n   × /api/onboarding/consent-signature > Error States > returns proper error for unauthenticated requests 0ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Security > requires valid JWT authentication 0ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Security > validates JWT signature integrity 0ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Performance > responds within acceptable time with real authentication 1270ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Database Integrity > maintains data consistency with real database operations 2376ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Integration Scenarios > integrates with authentication workflow 2807ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Compliance > meets API standards with proper authentication 3678ms\n     → GET is not a function\n   ✓ /api/onboarding/consent-signature > Edge Cases > handles malformed JSON appropriately  5330ms\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Edge Cases > handles photo deletion workflow\nAbout to compare fields - oldData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nAbout to compare fields - newData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\n ❯ tests/api/auth/logout/logout.test.ts (10 tests | 9 failed) 21189ms\n   × /api/auth/logout > Core Functionality > handles GET requests with valid authentication 3394ms\n     → GET is not a function\n   ✓ /api/auth/logout > Core Functionality > handles POST requests with valid data  1133ms\n   × /api/auth/logout > Error States > returns proper error for unauthenticated requests 1ms\n     → GET is not a function\n   × /api/auth/logout > Security > requires valid JWT authentication 0ms\n     → GET is not a function\n   × /api/auth/logout > Security > validates JWT signature integrity 0ms\n     → GET is not a function\n   × /api/auth/logout > Performance > responds within acceptable time with real authentication 2423ms\n     → GET is not a function\n   × /api/auth/logout > Database Integrity > maintains data consistency with real database operations 3034ms\n     → GET is not a function\n   × /api/auth/logout > Integration Scenarios > integrates with authentication workflow 3801ms\n     → GET is not a function\n   × /api/auth/logout > Compliance > meets API standards with proper authentication 4073ms\n     → GET is not a function\n   × /api/auth/logout > Edge Cases > handles malformed JSON appropriately 3328ms\n     → expected 200 to be greater than or equal to 400\n ❯ tests/api/audit/log-event/log-event.test.ts (10 tests | 9 failed) 22642ms\n   × /api/audit/log-event > Core Functionality > handles GET requests with valid authentication 2329ms\n     → GET is not a function\n   ✓ /api/audit/log-event > Core Functionality > handles POST requests with valid data  1898ms\n   × /api/audit/log-event > Error States > returns proper error for unauthenticated requests 0ms\n     → GET is not a function\n   × /api/audit/log-event > Security > requires valid JWT authentication 0ms\n     → GET is not a function\n   × /api/audit/log-event > Security > validates JWT signature integrity 0ms\n     → GET is not a function\n   × /api/audit/log-event > Performance > responds within acceptable time with real authentication 2248ms\n     → GET is not a function\n   × /api/audit/log-event > Database Integrity > maintains data consistency with real database operations 3407ms\n     → GET is not a function\n   × /api/audit/log-event > Integration Scenarios > integrates with authentication workflow 3808ms\n     → GET is not a function\n   × /api/audit/log-event > Compliance > meets API standards with proper authentication 5331ms\n     → GET is not a function\n   × /api/audit/log-event > Edge Cases > handles malformed JSON appropriately 3617ms\n     → expected 200 to be greater than or equal to 400\n ❯ tests/api/auth/google/google.test.ts (10 tests | 6 failed) 22750ms\n   × /api/auth/google > Core Functionality > handles GET requests with valid authentication 2810ms\n     → expected 307 to be less than 300\n   × /api/auth/google > Core Functionality > handles POST requests with valid data 1323ms\n     → POST is not a function\n   × /api/auth/google > Error States > returns proper error for unauthenticated requests 1ms\n     → expected 307 to be greater than or equal to 400\n   × /api/auth/google > Security > requires valid JWT authentication 0ms\n     → expected 307 to be greater than or equal to 400\n   × /api/auth/google > Security > validates JWT signature integrity 0ms\n     → expected 307 to be greater than or equal to 400\n   ✓ /api/auth/google > Performance > responds within acceptable time with real authentication  2011ms\n   ✓ /api/auth/google > Database Integrity > maintains data consistency with real database operations  3365ms\n   ✓ /api/auth/google > Integration Scenarios > integrates with authentication workflow  3678ms\n   ✓ /api/auth/google > Compliance > meets API standards with proper authentication  5330ms\n   × /api/auth/google > Edge Cases > handles malformed JSON appropriately 4229ms\n     → POST is not a function\n ❯ tests/api/onboarding/photo/photo.test.ts (10 tests | 1 failed) 25210ms\n   ✓ /api/onboarding > Core Functionality > handles authenticated requests with real JWT tokens  3266ms\n   × /api/onboarding > Core Functionality > handles POST requests with valid data 1716ms\n     → expected 500 to be less than 300\n   ✓ /api/onboarding > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/onboarding > Security > requires valid JWT authentication 0ms\n   ✓ /api/onboarding > Security > validates JWT signature integrity 0ms\n   ✓ /api/onboarding > Performance > responds within acceptable time with real authentication  3225ms\n   ✓ /api/onboarding > Database Integrity > maintains data consistency with real database operations  3170ms\n   ✓ /api/onboarding > Integration Scenarios > integrates with authentication workflow  5385ms\n   ✓ /api/onboarding > Compliance > meets API standards with proper authentication  4172ms\n   ✓ /api/onboarding > Edge Cases > handles malformed requests appropriately  4274ms\n ❯ tests/api/beneficiaries/photo/photo.test.ts (10 tests | 9 failed) 24864ms\n   × /api/beneficiaries/photo > Core Functionality > handles GET requests with valid authentication 2770ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Core Functionality > handles POST requests with valid data 2249ms\n     → expected 500 to be less than 300\n   × /api/beneficiaries/photo > Error States > returns proper error for unauthenticated requests 1ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Security > requires valid JWT authentication 0ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Security > validates JWT signature integrity 0ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Performance > responds within acceptable time with real authentication 3408ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Database Integrity > maintains data consistency with real database operations 3806ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Integration Scenarios > integrates with authentication workflow 5331ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Compliance > meets API standards with proper authentication 3617ms\n     → GET is not a function\n   ✓ /api/beneficiaries/photo > Edge Cases > handles malformed JSON appropriately  3679ms\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Token Management > maintains session consistency across operations\nReceived data: {\n  firstName: \u001b[32m'Test'\u001b[39m,\n  lastName: \u001b[32m'User'\u001b[39m,\n  phoneNumber: \u001b[32m'+353871234567'\u001b[39m,\n  dateOfBirth: \u001b[32m'1990-01-01'\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Token Management > maintains session consistency across operations\nCurrent user query result: {\n  id: \u001b[32m'e4bed0aa-54f8-4e2c-b945-ee1d5f805d49'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012134027-f419a17e@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mtrue\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:55:34.064Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:55:34.064Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m'Test User'\u001b[39m,\n  email: \u001b[32m'test-auth-1757012134027-f419a17e@example.com'\u001b[39m,\n  phone: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m''\u001b[39m,\n  address_line_1: \u001b[32m''\u001b[39m,\n  address_line_2: \u001b[32m''\u001b[39m,\n  city: \u001b[32m''\u001b[39m,\n  county: \u001b[32m''\u001b[39m,\n  eircode: \u001b[32m''\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mtrue\u001b[39m,\n  data: {\n    name: \u001b[32m'Test User'\u001b[39m,\n    email: \u001b[32m'test-auth-1757012134027-f419a17e@example.com'\u001b[39m,\n    phone: \u001b[32m'+353871234567'\u001b[39m,\n    pps_number: \u001b[32m''\u001b[39m,\n    address_line_1: \u001b[32m''\u001b[39m,\n    address_line_2: \u001b[32m''\u001b[39m,\n    city: \u001b[32m''\u001b[39m,\n    county: \u001b[32m''\u001b[39m,\n    eircode: \u001b[32m''\u001b[39m,\n    country: \u001b[32m'Ireland'\u001b[39m,\n    date_of_birth: \u001b[32m'1990-01-01'\u001b[39m\n  }\n}\nOld data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nNew data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Token Management > maintains session consistency across operations\nAbout to compare fields - oldData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nAbout to compare fields - newData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\n ❯ tests/api/onboarding/personal-info/personal-info.test.ts (25 tests | 4 failed) 88382ms\n   ✓ /api/onboarding/personal-info > Core Functionality > handles GET requests with valid authentication  6587ms\n   ✓ /api/onboarding/personal-info > Core Functionality > returns completion status correctly  5683ms\n   ✓ /api/onboarding/personal-info > Core Functionality > handles POST requests with valid personal info data  4907ms\n   ✓ /api/onboarding/personal-info > Error States > returns 401 for unauthenticated GET requests 101ms\n   ✓ /api/onboarding/personal-info > Error States > returns 401 for unauthenticated POST requests 250ms\n   ✓ /api/onboarding/personal-info > Error States > validates required personal info fields  5210ms\n   ✓ /api/onboarding/personal-info > Security > requires valid JWT authentication for GET  1408ms\n   ✓ /api/onboarding/personal-info > Security > requires valid JWT authentication for POST  659ms\n   ✓ /api/onboarding/personal-info > Security > validates JWT signature integrity  1041ms\n   × /api/onboarding/personal-info > Security > prevents OAuth email tampering 444ms\n     → Failed query: insert into \"app_users\" (\"id\", \"email\", \"password_hash\", \"first_name\", \"last_name\", \"phone_number\", \"date_of_birth\", \"pps_number\", \"profile_photo_url\", \"address_line_1\", \"address_line_2\", \"city\", \"county\", \"eircode\", \"onboarding_status\", \"onboarding_current_step\", \"onboarding_completed_at\", \"personal_info_completed\", \"personal_info_completed_at\", \"signature_completed\", \"signature_completed_at\", \"legal_consent_completed\", \"legal_consent_completed_at\", \"legal_consents\", \"verification_completed\", \"verification_completed_at\", \"verification_session_id\", \"verification_status\", \"auth_provider\", \"auth_provider_id\", \"created_at\", \"updated_at\") values ($1, $2, default, $3, $4, default, default, default, default, default, default, default, default, default, default, default, default, $5, default, $6, default, $7, default, default, $8, default, default, $9, default, default, default, default) returning \"id\", \"email\", \"password_hash\", \"first_name\", \"last_name\", \"phone_number\", \"date_of_birth\", \"pps_number\", \"profile_photo_url\", \"address_line_1\", \"address_line_2\", \"city\", \"county\", \"eircode\", \"onboarding_status\", \"onboarding_current_step\", \"onboarding_completed_at\", \"personal_info_completed\", \"personal_info_completed_at\", \"signature_completed\", \"signature_completed_at\", \"legal_consent_completed\", \"legal_consent_completed_at\", \"legal_consents\", \"verification_completed\", \"verification_completed_at\", \"verification_session_id\", \"verification_status\", \"onboarding_completed\", \"auth_provider\", \"auth_provider_id\", \"created_at\", \"updated_at\"\nparams: 3c028810-7976-46d8-adef-2edd5bc9e828,original@example.com,Test,User,true,true,true,true,verified\n   ✓ /api/onboarding/personal-info > Performance > responds within acceptable time with real authentication  2265ms\n   ✓ /api/onboarding/personal-info > Performance > handles concurrent requests efficiently  6370ms\n   ✓ /api/onboarding/personal-info > Database Integrity > maintains user data consistency with real database operations  4984ms\n   ✓ /api/onboarding/personal-info > Database Integrity > creates proper audit trail for personal info updates  3057ms\n   × /api/onboarding/personal-info > Integration Scenarios > integrates with OAuth data source tracking 4051ms\n     → expected false to be true // Object.is equality\n   ✓ /api/onboarding/personal-info > Integration Scenarios > handles complete onboarding workflow progression  5736ms\n   ✓ /api/onboarding/personal-info > Compliance > meets API standards with proper authentication  3124ms\n   ✓ /api/onboarding/personal-info > Compliance > follows REST API conventions  2440ms\n   × /api/onboarding/personal-info > Compliance > validates Irish compliance requirements 4648ms\n     → expected 400 to be less than 300\n   ✓ /api/onboarding/personal-info > Edge Cases > handles requests with malformed JSON  5589ms\n   ✓ /api/onboarding/personal-info > Edge Cases > handles photo deletion workflow  7517ms\n   × /api/onboarding/personal-info > Edge Cases > handles users with incomplete profile data 2987ms\n     → expected 'Test' to be '' // Object.is equality\n   ✓ /api/onboarding/personal-info > Token Management > validates access token structure and claims  3830ms\n   ✓ /api/onboarding/personal-info > Token Management > handles expired tokens appropriately  854ms\n   ✓ /api/onboarding/personal-info > Token Management > maintains session consistency across operations  4638ms\n ❯ tests/api/debug-user/debug-user.test.ts (10 tests | 4 failed) 25008ms\n   × /api/debug-user > Core Functionality > handles GET requests with valid authentication 5627ms\n     → expected 400 to be less than 300\n   × /api/debug-user > Core Functionality > handles POST requests with valid data 1870ms\n     → POST is not a function\n   × /api/debug-user > Error States > returns proper error for unauthenticated requests 1ms\n     → POST is not a function\n   ✓ /api/debug-user > Security > requires valid JWT authentication 0ms\n   ✓ /api/debug-user > Security > validates JWT signature integrity 0ms\n   ✓ /api/debug-user > Performance > responds within acceptable time with real authentication  3800ms\n   ✓ /api/debug-user > Database Integrity > maintains data consistency with real database operations  2194ms\n   ✓ /api/debug-user > Integration Scenarios > integrates with authentication workflow  2787ms\n   ✓ /api/debug-user > Compliance > meets API standards with proper authentication  3789ms\n   × /api/debug-user > Edge Cases > handles malformed JSON appropriately 4937ms\n     → POST is not a function\n ❯ tests/api/documents/requirements/[type]/[type].test.ts (10 tests | 3 failed) 19457ms\n   ✓ /api/documents/requirements/[type] > Core Functionality > handles GET requests with valid authentication  2716ms\n   ✓ /api/documents/requirements/[type] > Core Functionality > returns consistent response format  2891ms\n   × /api/documents/requirements/[type] > Error States > returns proper error for unauthenticated requests 2ms\n     → expected 200 to be greater than or equal to 400\n   × /api/documents/requirements/[type] > Security > requires valid JWT authentication 0ms\n     → expected 200 to be greater than or equal to 400\n   × /api/documents/requirements/[type] > Security > validates JWT signature integrity 1ms\n     → expected 200 to be greater than or equal to 400\n   ✓ /api/documents/requirements/[type] > Performance > responds within acceptable time with real authentication  2078ms\n   ✓ /api/documents/requirements/[type] > Database Integrity > maintains data consistency with real database operations  3225ms\n   ✓ /api/documents/requirements/[type] > Integration Scenarios > integrates with authentication workflow  3825ms\n   ✓ /api/documents/requirements/[type] > Compliance > meets API standards with proper authentication  4715ms\n   ✓ /api/documents/requirements/[type] > Edge Cases > handles edge cases appropriately 1ms\n ❯ tests/api/auth/register/register.test.ts (10 tests | 1 failed) 24258ms\n   ✓ /api/auth > Core Functionality > handles authenticated requests with real JWT tokens  4460ms\n   × /api/auth > Core Functionality > handles POST requests with valid data 2639ms\n     → expected 400 to be less than 300\n   ✓ /api/auth > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/auth > Security > requires valid JWT authentication 0ms\n   ✓ /api/auth > Security > validates JWT signature integrity 1ms\n   ✓ /api/auth > Performance > responds within acceptable time with real authentication  3030ms\n   ✓ /api/auth > Database Integrity > maintains data consistency with real database operations  2028ms\n   ✓ /api/auth > Integration Scenarios > integrates with authentication workflow  3249ms\n   ✓ /api/auth > Compliance > meets API standards with proper authentication  4051ms\n   ✓ /api/auth > Edge Cases > handles malformed requests appropriately  4798ms\n ❯ tests/api/rules/validate-allocation/validate-allocation.test.ts (10 tests | 9 failed) 23261ms\n   × /api/rules/validate-allocation > Core Functionality > handles GET requests with valid authentication 3384ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Core Functionality > handles POST requests with valid data 2967ms\n     → expected 400 to be less than 300\n   × /api/rules/validate-allocation > Error States > returns proper error for unauthenticated requests 1ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Security > requires valid JWT authentication 0ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Security > validates JWT signature integrity 0ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Performance > responds within acceptable time with real authentication 2357ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Database Integrity > maintains data consistency with real database operations 2204ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Integration Scenarios > integrates with authentication workflow 3684ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Compliance > meets API standards with proper authentication 3816ms\n     → GET is not a function\n   ✓ /api/rules/validate-allocation > Edge Cases > handles malformed JSON appropriately  4846ms\n ❯ tests/api/auth/login/login.test.ts (10 tests | 1 failed) 23458ms\n   ✓ /api/auth > Core Functionality > handles authenticated requests with real JWT tokens  3597ms\n   × /api/auth > Core Functionality > handles POST requests with valid data 2951ms\n     → expected 400 to be less than 300\n   ✓ /api/auth > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/auth > Security > requires valid JWT authentication 0ms\n   ✓ /api/auth > Security > validates JWT signature integrity 0ms\n   ✓ /api/auth > Performance > responds within acceptable time with real authentication  2354ms\n   ✓ /api/auth > Database Integrity > maintains data consistency with real database operations  2207ms\n   ✓ /api/auth > Integration Scenarios > integrates with authentication workflow  3684ms\n   ✓ /api/auth > Compliance > meets API standards with proper authentication  3818ms\n   ✓ /api/auth > Edge Cases > handles malformed requests appropriately  4843ms\n ❯ tests/api/assets/categories/categories.test.ts (10 tests | 1 failed) 21389ms\n   ✓ /api/assets/categories > Core Functionality > handles GET requests with valid authentication  3824ms\n   ✓ /api/assets/categories > Core Functionality > returns consistent response format  2082ms\n   ✓ /api/assets/categories > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/assets/categories > Security > requires valid JWT authentication 0ms\n   ✓ /api/assets/categories > Security > validates JWT signature integrity 0ms\n   ✓ /api/assets/categories > Performance > responds within acceptable time with real authentication  2999ms\n   ✓ /api/assets/categories > Database Integrity > maintains data consistency with real database operations  3604ms\n   ✓ /api/assets/categories > Integration Scenarios > integrates with authentication workflow  5525ms\n   ✓ /api/assets/categories > Compliance > meets API standards with proper authentication  3349ms\n   × /api/assets/categories > Edge Cases > handles edge cases appropriately 3ms\n     → expected 500 to be less than 500\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Core Functionality > handles POST requests with valid authentication\nOnboarding step 0 completed for user 063e703c-3401-45b9-b0f4-4fed84b6fc87\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Core Functionality > saves step completion data correctly\nOnboarding step 1 completed for user ee95b549-920e-4872-91a6-42a88e6bb449\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Core Functionality > handles final step completion\nOnboarding step 3 completed for user f5b287f6-5bbc-4006-8757-7d03c0bae6c2\n\n ❯ tests/api/stripe/webhook/webhook.test.ts (9 tests | 1 failed) 20983ms\n   × /api/stripe/webhook > Core Functionality > handles POST requests with valid data 5111ms\n     → expected 400 to be less than 300\n   ✓ /api/stripe/webhook > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/stripe/webhook > Security > requires valid JWT authentication 0ms\n   ✓ /api/stripe/webhook > Security > validates JWT signature integrity 0ms\n   ✓ /api/stripe/webhook > Performance > responds within acceptable time with real authentication  4515ms\n   ✓ /api/stripe/webhook > Database Integrity > maintains data consistency with real database operations  2501ms\n   ✓ /api/stripe/webhook > Integration Scenarios > integrates with authentication workflow  3016ms\n   ✓ /api/stripe/webhook > Compliance > meets API standards with proper authentication  3423ms\n   ✓ /api/stripe/webhook > Edge Cases > handles malformed JSON appropriately  2413ms\nstderr | tests/api/beneficiaries/beneficiaries.test.ts > /api/beneficiaries > Edge Cases > handles malformed requests appropriately\nError creating beneficiary: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/beneficiaries/route.ts:107:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/beneficiaries/beneficiaries.test.ts:188:26\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/rules.test.ts > /api/rules > Edge Cases > handles malformed JSON appropriately\nError creating rule: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/route.ts:130:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/rules.test.ts:148:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Core Functionality > handles GET requests with valid authentication\nError fetching rule: DrizzleQueryError: Failed query: select \"id\", \"user_id\", \"name\", \"description\", \"rule_definition\", \"priority\", \"is_active\", \"created_at\", \"updated_at\" from \"inheritance_rules\" where (\"inheritance_rules\".\"id\" = $1 and \"inheritance_rules\".\"user_id\" = $2)\nparams: test-id-123,\n    at PostgresJsPreparedQuery.queryWithCache \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/drizzle-orm@0.44.4_@types+pg@8.15.5_postgres@3.4.7/node_modules/\u001b[4msrc\u001b[24m/pg-core/session.ts:73:11\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/drizzle-orm@0.44.4_@types+pg@8.15.5_postgres@3.4.7/node_modules/\u001b[4msrc\u001b[24m/postgres-js/session.ts:58:17\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:54:20\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:27:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20 {\n  query: \u001b[32m'select \"id\", \"user_id\", \"name\", \"description\", \"rule_definition\", \"priority\", \"is_active\", \"created_at\", \"updated_at\" from \"inheritance_rules\" where (\"inheritance_rules\".\"id\" = $1 and \"inheritance_rules\".\"user_id\" = $2)'\u001b[39m,\n  params: [ \u001b[32m'test-id-123'\u001b[39m, \u001b[90mundefined\u001b[39m ],\n  cause: Error: UNDEFINED_VALUE: Undefined values are not allowed\n      at handleValue \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/types.js:83:20\u001b[90m)\u001b[39m\n      at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/connection.js:225:38\n      at Array.forEach (<anonymous>)\n      at build \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/connection.js:225:25\u001b[90m)\u001b[39m\n      at Object.execute \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/connection.js:167:7\u001b[90m)\u001b[39m\n      at go \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/index.js:345:14\u001b[90m)\u001b[39m\n      at Query.handler \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/index.js:334:14\u001b[90m)\u001b[39m\n      at Query.handle \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/query.js:140:65\u001b[90m)\u001b[39m\n  \u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m {\n    code: \u001b[32m'UNDEFINED_VALUE'\u001b[39m\n  }\n}\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Core Functionality > handles PUT requests with valid data\nError updating rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.PUT \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:108:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:43:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Core Functionality > handles DELETE requests with authentication\nError deleting rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.DELETE \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:267:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:52:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Error States > returns proper error for unauthenticated requests\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:64:27\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Security > requires valid JWT authentication\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:74:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Security > validates JWT signature integrity\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:87:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Performance > responds within acceptable time with real authentication\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:99:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Database Integrity > maintains data consistency with real database operations\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:112:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/onboarding/signature/signature.test.ts > /api/onboarding > Edge Cases > handles malformed requests appropriately\nSignature save error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/signature/route.ts:74:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/signature/signature.test.ts:188:26\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Integration Scenarios > integrates with authentication workflow\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:123:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Compliance > meets API standards with proper authentication\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:134:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Core Functionality > handles POST requests with valid data\nAudit logging error: DrizzleQueryError: Failed query: insert into \"audit_events\" (\"id\", \"user_id\", \"event_type\", \"event_action\", \"resource_type\", \"resource_id\", \"event_data\", \"old_data\", \"new_data\", \"ip_address\", \"user_agent\", \"session_id\", \"event_time\") values (default, $1, default, default, default, default, $2, default, default, $3, $4, default, default)\nparams: 470d4f65-81aa-4889-b24d-1a672e7cc948,{},unknown,unknown\n    at PostgresJsPreparedQuery.queryWithCache \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/drizzle-orm@0.44.4_@types+pg@8.15.5_postgres@3.4.7/node_modules/\u001b[4msrc\u001b[24m/pg-core/session.ts:73:11\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/audit/log-event/route.ts:33:5\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/audit/log-event/log-event.test.ts:42:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20 {\n  query: \u001b[32m'insert into \"audit_events\" (\"id\", \"user_id\", \"event_type\", \"event_action\", \"resource_type\", \"resource_id\", \"event_data\", \"old_data\", \"new_data\", \"ip_address\", \"user_agent\", \"session_id\", \"event_time\") values (default, $1, default, default, default, default, $2, default, default, $3, $4, default, default)'\u001b[39m,\n  params: [\n    \u001b[32m'470d4f65-81aa-4889-b24d-1a672e7cc948'\u001b[39m,\n    \u001b[32m'{}'\u001b[39m,\n    \u001b[32m'unknown'\u001b[39m,\n    \u001b[32m'unknown'\u001b[39m\n  ],\n  cause: PostgresError: null value in column \"event_type\" of relation \"audit_events\" violates not-null constraint\n      at ErrorResponse \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/connection.js:794:26\u001b[90m)\u001b[39m\n      at handle \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/connection.js:480:6\u001b[90m)\u001b[39m\n      at Socket.data \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/connection.js:315:9\u001b[90m)\u001b[39m\n  \u001b[90m    at Socket.emit (node:events:507:28)\u001b[39m\n  \u001b[90m    at addChunk (node:internal/streams/readable:559:12)\u001b[39m\n  \u001b[90m    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\u001b[39m\n  \u001b[90m    at Socket.Readable.push (node:internal/streams/readable:390:5)\u001b[39m\n  \u001b[90m    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)\u001b[39m {\n    severity_local: \u001b[32m'ERROR'\u001b[39m,\n    severity: \u001b[32m'ERROR'\u001b[39m,\n    code: \u001b[32m'23502'\u001b[39m,\n    detail: \u001b[32m'Failing row contains (50900061-f734-438e-8c89-68daa873bef3, 470d4f65-81aa-4889-b24d-1a672e7cc948, null, null, null, null, {}, null, null, unknown, unknown, null, 2025-09-04 18:55:06.087897).'\u001b[39m,\n    schema_name: \u001b[32m'public'\u001b[39m,\n    table_name: \u001b[32m'audit_events'\u001b[39m,\n    column_name: \u001b[32m'event_type'\u001b[39m,\n    file: \u001b[32m'execMain.c'\u001b[39m,\n    line: \u001b[32m'1982'\u001b[39m,\n    routine: \u001b[32m'ExecConstraints'\u001b[39m\n  }\n}\n\nstderr | tests/api/onboarding/photo/photo.test.ts > /api/onboarding > Core Functionality > handles POST requests with valid data\nPhoto upload error: DOMException [InvalidStateError]: Failed to construct FormData object: The \"content-type\" header is neither \"application/x-www-form-urlencoded\" nor \"multipart/form-data\".\n    at NextRequest.formData \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:473:9\u001b[90m)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/photo/route.ts:18:36\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/photo/photo.test.ts:52:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Core Functionality > handles POST requests with valid data\nPhoto upload error: DOMException [InvalidStateError]: Failed to construct FormData object: The \"content-type\" header is neither \"application/x-www-form-urlencoded\" nor \"multipart/form-data\".\n    at NextRequest.formData \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:473:9\u001b[90m)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/beneficiaries/photo/route.ts:18:36\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/beneficiaries/photo/photo.test.ts:42:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Edge Cases > handles requests with malformed JSON\nPersonal info save error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/personal-info/route.ts:184:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/personal-info/personal-info.test.ts:412:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Edge Cases > handles malformed JSON appropriately\nConsent signature save error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/consent-signature/route.ts:27:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/consent-signature/consent-signature.test.ts:148:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Edge Cases > handles malformed JSON appropriately\nAudit logging error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/audit/log-event/route.ts:10:7\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/audit/log-event/log-event.test.ts:148:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/onboarding/photo/photo.test.ts > /api/onboarding > Edge Cases > handles malformed requests appropriately\nPhoto upload error: DOMException [InvalidStateError]: Failed to construct FormData object: The \"content-type\" header is neither \"application/x-www-form-urlencoded\" nor \"multipart/form-data\".\n    at NextRequest.formData \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:473:9\u001b[90m)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/photo/route.ts:18:36\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/photo/photo.test.ts:188:26\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Edge Cases > handles malformed JSON appropriately\nPhoto upload error: DOMException [InvalidStateError]: Failed to construct FormData object: The \"content-type\" header is neither \"application/x-www-form-urlencoded\" nor \"multipart/form-data\".\n    at NextRequest.formData \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:473:9\u001b[90m)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/beneficiaries/photo/route.ts:18:36\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/beneficiaries/photo/photo.test.ts:148:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/auth/register/register.test.ts > /api/auth > Edge Cases > handles malformed requests appropriately\nRegistration error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at registerHandler \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/auth/register/route.ts:11:54\u001b[90m)\u001b[39m\n    at Module.<anonymous> \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/lib/rate-limit.ts:111:22\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/auth/register/register.test.ts:188:26\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/auth/login/login.test.ts > /api/auth > Edge Cases > handles malformed requests appropriately\nLogin error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at loginHandler \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/auth/login/route.ts:11:33\u001b[90m)\u001b[39m\n    at Module.<anonymous> \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/lib/rate-limit.ts:111:22\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/auth/login/login.test.ts:188:26\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/validate-allocation/validate-allocation.test.ts > /api/rules/validate-allocation > Edge Cases > handles malformed JSON appropriately\nError validating allocation: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/validate-allocation/route.ts:45:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/validate-allocation/validate-allocation.test.ts:148:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/assets/categories/categories.test.ts > /api/assets/categories > Edge Cases > handles edge cases appropriately\nAsset categories fetch error: TypeError: Cannot read properties of undefined (reading 'isAuthenticated')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/assets/categories/route.ts:16:18\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/assets/categories/categories.test.ts:134:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\n",
      "startTime": 1757012047907,
      "endTime": 1757012167901,
      "duration": 119994,
      "error": "Process exited with code 143",
      "individualTests": {
        "total": 275,
        "passed": 175,
        "failed": 100,
        "skipped": 0,
        "passRate": 64,
        "progress": 90
      }
    },
    "linting": {
      "command": "npm run lint",
      "status": "pending",
      "output": "",
      "startTime": 1757012047907
    },
    "build": {
      "command": "npm run typecheck",
      "status": "pending",
      "output": "",
      "startTime": 1757012047907
    },
    "componentTestsAccessibility": {
      "command": "npm run test:ct:accessibility",
      "status": "failed",
      "output": "\n> herit@0.1.0 test:ct:accessibility\n> cypress run --component --config video=false,screenshotOnRunFailure=false --quiet --spec 'app/_lib/**/*.cy.tsx,app/components/auth/**/*.cy.tsx,app/components/ui/**/*.cy.tsx,app/components/layout/**/*.cy.tsx,app/components/branding/**/*.cy.tsx,app/components/pages/**/*.cy.tsx,app/components/examples/**/*.cy.tsx'\n\n16 assets\n970 modules\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m in 867 ms\n16 assets\n970 modules\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m in 45 ms\n\n\n  QueryProvider\n    Core Functionality\n      ✓ renders without crashing (54ms)\n      ✓ provides QueryClient context to children (32ms)\n    Error Handling\n      ✓ handles component errors gracefully (27ms)\n    Accessibility\n      ✓ provides accessible context (28ms)\n    Responsive Design\n      ✓ works at different screen sizes (30ms)\n    Integration\n      ✓ works within parent containers (30ms)\n\n\n  6 passing (239ms)\n\n17 assets\n969 modules\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m in 205 ms\n\n\n  Error Component\n    Core Functionality\n      ✓ renders error message and try again button (51ms)\n      (Attempt 1 of 3) calls reset callback when try again button is clicked\n      (Attempt 2 of 3) calls reset callback when try again button is clicked\n      1) calls reset callback when try again button is clicked\n      ✓ logs error to console on component mount (27ms)\n      ✓ handles different error types and messages (30ms)\n    Error States\n      ✓ handles missing error object gracefully (28ms)\n      (Attempt 1 of 3) handles missing reset callback gracefully\n      (Attempt 2 of 3) handles missing reset callback gracefully\n      2) handles missing reset callback gracefully\n      ✓ handles complex error objects (31ms)\n      (Attempt 1 of 3) handles multiple rapid error occurrences\n      (Attempt 2 of 3) handles multiple rapid error occurrences\n      3) handles multiple rapid error occurrences\n    Accessibility\n      (Attempt 1 of 3) should be accessible\n      (Attempt 2 of 3) should be accessible\n      4) should be accessible\n      (Attempt 1 of 3) supports keyboard navigation\n      (Attempt 2 of 3) supports keyboard navigation\n      5) supports keyboard navigation\n      (Attempt 1 of 3) has proper semantic structure\n      (Attempt 2 of 3) has proper semantic structure\n      6) has proper semantic structure\n      ✓ provides clear user guidance (32ms)\n    Performance\n      (Attempt 1 of 3) should render quickly\n      (Attempt 2 of 3) should render quickly\n      7) should render quickly\n      (Attempt 1 of 3) handles large error objects efficiently\n      (Attempt 2 of 3) handles large error objects efficiently\n      8) handles large error objects efficiently\n      (Attempt 1 of 3) handles rapid reset button clicks efficiently\n      (Attempt 2 of 3) handles rapid reset button clicks efficiently\n      9) handles rapid reset button clicks efficiently\n    Responsive Design\n      ✓ should work on all screen sizes (48ms)\n      ✓ maintains proper spacing on mobile (34ms)\n      ✓ handles long error messages on narrow screens (32ms)\n    Integration Scenarios\n      (Attempt 1 of 3) integrates with error boundary workflow\n      (Attempt 2 of 3) integrates with error boundary workflow\n      10) integrates with error boundary workflow\n      ✓ handles error reporting service integration (13ms)\n      (Attempt 1 of 3) works within Next.js app router context\n      (Attempt 2 of 3) works within Next.js app router context\n      11) works within Next.js app router context\n    Edge Cases\n      ✓ handles circular reference errors (35ms)\n      ✓ handles error objects without message (30ms)\n      ✓ handles non-Error objects passed as error (32ms)\n      ✓ handles rapid component remounting (45ms)\n    Security\n      (Attempt 1 of 3) safely handles malicious error messages\n      (Attempt 2 of 3) safely handles malicious error messages\n      12) safely handles malicious error messages\n      ✓ safely handles error properties with XSS attempts (29ms)\n      (Attempt 1 of 3) prevents reset callback injection attacks\n      (Attempt 2 of 3) prevents reset callback injection attacks\n      13) prevents reset callback injection attacks\n      (Attempt 1 of 3) handles error stack traces safely\n      (Attempt 2 of 3) handles error stack traces safely\n      14) handles error stack traces safely\n    Quality Checks\n      (Attempt 1 of 3) should meet performance standards\n      (Attempt 2 of 3) should meet performance standards\n      15) should meet performance standards\n      (Attempt 1 of 3) should be accessible\n      (Attempt 2 of 3) should be accessible\n      16) should be accessible\n      ✓ should handle responsive layouts (19ms)\n\n\n  16 passing (1m)\n  16 failing\n\n  1) Error Component\n       Core Functionality\n         calls reset callback when try again button is clicked:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n  From Your Spec Code:\n      at Object.proxyGetter [as get] (http://localhost:8080/__cypress/runner/cypress_runner.js:80426:22)\n      at exists (http://localhost:8080/__cypress/runner/cypress_runner.js:146470:26)\n      at elExists (http://localhost:8080/__cypress/runner/cypress_runner.js:146485:10)\n      at ensureExistence (http://localhost:8080/__cypress/runner/cypress_runner.js:146666:22)\n      at onFailFn (http://localhost:8080/__cypress/runner/cypress_runner.js:146695:53)\n\n  2) Error Component\n       Error States\n         handles missing reset callback gracefully:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n  3) Error Component\n       Error States\n         handles multiple rapid error occurrences:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n  4) Error Component\n       Accessibility\n         should be accessible:\n     CypressError: `cy.within()` can only be called on a single element. Your subject contained 2 elements. Narrow down your subject to a single element (using `.first()`, for example) before calling `.within()`.\n\nTo run `.within()` over multiple subjects, use `.each()`.\n\n  `cy.get('div').each($div => {`\n  `  cy.wrap($div).within(() => { ... })`\n  `})`\n\nhttps://on.cypress.io/within\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:135977:72)\n      at __WEBPACK_DEFAULT_EXPORT__ (http://localhost:8080/__cypress/runner/cypress_runner.js:133819:10)\n      at Context.within (http://localhost:8080/__cypress/runner/cypress_runner.js:135970:67)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n  From Your Spec Code:\n      at Object.proxyGetter [as get] (http://localhost:8080/__cypress/runner/cypress_runner.js:80426:22)\n      at exists (http://localhost:8080/__cypress/runner/cypress_runner.js:146470:26)\n      at elExists (http://localhost:8080/__cypress/runner/cypress_runner.js:146485:10)\n      at ensureExistence (http://localhost:8080/__cypress/runner/cypress_runner.js:146666:22)\n      at onFailFn (http://localhost:8080/__cypress/runner/cypress_runner.js:146695:53)\n\n  5) Error Component\n       Accessibility\n         supports keyboard navigation:\n     CypressError: `cy.focus()` can only be called on a single element. Your subject contained 2 elements.\n\nhttps://on.cypress.io/focus\n      at Context.focus (http://localhost:8080/__cypress/runner/cypress_runner.js:114705:70)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n  From Your Spec Code:\n      at Object.proxyGetter [as get] (http://localhost:8080/__cypress/runner/cypress_runner.js:80426:22)\n      at exists (http://localhost:8080/__cypress/runner/cypress_runner.js:146470:26)\n      at elExists (http://localhost:8080/__cypress/runner/cypress_runner.js:146485:10)\n      at ensureExistence (http://localhost:8080/__cypress/runner/cypress_runner.js:146666:22)\n      at onFailFn (http://localhost:8080/__cypress/runner/cypress_runner.js:146695:53)\n\n  6) Error Component\n       Accessibility\n         has proper semantic structure:\n\n      Timed out retrying after 4000ms\n      + expected - actual\n\n      -'DIV'\n      +'BUTTON'\n      \n      at Context.eval (webpack-internal:///./app/_lib/error.cy.tsx:344:46)\n\n  7) Error Component\n       Performance\n         should render quickly:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"button\"]`, but never found it.\n      at Object.measureRenderTime (webpack-internal:///./cypress/support/test-utils.ts:272:31)\n      at Context.eval (webpack-internal:///./app/_lib/error.cy.tsx:374:80)\n\n  8) Error Component\n       Performance\n         handles large error objects efficiently:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"button\"]`, but never found it.\n      at Object.measureRenderTime (webpack-internal:///./cypress/support/test-utils.ts:272:31)\n      at Context.eval (webpack-internal:///./app/_lib/error.cy.tsx:400:80)\n\n  9) Error Component\n       Performance\n         handles rapid reset button clicks efficiently:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n  10) Error Component\n       Integration Scenarios\n         integrates with error boundary workflow:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n  11) Error Component\n       Integration Scenarios\n         works within Next.js app router context:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n  12) Error Component\n       Security\n         safely handles malicious error messages:\n     AssertionError: Timed out retrying after 4000ms: Expected [ <script>, 3 more... ] not to exist in the DOM, but it was continuously found.\n      at Context.eval (webpack-internal:///./app/_lib/error.cy.tsx:835:30)\n\n  13) Error Component\n       Security\n         prevents reset callback injection attacks:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n  14) Error Component\n       Security\n         handles error stack traces safely:\n     AssertionError: Timed out retrying after 4000ms: Expected [ <script>, 3 more... ] not to exist in the DOM, but it was continuously found.\n      at Context.eval (webpack-internal:///./app/_lib/error.cy.tsx:905:30)\n\n  15) Error Component\n       Quality Checks\n         should meet performance standards:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"button\"]`, but never found it.\n      at Object.measureRenderTime (webpack-internal:///./cypress/support/test-utils.ts:272:31)\n      at Context.eval (webpack-internal:///./app/_lib/error.cy.tsx:913:80)\n\n  16) Error Component\n       Quality Checks\n         should be accessible:\n     CypressError: `cy.within()` can only be called on a single element. Your subject contained 2 elements. Narrow down your subject to a single element (using `.first()`, for example) before calling `.within()`.\n\nTo run `.within()` over multiple subjects, use `.each()`.\n\n  `cy.get('div').each($div => {`\n  `  cy.wrap($div).within(() => { ... })`\n  `})`\n\nhttps://on.cypress.io/within\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:135977:72)\n      at __WEBPACK_DEFAULT_EXPORT__ (http://localhost:8080/__cypress/runner/cypress_runner.js:133819:10)\n      at Context.within (http://localhost:8080/__cypress/runner/cypress_runner.js:135970:67)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n\n\n16 assets\n968 modules\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m in 288 ms\n\n\n  providers\n    Core Functionality\n      (Attempt 1 of 3) renders without crashing\n      (Attempt 2 of 3) renders without crashing\n      1) renders without crashing\n      (Attempt 1 of 3) displays content correctly\n      (Attempt 2 of 3) displays content correctly\n      2) displays content correctly\n      (Attempt 1 of 3) handles props correctly\n      (Attempt 2 of 3) handles props correctly\n      3) handles props correctly\n    Accessibility\n      (Attempt 1 of 3) meets basic accessibility standards\n      (Attempt 2 of 3) meets basic accessibility standards\n      4) meets basic accessibility standards\n      (Attempt 1 of 3) supports keyboard navigation\n      (Attempt 2 of 3) supports keyboard navigation\n      5) supports keyboard navigation\n    Responsive Design\n      (Attempt 1 of 3) adapts to different screen sizes\n      (Attempt 2 of 3) adapts to different screen sizes\n      6) adapts to different screen sizes\n    Integration\n      (Attempt 1 of 3) works within parent containers\n      (Attempt 2 of 3) works within parent containers\n      7) works within parent containers\n\n\n  0 passing (1m)\n  7 failing\n\n  1) providers\n       Core Functionality\n         renders without crashing:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"providers\"], [data-testid=\"providers\"]`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:38:76)\n\n  2) providers\n       Core Functionality\n         displays content correctly:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"providers\"], [data-testid=\"providers\"]`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:58:76)\n\n  3) providers\n       Core Functionality\n         handles props correctly:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"providers\"], [data-testid=\"providers\"]`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:81:76)\n\n  4) providers\n       Accessibility\n         meets basic accessibility standards:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `button, input, [tabindex], [role=\"button\"]`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:104:16)\n\n  5) providers\n       Accessibility\n         supports keyboard navigation:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `focused`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:134:26)\n\n  6) providers\n       Responsive Design\n         adapts to different screen sizes:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"providers\"], [data-testid=\"providers\"]`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:164:76)\n\n  7) providers\n       Integration\n         works within parent containers:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"providers\"], [data-testid=\"providers\"]`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:203:80)\n      at withinFn (http://localhost:8080/__cypress/runner/cypress_runner.js:135903:8)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:135984:16)\n      at __WEBPACK_DEFAULT_EXPORT__ (http://localhost:8080/__cypress/runner/cypress_runner.js:133819:10)\n      at Context.within (http://localhost:8080/__cypress/runner/cypress_runner.js:135970:67)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n\n\n\n15 assets\n969 modules\n\n\u001b[1m\u001b[31mERROR\u001b[39m\u001b[22m in \u001b[1m./app/components/auth/AuthErrorHandler.cy.tsx\u001b[39m\u001b[22m\nModule build failed (from ./node_modules/.pnpm/next@15.4.6_@babel+core@7.28.3_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js):\nError:   \u001b[31mx\u001b[0m Expected '}', got '<eof>'\n     ,-[\u001b[36;1;4m/Users/dean/code/Herit/app/components/auth/AuthErrorHandler.cy.tsx\u001b[0m:131:1]\n \u001b[2m128\u001b[0m |       });\n \u001b[2m129\u001b[0m |     });\n \u001b[2m130\u001b[0m |   });\n \u001b[2m131\u001b[0m | });\n     : \u001b[35;1m ^\u001b[0m\n     `----\n  \u001b[31mx\u001b[0m Unexpected eof\n     ,-[\u001b[36;1;4m/Users/dean/code/Herit/app/components/auth/AuthErrorHandler.cy.tsx\u001b[0m:131:5]\n \u001b[2m129\u001b[0m |     });\n \u001b[2m130\u001b[0m |   });\n \u001b[2m131\u001b[0m | });\n     `----\n\n\nCaused by:\n    Syntax Error\n\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled with \u001b[1m\u001b[31m1 error\u001b[39m\u001b[22m in 1068 ms\n\n\n  (Attempt 1 of 2) An uncaught error was detected outside of a test\n  1) An uncaught error was detected outside of a test\n\n  0 passing (62ms)\n  1 failing\n\n  1) An uncaught error was detected outside of a test:\n     Error: The following error originated from your test code, not from Cypress.\n\n  > Module build failed (from ./node_modules/.pnpm/next@15.4.6_@babel+core@7.28.3_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js):\nError:   x Expected '}', got '<eof>'\n     ,-[/Users/dean/code/Herit/app/components/auth/AuthErrorHandler.cy.tsx:131:1]\n 128 |       });\n 129 |     });\n 130 |   });\n 131 | });\n     :  ^\n     `----\n  x Unexpected eof\n     ,-[/Users/dean/code/Herit/app/components/auth/AuthErrorHandler.cy.tsx:131:5]\n 129 |     });\n 130 |   });\n 131 | });\n     `----\n\nCaused by:\n    Syntax Error\n\nWhen Cypress detects uncaught errors originating from your test code it will automatically fail the current test.\n\nCypress could not associate this error to any specific test.\n\nWe dynamically generated a new test to display this failure.\n      at ./app/components/auth/AuthErrorHandler.cy.tsx (http://localhost:8080/__cypress/src/spec-0.js:17:7)\n      at __webpack_require__ (http://localhost:8080/__cypress/src/webpack.js:25:43)\n      at __webpack_require__.t (http://localhost:8080/__cypress/src/webpack.js:97:38)\n\n\n\n18 assets\n1269 modules\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m in 1412 ms\n\n\n  0 passing (0ms)\n\n18 assets\n1269 modules\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m in 666 ms\n\n\n  EmailSignupForm\n    Core Functionality\n      ✓ renders without crashing (123ms)\n      (Attempt 1 of 3) displays content correctly\nwrite EPIPE\nError: write EPIPE\n    at afterWriteDispatched (node:internal/stream_base_commons:159:15)\n    at writeGeneric (node:internal/stream_base_commons:150:3)\n    at Socket._writeGeneric (node:net:971:11)\n    at Socket._write (node:net:983:8)\n    at writeOrBuffer (node:internal/streams/writable:572:12)\n    at _write (node:internal/streams/writable:501:10)\n    at Writable.write (node:internal/streams/writable:510:10)\n    at execSync (node:child_process:967:20)\n    at node:electron/js2c/node_init:2:17313\n    at <embedded>:1245:1069694\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)\n[66855:0904/195408.370428:ERROR:electron/shell/common/node_bindings.cc:411] Most NODE_OPTIONs are not supported in packaged apps. See documentation for more details.\n[66855:0904/195408.370446:ERROR:electron/shell/common/node_bindings.cc:411] Most NODE_OPTIONs are not supported in packaged apps. See documentation for more details.\n\nDevTools listening on ws://127.0.0.1:61383/devtools/browser/c9534f5e-f2fb-4948-afb5-29e22218c79f\n<<<CYPRESS.STDERR.START>>><i> [webpack-dev-server] Project is running at:\n<i> [webpack-dev-server] Loopback: \u001b[36mhttp://127.0.0.1:8080/\u001b[39m\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-server] Content not from webpack is served from '\u001b[36m/Users/dean/code/Herit/public\u001b[39m' directory\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-middleware] wait until bundle finished: /__cypress/src/webpack.js\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-middleware] wait until bundle finished: /__cypress/src/index.html\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-middleware] wait until bundle finished: /__cypress/src/index.html\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-middleware] wait until bundle finished: /__cypress/src/cypress-support-file.js\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-middleware] wait until bundle finished: /__cypress/src/index.html\n<<<CYPRESS.STDERR.END>>>",
      "startTime": 1757012047907,
      "endTime": 1757012228711,
      "duration": 180804,
      "error": "Process was terminated (SIGTERM) due to timeout",
      "individualTests": {
        "total": 6,
        "passed": 6,
        "failed": 0,
        "skipped": 0,
        "passRate": 100,
        "progress": 100
      }
    },
    "componentTestsCore": {
      "command": "npm run test:ct:core",
      "status": "failed",
      "output": "\n> herit@0.1.0 test:ct:core\n> cypress run --component --config video=false,screenshotOnRunFailure=false --quiet --spec 'app/components/beneficiaries/**/*.cy.tsx,app/components/documents/**/*.cy.tsx,app/components/shared/**/*.cy.tsx,app/components/dashboard/**/*.cy.tsx,app/(dashboard)/**/*.cy.tsx,app/(auth)/**/*.cy.tsx,components/**/*.cy.tsx'\n\nYour configFile threw an error from: cypress.config.js\n\nWe stopped running your tests because your config file crashed.\n\nError: listen EADDRINUSE: address already in use 127.0.0.1:8080\n    at Server.setupListenHandle [as _listen2] (node:net:1937:16)\n    at listenInCluster (node:net:1994:12)\n    at node:net:2203:7\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)\n[66856:0904/195408.391215:ERROR:electron/shell/common/node_bindings.cc:411] Most NODE_OPTIONs are not supported in packaged apps. See documentation for more details.\n[66856:0904/195408.391228:ERROR:electron/shell/common/node_bindings.cc:411] Most NODE_OPTIONs are not supported in packaged apps. See documentation for more details.\n\nDevTools listening on ws://127.0.0.1:61384/devtools/browser/04418fd1-498f-454e-81df-2575f27c00f6\n",
      "startTime": 1757012047908,
      "endTime": 1757012050964,
      "duration": 3056,
      "error": "Process exited with code 1",
      "individualTests": {
        "total": 1,
        "passed": 0,
        "failed": 1,
        "skipped": 0,
        "passRate": 0,
        "progress": 25
      }
    }
  },
  "individualTests": {
    "total": 282,
    "passed": 181,
    "failed": 101,
    "skipped": 0,
    "passRate": 64,
    "progress": 77
  }
}