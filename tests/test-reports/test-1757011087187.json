{
  "executionId": "test-1757011087187",
  "timestamp": "2025-09-04T18:38:07.189Z",
  "status": "failed",
  "overallSuccess": false,
  "results": {
    "backendTests": {
      "command": "npm run test:unit -- tests/api",
      "status": "failed",
      "output": "\n> herit@0.1.0 test:unit\n> NODE_ENV=test vitest run tests/api\n\n\n RUN  v3.2.4 /Users/dean/code/Herit\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Core Functionality > handles POST requests with valid personal info data\nReceived data: {\n  firstName: \u001b[32m'John'\u001b[39m,\n  lastName: \u001b[32m'Doe'\u001b[39m,\n  phoneNumber: \u001b[32m'+353871234567'\u001b[39m,\n  dateOfBirth: \u001b[32m'1990-01-01'\u001b[39m,\n  ppsNumber: \u001b[32m'1234567T'\u001b[39m,\n  addressLine1: \u001b[32m'123 Test Street'\u001b[39m,\n  addressLine2: \u001b[32m'Apt 4'\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  photo_url: \u001b[1mnull\u001b[22m,\n  photoMarkedForDeletion: \u001b[33mfalse\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Core Functionality > handles POST requests with valid personal info data\nCurrent user query result: {\n  id: \u001b[32m'420bab72-3761-46f2-bc29-5bf45260bd64'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011090812-561caeb8@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mtrue\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:38:10.866Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:38:10.866Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m'John Doe'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011090812-561caeb8@example.com'\u001b[39m,\n  phone: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m'1234567T'\u001b[39m,\n  address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n  address_line_2: \u001b[32m'Apt 4'\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mtrue\u001b[39m,\n  data: {\n    name: \u001b[32m'John Doe'\u001b[39m,\n    email: \u001b[32m'test-auth-1757011090812-561caeb8@example.com'\u001b[39m,\n    phone: \u001b[32m'+353871234567'\u001b[39m,\n    pps_number: \u001b[32m'1234567T'\u001b[39m,\n    address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n    address_line_2: \u001b[32m'Apt 4'\u001b[39m,\n    city: \u001b[32m'Dublin'\u001b[39m,\n    county: \u001b[32m'Dublin'\u001b[39m,\n    eircode: \u001b[32m'D01 X123'\u001b[39m,\n    country: \u001b[32m'Ireland'\u001b[39m,\n    date_of_birth: \u001b[32m'1990-01-01'\u001b[39m\n  }\n}\nOld data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nNew data: {\n  first_name: \u001b[32m'John'\u001b[39m,\n  last_name: \u001b[32m'Doe'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m'1234567T'\u001b[39m,\n  address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n  address_line_2: \u001b[32m'Apt 4'\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Core Functionality > handles POST requests with valid personal info data\nAbout to compare fields - oldData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nAbout to compare fields - newData: {\n  first_name: \u001b[32m'John'\u001b[39m,\n  last_name: \u001b[32m'Doe'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m'1234567T'\u001b[39m,\n  address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n  address_line_2: \u001b[32m'Apt 4'\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Error States > validates required personal info fields\nReceived data: {\n  firstName: \u001b[32m''\u001b[39m,\n  lastName: \u001b[32m''\u001b[39m,\n  phoneNumber: \u001b[32m'invalid-phone'\u001b[39m,\n  dateOfBirth: \u001b[32m'invalid-date'\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Error States > validates required personal info fields\nCurrent user query result: {\n  id: \u001b[32m'078bc6d1-cbe9-42c5-b2be-5e8851b95132'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011091731-6b41632e@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mtrue\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:38:11.778Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:38:11.778Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m''\u001b[39m,\n  email: \u001b[32m'test-auth-1757011091731-6b41632e@example.com'\u001b[39m,\n  phone: \u001b[32m'invalid-phone'\u001b[39m,\n  date_of_birth: \u001b[32m'invalid-date'\u001b[39m,\n  pps_number: \u001b[32m''\u001b[39m,\n  address_line_1: \u001b[32m''\u001b[39m,\n  address_line_2: \u001b[32m''\u001b[39m,\n  city: \u001b[32m''\u001b[39m,\n  county: \u001b[32m''\u001b[39m,\n  eircode: \u001b[32m''\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mfalse\u001b[39m,\n  error: ZodError: [\n    {\n      \"origin\": \"string\",\n      \"code\": \"too_small\",\n      \"minimum\": 1,\n      \"inclusive\": true,\n      \"path\": [\n        \"name\"\n      ],\n      \"message\": \"Name is required\"\n    },\n    {\n      \"origin\": \"string\",\n      \"code\": \"invalid_format\",\n      \"format\": \"regex\",\n      \"pattern\": \"/^(\\\\+353|0)[1-9]\\\\d{7,9}$/\",\n      \"path\": [\n        \"phone\"\n      ],\n      \"message\": \"Invalid Irish phone number (e.g., +353 1 234 5678)\"\n    }\n  ]\n      at new ZodError \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/zod@4.0.17/node_modules/\u001b[4mzod\u001b[24m/v4/core/core.js:30:39\u001b[90m)\u001b[39m\n      at Module.<anonymous> \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/zod@4.0.17/node_modules/\u001b[4mzod\u001b[24m/v4/core/parse.js:40:20\u001b[90m)\u001b[39m\n      at _.inst.safeParse \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/zod@4.0.17/node_modules/\u001b[4mzod\u001b[24m/v4/classic/schemas.js:30:46\u001b[90m)\u001b[39m\n      at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/personal-info/route.ts:288:49\u001b[90m)\u001b[39m\n  \u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n      at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/personal-info/personal-info.test.ts:142:24\n      at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n}\n\n ❯ tests/api/onboarding/signature/signature.test.ts (10 tests | 1 failed) 3250ms\n   ✓ /api/onboarding > Core Functionality > handles authenticated requests with real JWT tokens  700ms\n   × /api/onboarding > Core Functionality > handles POST requests with valid data 375ms\n     → expected 400 to be less than 300\n   ✓ /api/onboarding > Error States > returns proper error for unauthenticated requests 2ms\n   ✓ /api/onboarding > Security > requires valid JWT authentication 1ms\n   ✓ /api/onboarding > Security > validates JWT signature integrity 1ms\n   ✓ /api/onboarding > Performance > responds within acceptable time with real authentication  461ms\n   ✓ /api/onboarding > Database Integrity > maintains data consistency with real database operations  416ms\n   ✓ /api/onboarding > Integration Scenarios > integrates with authentication workflow  463ms\n   ✓ /api/onboarding > Compliance > meets API standards with proper authentication  440ms\n   ✓ /api/onboarding > Edge Cases > handles malformed requests appropriately  389ms\n ❯ tests/api/auth/create-test-user/create-test-user.test.ts (10 tests | 4 failed) 3473ms\n   ✓ /api/auth/create-test-user > Core Functionality > handles GET requests with valid authentication  619ms\n   ✓ /api/auth/create-test-user > Core Functionality > handles POST requests with valid data  444ms\n   × /api/auth/create-test-user > Error States > returns proper error for unauthenticated requests 66ms\n     → expected 200 to be greater than or equal to 400\n   × /api/auth/create-test-user > Security > requires valid JWT authentication 47ms\n     → expected 200 to be greater than or equal to 400\n   × /api/auth/create-test-user > Security > validates JWT signature integrity 55ms\n     → expected 200 to be greater than or equal to 400\n   ✓ /api/auth/create-test-user > Performance > responds within acceptable time with real authentication  437ms\n   ✓ /api/auth/create-test-user > Database Integrity > maintains data consistency with real database operations  471ms\n   ✓ /api/auth/create-test-user > Integration Scenarios > integrates with authentication workflow  446ms\n   ✓ /api/auth/create-test-user > Compliance > meets API standards with proper authentication  442ms\n   × /api/auth/create-test-user > Edge Cases > handles malformed JSON appropriately 440ms\n     → expected 200 to be greater than or equal to 400\n ❯ tests/api/auth/google/callback/callback.test.ts (10 tests | 6 failed) 3636ms\n   × /api/auth/google/callback > Core Functionality > handles GET requests with valid authentication 722ms\n     → expected 307 to be less than 300\n   × /api/auth/google/callback > Core Functionality > handles POST requests with valid data 397ms\n     → POST is not a function\n   × /api/auth/google/callback > Error States > returns proper error for unauthenticated requests 88ms\n     → expected 307 to be greater than or equal to 400\n   × /api/auth/google/callback > Security > requires valid JWT authentication 83ms\n     → expected 307 to be greater than or equal to 400\n   × /api/auth/google/callback > Security > validates JWT signature integrity 110ms\n     → expected 307 to be greater than or equal to 400\n   ✓ /api/auth/google/callback > Performance > responds within acceptable time with real authentication  440ms\n   ✓ /api/auth/google/callback > Database Integrity > maintains data consistency with real database operations  500ms\n   ✓ /api/auth/google/callback > Integration Scenarios > integrates with authentication workflow  446ms\n   ✓ /api/auth/google/callback > Compliance > meets API standards with proper authentication  465ms\n   × /api/auth/google/callback > Edge Cases > handles malformed JSON appropriately 381ms\n     → POST is not a function\n ❯ tests/api/will/status/status.test.ts (10 tests | 1 failed) 3703ms\n   ✓ /api/will/status > Core Functionality > handles GET requests with valid authentication  771ms\n   × /api/will/status > Core Functionality > handles POST requests with valid data 505ms\n     → expected 404 to be less than 300\n   ✓ /api/will/status > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/will/status > Security > requires valid JWT authentication 1ms\n   ✓ /api/will/status > Security > validates JWT signature integrity 0ms\n   ✓ /api/will/status > Performance > responds within acceptable time with real authentication  517ms\n   ✓ /api/will/status > Database Integrity > maintains data consistency with real database operations  525ms\n   ✓ /api/will/status > Integration Scenarios > integrates with authentication workflow  498ms\n   ✓ /api/will/status > Compliance > meets API standards with proper authentication  505ms\n   ✓ /api/will/status > Edge Cases > handles malformed JSON appropriately  377ms\n ❯ tests/api/beneficiaries/beneficiaries.test.ts (10 tests | 1 failed) 3688ms\n   ✓ /api/beneficiaries > Core Functionality > handles authenticated requests with real JWT tokens  860ms\n   × /api/beneficiaries > Core Functionality > handles POST requests with valid data 409ms\n     → expected 400 to be less than 300\n   ✓ /api/beneficiaries > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/beneficiaries > Security > requires valid JWT authentication 0ms\n   ✓ /api/beneficiaries > Security > validates JWT signature integrity 0ms\n   ✓ /api/beneficiaries > Performance > responds within acceptable time with real authentication  507ms\n   ✓ /api/beneficiaries > Database Integrity > maintains data consistency with real database operations  533ms\n   ✓ /api/beneficiaries > Integration Scenarios > integrates with authentication workflow  497ms\n   ✓ /api/beneficiaries > Compliance > meets API standards with proper authentication  496ms\n   ✓ /api/beneficiaries > Edge Cases > handles malformed requests appropriately  381ms\n ❯ tests/api/rules/rules.test.ts (10 tests | 1 failed) 4004ms\n   ✓ /api/rules > Core Functionality > handles GET requests with valid authentication  769ms\n   × /api/rules > Core Functionality > handles POST requests with valid data 459ms\n     → expected 400 to be less than 300\n   ✓ /api/rules > Error States > returns proper error for unauthenticated requests 2ms\n   ✓ /api/rules > Security > requires valid JWT authentication 1ms\n   ✓ /api/rules > Security > validates JWT signature integrity 1ms\n   ✓ /api/rules > Performance > responds within acceptable time with real authentication  587ms\n   ✓ /api/rules > Database Integrity > maintains data consistency with real database operations  600ms\n   ✓ /api/rules > Integration Scenarios > integrates with authentication workflow  579ms\n   ✓ /api/rules > Compliance > meets API standards with proper authentication  572ms\n   ✓ /api/rules > Edge Cases > handles malformed JSON appropriately  430ms\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Database Integrity > creates proper audit trail for personal info updates\nReceived data: {\n  firstName: \u001b[32m'Updated'\u001b[39m,\n  lastName: \u001b[32m'Name'\u001b[39m,\n  phoneNumber: \u001b[32m'+353871234567'\u001b[39m,\n  dateOfBirth: \u001b[32m'1990-01-01'\u001b[39m,\n  addressLine1: \u001b[32m'123 New Street'\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Database Integrity > creates proper audit trail for personal info updates\nCurrent user query result: {\n  id: \u001b[32m'6b78b429-2418-47ac-84df-4de4f2faf5e8'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011094233-1d5c241a@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mtrue\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:38:14.277Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:38:14.277Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m'Updated Name'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011094233-1d5c241a@example.com'\u001b[39m,\n  phone: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m''\u001b[39m,\n  address_line_1: \u001b[32m'123 New Street'\u001b[39m,\n  address_line_2: \u001b[32m''\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mtrue\u001b[39m,\n  data: {\n    name: \u001b[32m'Updated Name'\u001b[39m,\n    email: \u001b[32m'test-auth-1757011094233-1d5c241a@example.com'\u001b[39m,\n    phone: \u001b[32m'+353871234567'\u001b[39m,\n    pps_number: \u001b[32m''\u001b[39m,\n    address_line_1: \u001b[32m'123 New Street'\u001b[39m,\n    address_line_2: \u001b[32m''\u001b[39m,\n    city: \u001b[32m'Dublin'\u001b[39m,\n    county: \u001b[32m'Dublin'\u001b[39m,\n    eircode: \u001b[32m'D01 X123'\u001b[39m,\n    country: \u001b[32m'Ireland'\u001b[39m,\n    date_of_birth: \u001b[32m'1990-01-01'\u001b[39m\n  }\n}\nOld data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nNew data: {\n  first_name: \u001b[32m'Updated'\u001b[39m,\n  last_name: \u001b[32m'Name'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[32m'123 New Street'\u001b[39m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Database Integrity > creates proper audit trail for personal info updates\nAbout to compare fields - oldData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nAbout to compare fields - newData: {\n  first_name: \u001b[32m'Updated'\u001b[39m,\n  last_name: \u001b[32m'Name'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[32m'123 New Street'\u001b[39m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Core Functionality > handles POST requests with valid data\nOnboarding completion check: {\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  allStepsCompleted: \u001b[33mtrue\u001b[39m,\n  alreadyCompleted: \u001b[33mfalse\u001b[39m\n}\n\nstdout | tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Core Functionality > handles POST requests with valid data\nMarked onboarding complete for user cb3fcec1-f972-43c7-b794-abed7621b864\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Integration Scenarios > handles complete onboarding workflow progression\nReceived data: {\n  firstName: \u001b[32m'Test'\u001b[39m,\n  lastName: \u001b[32m'User'\u001b[39m,\n  phoneNumber: \u001b[32m'+353871234567'\u001b[39m,\n  dateOfBirth: \u001b[32m'1990-01-01'\u001b[39m,\n  addressLine1: \u001b[32m'123 Test Street'\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Integration Scenarios > handles complete onboarding workflow progression\nCurrent user query result: {\n  id: \u001b[32m'be693329-39ce-45ee-a893-e96edf2233e8'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011095415-c62aeac9@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mfalse\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mfalse\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mfalse\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mfalse\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mfalse\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:38:15.465Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:38:15.465Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m'Test User'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011095415-c62aeac9@example.com'\u001b[39m,\n  phone: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m''\u001b[39m,\n  address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n  address_line_2: \u001b[32m''\u001b[39m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mtrue\u001b[39m,\n  data: {\n    name: \u001b[32m'Test User'\u001b[39m,\n    email: \u001b[32m'test-auth-1757011095415-c62aeac9@example.com'\u001b[39m,\n    phone: \u001b[32m'+353871234567'\u001b[39m,\n    pps_number: \u001b[32m''\u001b[39m,\n    address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n    address_line_2: \u001b[32m''\u001b[39m,\n    city: \u001b[32m'Dublin'\u001b[39m,\n    county: \u001b[32m'Dublin'\u001b[39m,\n    eircode: \u001b[32m'D01 X123'\u001b[39m,\n    country: \u001b[32m'Ireland'\u001b[39m,\n    date_of_birth: \u001b[32m'1990-01-01'\u001b[39m\n  }\n}\nOld data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mfalse\u001b[39m\n}\nNew data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Integration Scenarios > handles complete onboarding workflow progression\nAbout to compare fields - oldData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mfalse\u001b[39m\n}\nAbout to compare fields - newData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[32m'123 Test Street'\u001b[39m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[32m'Dublin'\u001b[39m,\n  county: \u001b[32m'Dublin'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\n ❯ tests/api/beneficiaries/count/count.test.ts (10 tests | 1 failed) 2967ms\n   ✓ /api/beneficiaries/count > Core Functionality > handles GET requests with valid authentication  587ms\n   ✓ /api/beneficiaries/count > Core Functionality > returns consistent response format  506ms\n   ✓ /api/beneficiaries/count > Error States > returns proper error for unauthenticated requests 0ms\n   ✓ /api/beneficiaries/count > Security > requires valid JWT authentication 0ms\n   ✓ /api/beneficiaries/count > Security > validates JWT signature integrity 1ms\n   ✓ /api/beneficiaries/count > Performance > responds within acceptable time with real authentication  478ms\n   ✓ /api/beneficiaries/count > Database Integrity > maintains data consistency with real database operations  472ms\n   ✓ /api/beneficiaries/count > Integration Scenarios > integrates with authentication workflow  470ms\n   ✓ /api/beneficiaries/count > Compliance > meets API standards with proper authentication  448ms\n   × /api/beneficiaries/count > Edge Cases > handles edge cases appropriately 2ms\n     → expected 500 to be less than 500\nstdout | tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Edge Cases > handles malformed JSON appropriately\nOnboarding completion check: {\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  allStepsCompleted: \u001b[33mtrue\u001b[39m,\n  alreadyCompleted: \u001b[33mfalse\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Compliance > validates Irish compliance requirements\nReceived data: {\n  firstName: \u001b[32m'Seán'\u001b[39m,\n  lastName: \u001b[32m'Ó Súilleabháin'\u001b[39m,\n  phoneNumber: \u001b[32m'+353871234567'\u001b[39m,\n  dateOfBirth: \u001b[32m'1990-01-01'\u001b[39m,\n  ppsNumber: \u001b[32m'1234567T'\u001b[39m,\n  addressLine1: \u001b[32m'123 Sráid na hÉireann'\u001b[39m,\n  city: \u001b[32m'Baile Átha Cliath'\u001b[39m,\n  county: \u001b[32m'Átha Cliath'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m\n}\n\nstdout | tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Edge Cases > handles malformed JSON appropriately\nMarked onboarding complete for user cf688824-54b6-4b9f-9ea2-82eaed9f880b\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Compliance > validates Irish compliance requirements\nCurrent user query result: {\n  id: \u001b[32m'6320de1d-4690-44a0-b5f4-d67b4ad04b33'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011097156-457c34cb@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mtrue\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:38:17.200Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:38:17.200Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m'Seán Ó Súilleabháin'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011097156-457c34cb@example.com'\u001b[39m,\n  phone: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m'1234567T'\u001b[39m,\n  address_line_1: \u001b[32m'123 Sráid na hÉireann'\u001b[39m,\n  address_line_2: \u001b[32m''\u001b[39m,\n  city: \u001b[32m'Baile Átha Cliath'\u001b[39m,\n  county: \u001b[32m'Átha Cliath'\u001b[39m,\n  eircode: \u001b[32m'D01 X123'\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mfalse\u001b[39m,\n  error: ZodError: [\n    {\n      \"code\": \"invalid_value\",\n      \"values\": [\n        \"\",\n        \"Antrim\",\n        \"Armagh\",\n        \"Carlow\",\n        \"Cavan\",\n        \"Clare\",\n        \"Cork\",\n        \"Derry\",\n        \"Donegal\",\n        \"Down\",\n        \"Dublin\",\n        \"Fermanagh\",\n        \"Galway\",\n        \"Kerry\",\n        \"Kildare\",\n        \"Kilkenny\",\n        \"Laois\",\n        \"Leitrim\",\n        \"Limerick\",\n        \"Longford\",\n        \"Louth\",\n        \"Mayo\",\n        \"Meath\",\n        \"Monaghan\",\n        \"Offaly\",\n        \"Roscommon\",\n        \"Sligo\",\n        \"Tipperary\",\n        \"Tyrone\",\n        \"Waterford\",\n        \"Westmeath\",\n        \"Wexford\",\n        \"Wicklow\"\n      ],\n      \"path\": [\n        \"county\"\n      ],\n      \"message\": \"Invalid option: expected one of \\\"\\\"|\\\"Antrim\\\"|\\\"Armagh\\\"|\\\"Carlow\\\"|\\\"Cavan\\\"|\\\"Clare\\\"|\\\"Cork\\\"|\\\"Derry\\\"|\\\"Donegal\\\"|\\\"Down\\\"|\\\"Dublin\\\"|\\\"Fermanagh\\\"|\\\"Galway\\\"|\\\"Kerry\\\"|\\\"Kildare\\\"|\\\"Kilkenny\\\"|\\\"Laois\\\"|\\\"Leitrim\\\"|\\\"Limerick\\\"|\\\"Longford\\\"|\\\"Louth\\\"|\\\"Mayo\\\"|\\\"Meath\\\"|\\\"Monaghan\\\"|\\\"Offaly\\\"|\\\"Roscommon\\\"|\\\"Sligo\\\"|\\\"Tipperary\\\"|\\\"Tyrone\\\"|\\\"Waterford\\\"|\\\"Westmeath\\\"|\\\"Wexford\\\"|\\\"Wicklow\\\"\"\n    }\n  ]\n      at new ZodError \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/zod@4.0.17/node_modules/\u001b[4mzod\u001b[24m/v4/core/core.js:30:39\u001b[90m)\u001b[39m\n      at Module.<anonymous> \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/zod@4.0.17/node_modules/\u001b[4mzod\u001b[24m/v4/core/parse.js:40:20\u001b[90m)\u001b[39m\n      at _.inst.safeParse \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/zod@4.0.17/node_modules/\u001b[4mzod\u001b[24m/v4/classic/schemas.js:30:46\u001b[90m)\u001b[39m\n      at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/personal-info/route.ts:288:49\u001b[90m)\u001b[39m\n  \u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n      at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/personal-info/personal-info.test.ts:397:24\n      at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n}\n\n ❯ tests/api/rules/validate-allocation/validate-allocation.test.ts (10 tests | 9 failed) 2791ms\n   × /api/rules/validate-allocation > Core Functionality > handles GET requests with valid authentication 540ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Core Functionality > handles POST requests with valid data 370ms\n     → expected 400 to be less than 300\n   × /api/rules/validate-allocation > Error States > returns proper error for unauthenticated requests 1ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Security > requires valid JWT authentication 0ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Security > validates JWT signature integrity 0ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Performance > responds within acceptable time with real authentication 390ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Database Integrity > maintains data consistency with real database operations 378ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Integration Scenarios > integrates with authentication workflow 375ms\n     → GET is not a function\n   × /api/rules/validate-allocation > Compliance > meets API standards with proper authentication 358ms\n     → GET is not a function\n   ✓ /api/rules/validate-allocation > Edge Cases > handles malformed JSON appropriately  376ms\n ❯ tests/api/debug/verification/verification.test.ts (10 tests | 3 failed) 3035ms\n   ✓ /api/debug/verification > Core Functionality > handles GET requests with valid authentication  601ms\n   × /api/debug/verification > Core Functionality > handles POST requests with valid data 362ms\n     → POST is not a function\n   × /api/debug/verification > Error States > returns proper error for unauthenticated requests 1ms\n     → POST is not a function\n   ✓ /api/debug/verification > Security > requires valid JWT authentication 0ms\n   ✓ /api/debug/verification > Security > validates JWT signature integrity 0ms\n   ✓ /api/debug/verification > Performance > responds within acceptable time with real authentication  418ms\n   ✓ /api/debug/verification > Database Integrity > maintains data consistency with real database operations  428ms\n   ✓ /api/debug/verification > Integration Scenarios > integrates with authentication workflow  423ms\n   ✓ /api/debug/verification > Compliance > meets API standards with proper authentication  408ms\n   × /api/debug/verification > Edge Cases > handles malformed JSON appropriately 390ms\n     → POST is not a function\n ❯ tests/api/rules/[id]/[id].test.ts (11 tests | 3 failed) 2972ms\n   × /api/rules/[id] > Core Functionality > handles GET requests with valid authentication 725ms\n     → expected 500 to be less than 300\n   × /api/rules/[id] > Core Functionality > handles PUT requests with valid data 374ms\n     → expected 500 to be less than 300\n   × /api/rules/[id] > Core Functionality > handles DELETE requests with authentication 380ms\n     → expected 500 to be less than 500\n   ✓ /api/rules/[id] > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/rules/[id] > Security > requires valid JWT authentication 1ms\n   ✓ /api/rules/[id] > Security > validates JWT signature integrity 1ms\n   ✓ /api/rules/[id] > Performance > responds within acceptable time with real authentication  386ms\n   ✓ /api/rules/[id] > Database Integrity > maintains data consistency with real database operations  363ms\n   ✓ /api/rules/[id] > Integration Scenarios > integrates with authentication workflow  351ms\n   ✓ /api/rules/[id] > Compliance > meets API standards with proper authentication  387ms\n   ✓ /api/rules/[id] > Edge Cases > handles edge cases appropriately 0ms\n ❯ tests/api/onboarding/complete/complete.test.ts (10 tests | 9 failed) 3062ms\n   × /api/onboarding/complete > Core Functionality > handles GET requests with valid authentication 561ms\n     → GET is not a function\n   ✓ /api/onboarding/complete > Core Functionality > handles POST requests with valid data  485ms\n   × /api/onboarding/complete > Error States > returns proper error for unauthenticated requests 1ms\n     → GET is not a function\n   × /api/onboarding/complete > Security > requires valid JWT authentication 0ms\n     → GET is not a function\n   × /api/onboarding/complete > Security > validates JWT signature integrity 0ms\n     → GET is not a function\n   × /api/onboarding/complete > Performance > responds within acceptable time with real authentication 383ms\n     → GET is not a function\n   × /api/onboarding/complete > Database Integrity > maintains data consistency with real database operations 392ms\n     → GET is not a function\n   × /api/onboarding/complete > Integration Scenarios > integrates with authentication workflow 365ms\n     → GET is not a function\n   × /api/onboarding/complete > Compliance > meets API standards with proper authentication 363ms\n     → GET is not a function\n   × /api/onboarding/complete > Edge Cases > handles malformed JSON appropriately 510ms\n     → expected 200 to be greater than or equal to 400\n ❯ tests/api/onboarding/verification/verification.test.ts (10 tests | 1 failed) 3098ms\n   ✓ /api/onboarding > Core Functionality > handles authenticated requests with real JWT tokens  599ms\n   × /api/onboarding > Core Functionality > handles POST requests with valid data 381ms\n     → expected 400 to be less than 300\n   ✓ /api/onboarding > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/onboarding > Security > requires valid JWT authentication 0ms\n   ✓ /api/onboarding > Security > validates JWT signature integrity 0ms\n   ✓ /api/onboarding > Performance > responds within acceptable time with real authentication  432ms\n   ✓ /api/onboarding > Database Integrity > maintains data consistency with real database operations  441ms\n   ✓ /api/onboarding > Integration Scenarios > integrates with authentication workflow  424ms\n   ✓ /api/onboarding > Compliance > meets API standards with proper authentication  429ms\n   ✓ /api/onboarding > Edge Cases > handles malformed requests appropriately  388ms\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Edge Cases > handles photo deletion workflow\nReceived data: {\n  firstName: \u001b[32m'Test'\u001b[39m,\n  lastName: \u001b[32m'User'\u001b[39m,\n  phoneNumber: \u001b[32m'+353871234567'\u001b[39m,\n  dateOfBirth: \u001b[32m'1990-01-01'\u001b[39m,\n  photoMarkedForDeletion: \u001b[33mtrue\u001b[39m,\n  photo_url: \u001b[1mnull\u001b[22m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Edge Cases > handles photo deletion workflow\nCurrent user query result: {\n  id: \u001b[32m'b1d6c9e3-7c92-400b-98ad-f0fdd948dd90'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011098153-985833f2@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mtrue\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:38:18.194Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:38:18.194Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m'Test User'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011098153-985833f2@example.com'\u001b[39m,\n  phone: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m''\u001b[39m,\n  address_line_1: \u001b[32m''\u001b[39m,\n  address_line_2: \u001b[32m''\u001b[39m,\n  city: \u001b[32m''\u001b[39m,\n  county: \u001b[32m''\u001b[39m,\n  eircode: \u001b[32m''\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mtrue\u001b[39m,\n  data: {\n    name: \u001b[32m'Test User'\u001b[39m,\n    email: \u001b[32m'test-auth-1757011098153-985833f2@example.com'\u001b[39m,\n    phone: \u001b[32m'+353871234567'\u001b[39m,\n    pps_number: \u001b[32m''\u001b[39m,\n    address_line_1: \u001b[32m''\u001b[39m,\n    address_line_2: \u001b[32m''\u001b[39m,\n    city: \u001b[32m''\u001b[39m,\n    county: \u001b[32m''\u001b[39m,\n    eircode: \u001b[32m''\u001b[39m,\n    country: \u001b[32m'Ireland'\u001b[39m,\n    date_of_birth: \u001b[32m'1990-01-01'\u001b[39m\n  }\n}\nOld data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nNew data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Edge Cases > handles photo deletion workflow\nAbout to compare fields - oldData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nAbout to compare fields - newData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Core Functionality > handles POST requests with valid data\n=== CONSENT SIGNATURE API HIT ===\n\nstdout | tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Core Functionality > handles POST requests with valid data\nSession check: {\n  isAuthenticated: \u001b[33mtrue\u001b[39m,\n  userId: \u001b[32m'b4d8a734-b862-4ffe-9ac9-1ce140ffeaa7'\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Token Management > maintains session consistency across operations\nReceived data: {\n  firstName: \u001b[32m'Test'\u001b[39m,\n  lastName: \u001b[32m'User'\u001b[39m,\n  phoneNumber: \u001b[32m'+353871234567'\u001b[39m,\n  dateOfBirth: \u001b[32m'1990-01-01'\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Token Management > maintains session consistency across operations\nCurrent user query result: {\n  id: \u001b[32m'ff92dd0f-7370-4f6c-b90a-b8fe9dc66ec0'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011099867-154ebe08@example.com'\u001b[39m,\n  password_hash: \u001b[1mnull\u001b[22m,\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  onboarding_status: \u001b[32m'not_started'\u001b[39m,\n  onboarding_current_step: \u001b[32m'personal_info'\u001b[39m,\n  onboarding_completed_at: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m,\n  personal_info_completed_at: \u001b[1mnull\u001b[22m,\n  signature_completed: \u001b[33mtrue\u001b[39m,\n  signature_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consent_completed: \u001b[33mtrue\u001b[39m,\n  legal_consent_completed_at: \u001b[1mnull\u001b[22m,\n  legal_consents: \u001b[1mnull\u001b[22m,\n  verification_completed: \u001b[33mtrue\u001b[39m,\n  verification_completed_at: \u001b[1mnull\u001b[22m,\n  verification_session_id: \u001b[1mnull\u001b[22m,\n  verification_status: \u001b[32m'verified'\u001b[39m,\n  onboarding_completed: \u001b[33mtrue\u001b[39m,\n  auth_provider: \u001b[1mnull\u001b[22m,\n  auth_provider_id: \u001b[1mnull\u001b[22m,\n  created_at: \u001b[35m2025-09-04T18:38:19.913Z\u001b[39m,\n  updated_at: \u001b[35m2025-09-04T18:38:19.913Z\u001b[39m\n}\nValidation data: {\n  name: \u001b[32m'Test User'\u001b[39m,\n  email: \u001b[32m'test-auth-1757011099867-154ebe08@example.com'\u001b[39m,\n  phone: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[32m''\u001b[39m,\n  address_line_1: \u001b[32m''\u001b[39m,\n  address_line_2: \u001b[32m''\u001b[39m,\n  city: \u001b[32m''\u001b[39m,\n  county: \u001b[32m''\u001b[39m,\n  eircode: \u001b[32m''\u001b[39m,\n  country: \u001b[32m'Ireland'\u001b[39m\n}\nValidation result: {\n  success: \u001b[33mtrue\u001b[39m,\n  data: {\n    name: \u001b[32m'Test User'\u001b[39m,\n    email: \u001b[32m'test-auth-1757011099867-154ebe08@example.com'\u001b[39m,\n    phone: \u001b[32m'+353871234567'\u001b[39m,\n    pps_number: \u001b[32m''\u001b[39m,\n    address_line_1: \u001b[32m''\u001b[39m,\n    address_line_2: \u001b[32m''\u001b[39m,\n    city: \u001b[32m''\u001b[39m,\n    county: \u001b[32m''\u001b[39m,\n    eircode: \u001b[32m''\u001b[39m,\n    country: \u001b[32m'Ireland'\u001b[39m,\n    date_of_birth: \u001b[32m'1990-01-01'\u001b[39m\n  }\n}\nOld data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nNew data: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\nstdout | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Token Management > maintains session consistency across operations\nAbout to compare fields - oldData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[1mnull\u001b[22m,\n  date_of_birth: \u001b[1mnull\u001b[22m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\nAbout to compare fields - newData: {\n  first_name: \u001b[32m'Test'\u001b[39m,\n  last_name: \u001b[32m'User'\u001b[39m,\n  phone_number: \u001b[32m'+353871234567'\u001b[39m,\n  date_of_birth: \u001b[32m'1990-01-01'\u001b[39m,\n  pps_number: \u001b[1mnull\u001b[22m,\n  address_line_1: \u001b[1mnull\u001b[22m,\n  address_line_2: \u001b[1mnull\u001b[22m,\n  city: \u001b[1mnull\u001b[22m,\n  county: \u001b[1mnull\u001b[22m,\n  eircode: \u001b[1mnull\u001b[22m,\n  profile_photo_url: \u001b[1mnull\u001b[22m,\n  personal_info_completed: \u001b[33mtrue\u001b[39m\n}\n\n ❯ tests/api/onboarding/personal-info/personal-info.test.ts (25 tests | 4 failed) 11075ms\n   ✓ /api/onboarding/personal-info > Core Functionality > handles GET requests with valid authentication  772ms\n   ✓ /api/onboarding/personal-info > Core Functionality > returns completion status correctly  577ms\n   ✓ /api/onboarding/personal-info > Core Functionality > handles POST requests with valid personal info data  763ms\n   ✓ /api/onboarding/personal-info > Error States > returns 401 for unauthenticated GET requests 83ms\n   ✓ /api/onboarding/personal-info > Error States > returns 401 for unauthenticated POST requests 78ms\n   ✓ /api/onboarding/personal-info > Error States > validates required personal info fields  547ms\n   ✓ /api/onboarding/personal-info > Security > requires valid JWT authentication for GET 70ms\n   ✓ /api/onboarding/personal-info > Security > requires valid JWT authentication for POST 80ms\n   ✓ /api/onboarding/personal-info > Security > validates JWT signature integrity 86ms\n   × /api/onboarding/personal-info > Security > prevents OAuth email tampering 54ms\n     → Failed query: insert into \"app_users\" (\"id\", \"email\", \"password_hash\", \"first_name\", \"last_name\", \"phone_number\", \"date_of_birth\", \"pps_number\", \"profile_photo_url\", \"address_line_1\", \"address_line_2\", \"city\", \"county\", \"eircode\", \"onboarding_status\", \"onboarding_current_step\", \"onboarding_completed_at\", \"personal_info_completed\", \"personal_info_completed_at\", \"signature_completed\", \"signature_completed_at\", \"legal_consent_completed\", \"legal_consent_completed_at\", \"legal_consents\", \"verification_completed\", \"verification_completed_at\", \"verification_session_id\", \"verification_status\", \"auth_provider\", \"auth_provider_id\", \"created_at\", \"updated_at\") values ($1, $2, default, $3, $4, default, default, default, default, default, default, default, default, default, default, default, default, $5, default, $6, default, $7, default, default, $8, default, default, $9, default, default, default, default) returning \"id\", \"email\", \"password_hash\", \"first_name\", \"last_name\", \"phone_number\", \"date_of_birth\", \"pps_number\", \"profile_photo_url\", \"address_line_1\", \"address_line_2\", \"city\", \"county\", \"eircode\", \"onboarding_status\", \"onboarding_current_step\", \"onboarding_completed_at\", \"personal_info_completed\", \"personal_info_completed_at\", \"signature_completed\", \"signature_completed_at\", \"legal_consent_completed\", \"legal_consent_completed_at\", \"legal_consents\", \"verification_completed\", \"verification_completed_at\", \"verification_session_id\", \"verification_status\", \"onboarding_completed\", \"auth_provider\", \"auth_provider_id\", \"created_at\", \"updated_at\"\nparams: 8701e781-5a43-4ae8-becd-1b0819e6ddaa,original@example.com,Test,User,true,true,true,true,verified\n   ✓ /api/onboarding/personal-info > Performance > responds within acceptable time with real authentication  539ms\n   ✓ /api/onboarding/personal-info > Performance > handles concurrent requests efficiently  651ms\n   ✓ /api/onboarding/personal-info > Database Integrity > maintains user data consistency with real database operations  475ms\n   ✓ /api/onboarding/personal-info > Database Integrity > creates proper audit trail for personal info updates  662ms\n   × /api/onboarding/personal-info > Integration Scenarios > integrates with OAuth data source tracking 521ms\n     → expected false to be true // Object.is equality\n   ✓ /api/onboarding/personal-info > Integration Scenarios > handles complete onboarding workflow progression  695ms\n   ✓ /api/onboarding/personal-info > Compliance > meets API standards with proper authentication  532ms\n   ✓ /api/onboarding/personal-info > Compliance > follows REST API conventions  514ms\n   × /api/onboarding/personal-info > Compliance > validates Irish compliance requirements 534ms\n     → expected 400 to be less than 300\n   ✓ /api/onboarding/personal-info > Edge Cases > handles requests with malformed JSON  462ms\n   ✓ /api/onboarding/personal-info > Edge Cases > handles photo deletion workflow  641ms\n   × /api/onboarding/personal-info > Edge Cases > handles users with incomplete profile data 501ms\n     → expected 'Test' to be '' // Object.is equality\n   ✓ /api/onboarding/personal-info > Token Management > validates access token structure and claims  500ms\n   ✓ /api/onboarding/personal-info > Token Management > handles expired tokens appropriately 73ms\n   ✓ /api/onboarding/personal-info > Token Management > maintains session consistency across operations  662ms\n ❯ tests/api/audit/log-event/log-event.test.ts (10 tests | 9 failed) 2826ms\n   × /api/audit/log-event > Core Functionality > handles GET requests with valid authentication 583ms\n     → GET is not a function\n   ✓ /api/audit/log-event > Core Functionality > handles POST requests with valid data  408ms\n   × /api/audit/log-event > Error States > returns proper error for unauthenticated requests 0ms\n     → GET is not a function\n   × /api/audit/log-event > Security > requires valid JWT authentication 0ms\n     → GET is not a function\n   × /api/audit/log-event > Security > validates JWT signature integrity 1ms\n     → GET is not a function\n   × /api/audit/log-event > Performance > responds within acceptable time with real authentication 356ms\n     → GET is not a function\n   × /api/audit/log-event > Database Integrity > maintains data consistency with real database operations 368ms\n     → GET is not a function\n   × /api/audit/log-event > Integration Scenarios > integrates with authentication workflow 364ms\n     → GET is not a function\n   × /api/audit/log-event > Compliance > meets API standards with proper authentication 372ms\n     → GET is not a function\n   × /api/audit/log-event > Edge Cases > handles malformed JSON appropriately 371ms\n     → expected 200 to be greater than or equal to 400\nstdout | tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Edge Cases > handles malformed JSON appropriately\n=== CONSENT SIGNATURE API HIT ===\n\nstdout | tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Edge Cases > handles malformed JSON appropriately\nSession check: {\n  isAuthenticated: \u001b[33mtrue\u001b[39m,\n  userId: \u001b[32m'8c428787-0b02-4e2c-9beb-2d2a3240c115'\u001b[39m\n}\n\n ❯ tests/api/beneficiaries/photo/photo.test.ts (10 tests | 9 failed) 2663ms\n   × /api/beneficiaries/photo > Core Functionality > handles GET requests with valid authentication 514ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Core Functionality > handles POST requests with valid data 383ms\n     → expected 500 to be less than 300\n   × /api/beneficiaries/photo > Error States > returns proper error for unauthenticated requests 1ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Security > requires valid JWT authentication 0ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Security > validates JWT signature integrity 0ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Performance > responds within acceptable time with real authentication 355ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Database Integrity > maintains data consistency with real database operations 332ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Integration Scenarios > integrates with authentication workflow 340ms\n     → GET is not a function\n   × /api/beneficiaries/photo > Compliance > meets API standards with proper authentication 361ms\n     → GET is not a function\n   ✓ /api/beneficiaries/photo > Edge Cases > handles malformed JSON appropriately  373ms\n ❯ tests/api/onboarding/consent-signature/consent-signature.test.ts (10 tests | 9 failed) 2724ms\n   × /api/onboarding/consent-signature > Core Functionality > handles GET requests with valid authentication 549ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Core Functionality > handles POST requests with valid data 378ms\n     → expected 400 to be less than 300\n   × /api/onboarding/consent-signature > Error States > returns proper error for unauthenticated requests 1ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Security > requires valid JWT authentication 0ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Security > validates JWT signature integrity 0ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Performance > responds within acceptable time with real authentication 353ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Database Integrity > maintains data consistency with real database operations 332ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Integration Scenarios > integrates with authentication workflow 368ms\n     → GET is not a function\n   × /api/onboarding/consent-signature > Compliance > meets API standards with proper authentication 364ms\n     → GET is not a function\n   ✓ /api/onboarding/consent-signature > Edge Cases > handles malformed JSON appropriately  373ms\n ❯ tests/api/auth/refresh/refresh.test.ts (10 tests | 1 failed) 2712ms\n   ✓ /api/auth > Core Functionality > handles authenticated requests with real JWT tokens  513ms\n   × /api/auth > Core Functionality > handles POST requests with valid data 371ms\n     → expected 401 to be less than 300\n   ✓ /api/auth > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/auth > Security > requires valid JWT authentication 0ms\n   ✓ /api/auth > Security > validates JWT signature integrity 0ms\n   ✓ /api/auth > Performance > responds within acceptable time with real authentication  339ms\n   ✓ /api/auth > Database Integrity > maintains data consistency with real database operations  367ms\n   ✓ /api/auth > Integration Scenarios > integrates with authentication workflow  371ms\n   ✓ /api/auth > Compliance > meets API standards with proper authentication  365ms\n   ✓ /api/auth > Edge Cases > handles malformed requests appropriately  383ms\n ❯ tests/api/auth/register/register.test.ts (10 tests | 1 failed) 2756ms\n   ✓ /api/auth > Core Functionality > handles authenticated requests with real JWT tokens  522ms\n   × /api/auth > Core Functionality > handles POST requests with valid data 383ms\n     → expected 400 to be less than 300\n   ✓ /api/auth > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/auth > Security > requires valid JWT authentication 0ms\n   ✓ /api/auth > Security > validates JWT signature integrity 0ms\n   ✓ /api/auth > Performance > responds within acceptable time with real authentication  366ms\n   ✓ /api/auth > Database Integrity > maintains data consistency with real database operations  367ms\n   ✓ /api/auth > Integration Scenarios > integrates with authentication workflow  370ms\n   ✓ /api/auth > Compliance > meets API standards with proper authentication  370ms\n   ✓ /api/auth > Edge Cases > handles malformed requests appropriately  374ms\n ❯ tests/api/auth/google/google.test.ts (10 tests | 6 failed) 2769ms\n   × /api/auth/google > Core Functionality > handles GET requests with valid authentication 536ms\n     → expected 307 to be less than 300\n   × /api/auth/google > Core Functionality > handles POST requests with valid data 381ms\n     → POST is not a function\n   × /api/auth/google > Error States > returns proper error for unauthenticated requests 1ms\n     → expected 307 to be greater than or equal to 400\n   × /api/auth/google > Security > requires valid JWT authentication 1ms\n     → expected 307 to be greater than or equal to 400\n   × /api/auth/google > Security > validates JWT signature integrity 0ms\n     → expected 307 to be greater than or equal to 400\n   ✓ /api/auth/google > Performance > responds within acceptable time with real authentication  367ms\n   ✓ /api/auth/google > Database Integrity > maintains data consistency with real database operations  367ms\n   ✓ /api/auth/google > Integration Scenarios > integrates with authentication workflow  369ms\n   ✓ /api/auth/google > Compliance > meets API standards with proper authentication  377ms\n   × /api/auth/google > Edge Cases > handles malformed JSON appropriately 369ms\n     → POST is not a function\n ❯ tests/api/auth/logout/logout.test.ts (10 tests | 9 failed) 2694ms\n   × /api/auth/logout > Core Functionality > handles GET requests with valid authentication 508ms\n     → GET is not a function\n   ✓ /api/auth/logout > Core Functionality > handles POST requests with valid data  332ms\n   × /api/auth/logout > Error States > returns proper error for unauthenticated requests 0ms\n     → GET is not a function\n   × /api/auth/logout > Security > requires valid JWT authentication 0ms\n     → GET is not a function\n   × /api/auth/logout > Security > validates JWT signature integrity 0ms\n     → GET is not a function\n   × /api/auth/logout > Performance > responds within acceptable time with real authentication 371ms\n     → GET is not a function\n   × /api/auth/logout > Database Integrity > maintains data consistency with real database operations 329ms\n     → GET is not a function\n   × /api/auth/logout > Integration Scenarios > integrates with authentication workflow 372ms\n     → GET is not a function\n   × /api/auth/logout > Compliance > meets API standards with proper authentication 386ms\n     → GET is not a function\n   × /api/auth/logout > Edge Cases > handles malformed JSON appropriately 391ms\n     → expected 200 to be greater than or equal to 400\n ❯ tests/api/auth/login/login.test.ts (10 tests | 1 failed) 2732ms\n   ✓ /api/auth > Core Functionality > handles authenticated requests with real JWT tokens  517ms\n   × /api/auth > Core Functionality > handles POST requests with valid data 342ms\n     → expected 400 to be less than 300\n   ✓ /api/auth > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/auth > Security > requires valid JWT authentication 0ms\n   ✓ /api/auth > Security > validates JWT signature integrity 0ms\n   ✓ /api/auth > Performance > responds within acceptable time with real authentication  356ms\n   ✓ /api/auth > Database Integrity > maintains data consistency with real database operations  360ms\n   ✓ /api/auth > Integration Scenarios > integrates with authentication workflow  390ms\n   ✓ /api/auth > Compliance > meets API standards with proper authentication  367ms\n   ✓ /api/auth > Edge Cases > handles malformed requests appropriately  397ms\n ❯ tests/api/stripe/webhook/webhook.test.ts (9 tests | 1 failed) 2456ms\n   × /api/stripe/webhook > Core Functionality > handles POST requests with valid data 522ms\n     → expected 400 to be less than 300\n   ✓ /api/stripe/webhook > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/stripe/webhook > Security > requires valid JWT authentication 0ms\n   ✓ /api/stripe/webhook > Security > validates JWT signature integrity 0ms\n   ✓ /api/stripe/webhook > Performance > responds within acceptable time with real authentication  385ms\n   ✓ /api/stripe/webhook > Database Integrity > maintains data consistency with real database operations  374ms\n   ✓ /api/stripe/webhook > Integration Scenarios > integrates with authentication workflow  422ms\n   ✓ /api/stripe/webhook > Compliance > meets API standards with proper authentication  377ms\n   ✓ /api/stripe/webhook > Edge Cases > handles malformed JSON appropriately  373ms\n ❯ tests/api/documents/requirements/[type]/[type].test.ts (10 tests | 3 failed) 2472ms\n   ✓ /api/documents/requirements/[type] > Core Functionality > handles GET requests with valid authentication  508ms\n   ✓ /api/documents/requirements/[type] > Core Functionality > returns consistent response format  386ms\n   × /api/documents/requirements/[type] > Error States > returns proper error for unauthenticated requests 2ms\n     → expected 200 to be greater than or equal to 400\n   × /api/documents/requirements/[type] > Security > requires valid JWT authentication 0ms\n     → expected 200 to be greater than or equal to 400\n   × /api/documents/requirements/[type] > Security > validates JWT signature integrity 0ms\n     → expected 200 to be greater than or equal to 400\n   ✓ /api/documents/requirements/[type] > Performance > responds within acceptable time with real authentication  397ms\n   ✓ /api/documents/requirements/[type] > Database Integrity > maintains data consistency with real database operations  404ms\n   ✓ /api/documents/requirements/[type] > Integration Scenarios > integrates with authentication workflow  390ms\n   ✓ /api/documents/requirements/[type] > Compliance > meets API standards with proper authentication  383ms\n   ✓ /api/documents/requirements/[type] > Edge Cases > handles edge cases appropriately 0ms\n ❯ tests/api/assets/categories/categories.test.ts (10 tests | 1 failed) 2463ms\n   ✓ /api/assets/categories > Core Functionality > handles GET requests with valid authentication  537ms\n   ✓ /api/assets/categories > Core Functionality > returns consistent response format  393ms\n   ✓ /api/assets/categories > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/assets/categories > Security > requires valid JWT authentication 0ms\n   ✓ /api/assets/categories > Security > validates JWT signature integrity 0ms\n   ✓ /api/assets/categories > Performance > responds within acceptable time with real authentication  384ms\n   ✓ /api/assets/categories > Database Integrity > maintains data consistency with real database operations  380ms\n   ✓ /api/assets/categories > Integration Scenarios > integrates with authentication workflow  398ms\n   ✓ /api/assets/categories > Compliance > meets API standards with proper authentication  363ms\n   × /api/assets/categories > Edge Cases > handles edge cases appropriately 3ms\n     → expected 500 to be less than 500\n ❯ tests/api/debug-user/debug-user.test.ts (10 tests | 4 failed) 2779ms\n   × /api/debug-user > Core Functionality > handles GET requests with valid authentication 523ms\n     → expected 400 to be less than 300\n   × /api/debug-user > Core Functionality > handles POST requests with valid data 338ms\n     → POST is not a function\n   × /api/debug-user > Error States > returns proper error for unauthenticated requests 1ms\n     → POST is not a function\n   ✓ /api/debug-user > Security > requires valid JWT authentication 0ms\n   ✓ /api/debug-user > Security > validates JWT signature integrity 0ms\n   ✓ /api/debug-user > Performance > responds within acceptable time with real authentication  396ms\n   ✓ /api/debug-user > Database Integrity > maintains data consistency with real database operations  393ms\n   ✓ /api/debug-user > Integration Scenarios > integrates with authentication workflow  359ms\n   ✓ /api/debug-user > Compliance > meets API standards with proper authentication  377ms\n   × /api/debug-user > Edge Cases > handles malformed JSON appropriately 388ms\n     → POST is not a function\n ❯ tests/api/onboarding/photo/photo.test.ts (10 tests | 1 failed) 2856ms\n   ✓ /api/onboarding > Core Functionality > handles authenticated requests with real JWT tokens  525ms\n   × /api/onboarding > Core Functionality > handles POST requests with valid data 373ms\n     → expected 500 to be less than 300\n   ✓ /api/onboarding > Error States > returns proper error for unauthenticated requests 1ms\n   ✓ /api/onboarding > Security > requires valid JWT authentication 0ms\n   ✓ /api/onboarding > Security > validates JWT signature integrity 0ms\n   ✓ /api/onboarding > Performance > responds within acceptable time with real authentication  396ms\n   ✓ /api/onboarding > Database Integrity > maintains data consistency with real database operations  421ms\n   ✓ /api/onboarding > Integration Scenarios > integrates with authentication workflow  414ms\n   ✓ /api/onboarding > Compliance > meets API standards with proper authentication  378ms\n   ✓ /api/onboarding > Edge Cases > handles malformed requests appropriately  344ms\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Core Functionality > handles POST requests with valid authentication\nOnboarding step 0 completed for user 5ed3199c-658e-4382-a1f1-1737ffdc8459\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Core Functionality > saves step completion data correctly\nOnboarding step 1 completed for user 824026b4-3b0c-41ec-ad00-a9733c1a61b8\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Core Functionality > handles final step completion\nOnboarding step 3 completed for user 1fb41da9-b4e7-466a-b46c-a67b9161493b\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Security > prevents data injection through step data\nOnboarding step 0 completed for user 6bcc795e-08ad-4b74-a662-5433223b038b\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Performance > responds within acceptable time with real authentication\nOnboarding step 1 completed for user e9332502-0847-4fb7-bfb3-57f6d1b56993\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Performance > handles concurrent requests efficiently\nOnboarding step 0 completed for user 4cf678c3-d06c-4a93-b9c3-ea7e7e173ab8\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Performance > handles concurrent requests efficiently\nOnboarding step 1 completed for user 4cf678c3-d06c-4a93-b9c3-ea7e7e173ab8\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Performance > handles concurrent requests efficiently\nOnboarding step 2 completed for user 4cf678c3-d06c-4a93-b9c3-ea7e7e173ab8\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Database Integrity > maintains user data consistency with real database operations\nOnboarding step 0 completed for user c5348952-234a-44ee-a9fa-4fa2397cef01\n\n ✓ tests/api/will/will.test.ts (10 tests) 3533ms\n   ✓ /api/will > Core Functionality > handles GET requests with valid authentication  739ms\n   ✓ /api/will > Core Functionality > handles POST requests with valid data  503ms\n   ✓ /api/will > Performance > responds within acceptable time with real authentication  476ms\n   ✓ /api/will > Database Integrity > maintains data consistency with real database operations  475ms\n   ✓ /api/will > Integration Scenarios > integrates with authentication workflow  472ms\n   ✓ /api/will > Compliance > meets API standards with proper authentication  493ms\n   ✓ /api/will > Edge Cases > handles malformed JSON appropriately  371ms\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Database Integrity > creates proper audit trail for step completions\nOnboarding step 2 completed for user ac7313b8-3747-403d-9553-c2478a9863dd\n\n ✓ tests/api/assets/[id]/[id].test.ts (11 tests) 4160ms\n   ✓ /api/assets/[id] > Core Functionality > handles GET requests with valid authentication  731ms\n   ✓ /api/assets/[id] > Core Functionality > handles PUT requests with valid data  647ms\n   ✓ /api/assets/[id] > Core Functionality > handles DELETE requests with authentication  616ms\n   ✓ /api/assets/[id] > Performance > responds within acceptable time with real authentication  546ms\n   ✓ /api/assets/[id] > Database Integrity > maintains data consistency with real database operations  546ms\n   ✓ /api/assets/[id] > Integration Scenarios > integrates with authentication workflow  530ms\n   ✓ /api/assets/[id] > Compliance > meets API standards with proper authentication  539ms\n ✓ tests/api/beneficiaries/[id]/[id].test.ts (11 tests) 4086ms\n   ✓ /api/beneficiaries/[id] > Core Functionality > handles GET requests with valid authentication  753ms\n   ✓ /api/beneficiaries/[id] > Core Functionality > handles PUT requests with valid data  583ms\n   ✓ /api/beneficiaries/[id] > Core Functionality > handles DELETE requests with authentication  557ms\n   ✓ /api/beneficiaries/[id] > Performance > responds within acceptable time with real authentication  549ms\n   ✓ /api/beneficiaries/[id] > Database Integrity > maintains data consistency with real database operations  542ms\n   ✓ /api/beneficiaries/[id] > Integration Scenarios > integrates with authentication workflow  530ms\n   ✓ /api/beneficiaries/[id] > Compliance > meets API standards with proper authentication  568ms\n ✓ tests/api/onboarding/legal-consent/legal-consent.test.ts (12 tests) 4449ms\n   ✓ /api/onboarding/legal-consent > Core Functionality > handles GET requests with authentication  626ms\n   ✓ /api/onboarding/legal-consent > Core Functionality > handles POST requests with valid consent data  457ms\n   ✓ /api/onboarding/legal-consent > Core Functionality > returns user's consent data correctly  454ms\n   ✓ /api/onboarding/legal-consent > Error States > validates required consent fields  362ms\n   ✓ /api/onboarding/legal-consent > Error States > validates consent data format  368ms\n   ✓ /api/onboarding/legal-consent > Security > handles malicious consent data safely  425ms\n   ✓ /api/onboarding/legal-consent > Security > stores IP address and user agent for audit trail  436ms\n   ✓ /api/onboarding/legal-consent > Performance & Edge Cases > responds within acceptable time  416ms\n   ✓ /api/onboarding/legal-consent > Performance & Edge Cases > handles concurrent requests safely  623ms\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Integration Scenarios > integrates with onboarding progression workflow\nOnboarding step 0 completed for user 214cec8f-ba98-4e8b-8b6d-043c91c780e8\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Integration Scenarios > handles step progression through onboarding flow\nOnboarding step 1 completed for user 40e25413-e712-4e44-91da-62f59f2a78eb\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Integration Scenarios > handles step progression through onboarding flow\nOnboarding step 2 completed for user 40e25413-e712-4e44-91da-62f59f2a78eb\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Integration Scenarios > handles step progression through onboarding flow\nOnboarding step 3 completed for user 40e25413-e712-4e44-91da-62f59f2a78eb\n\n ✓ tests/api/auth/session/session.test.ts (21 tests) 5450ms\n   ✓ /api/auth/session > Core Functionality > handles GET requests with valid session  552ms\n   ✓ /api/auth/session > Core Functionality > returns user session data correctly  416ms\n   ✓ /api/auth/session > Security > prevents session fixation attacks  374ms\n   ✓ /api/auth/session > Performance > responds within acceptable time with real authentication  382ms\n   ✓ /api/auth/session > Performance > handles concurrent authenticated requests efficiently  346ms\n   ✓ /api/auth/session > Database Integrity > maintains user data consistency with real database queries  388ms\n   ✓ /api/auth/session > Integration Scenarios > integrates with onboarding status workflow  362ms\n   ✓ /api/auth/session > Integration Scenarios > provides complete user context for authenticated requests  372ms\n   ✓ /api/auth/session > Compliance > meets API standards with proper authentication  375ms\n   ✓ /api/auth/session > Compliance > follows REST API conventions  370ms\n   ✓ /api/auth/session > Edge Cases > handles users with incomplete profile data  381ms\n   ✓ /api/auth/session > Token Management > validates access token structure and claims  390ms\n   ✓ /api/auth/session > Token Management > handles refresh token scenarios appropriately  373ms\n   ✓ /api/auth/session > Token Management > maintains session consistency across requests  363ms\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Compliance > meets API standards with proper authentication\nOnboarding step 1 completed for user d9516833-1d3b-4fc8-ac53-ecb697a3daa6\n\n ✓ tests/api/test-db/test-db.test.ts (12 tests) 9ms\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Compliance > follows REST API conventions\nOnboarding step 0 completed for user 69f3da90-c862-42fc-8ade-3b7bf1bbf88b\n\n ✓ tests/api/health/health.test.ts (12 tests) 8ms\n ✓ tests/api/onboarding/status/status.test.ts (10 tests) 2762ms\n   ✓ /api/onboarding/status > Core Functionality > handles GET requests with valid authentication  534ms\n   ✓ /api/onboarding/status > Core Functionality > returns consistent onboarding status data  341ms\n   ✓ /api/onboarding/status > Performance > responds within acceptable time with real authentication  379ms\n   ✓ /api/onboarding/status > Database Integrity > maintains data consistency with real database operations  390ms\n   ✓ /api/onboarding/status > Integration Scenarios > integrates with authentication workflow  356ms\n   ✓ /api/onboarding/status > Compliance > meets API standards with proper authentication  382ms\n   ✓ /api/onboarding/status > Edge Cases > handles edge cases appropriately  377ms\n ✓ tests/api/assets/[id]/documents/documents.test.ts (9 tests) 2346ms\n   ✓ /api/assets/[id]/documents > Core Functionality > handles GET requests with valid authentication  630ms\n   ✓ /api/assets/[id]/documents > Performance > responds within acceptable time with real authentication  456ms\n   ✓ /api/assets/[id]/documents > Database Integrity > maintains data consistency with real database operations  417ms\n   ✓ /api/assets/[id]/documents > Integration Scenarios > integrates with authentication workflow  420ms\n   ✓ /api/assets/[id]/documents > Compliance > meets API standards with proper authentication  419ms\n ✓ tests/api/documents/[id]/[id].test.ts (10 tests) 2508ms\n   ✓ /api/documents/[id] > Core Functionality > handles GET requests with valid authentication  565ms\n   ✓ /api/documents/[id] > Core Functionality > handles DELETE requests with authentication  405ms\n   ✓ /api/documents/[id] > Performance > responds within acceptable time with real authentication  387ms\n   ✓ /api/documents/[id] > Database Integrity > maintains data consistency with real database operations  391ms\n   ✓ /api/documents/[id] > Integration Scenarios > integrates with authentication workflow  375ms\n   ✓ /api/documents/[id] > Compliance > meets API standards with proper authentication  381ms\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Edge Cases > handles null data for non-personal info steps\nOnboarding step 1 completed for user f9d28a49-3777-4e81-a455-a3ba95c6eb88\n\n ✓ tests/api/onboarding/verification/sync/sync.test.ts (10 tests) 2800ms\n   ✓ /api/onboarding/verification/sync > Core Functionality > handles GET requests with valid authentication  617ms\n   ✓ /api/onboarding/verification/sync > Core Functionality > handles POST requests with valid data  430ms\n   ✓ /api/onboarding/verification/sync > Performance > responds within acceptable time with real authentication  450ms\n   ✓ /api/onboarding/verification/sync > Database Integrity > maintains data consistency with real database operations  445ms\n   ✓ /api/onboarding/verification/sync > Integration Scenarios > integrates with authentication workflow  417ms\n   ✓ /api/onboarding/verification/sync > Compliance > meets API standards with proper authentication  435ms\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Token Management > validates access token structure and claims\nOnboarding step 1 completed for user f642d086-903a-4e18-91f9-697009b8ff53\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Token Management > maintains session consistency across step saves\nOnboarding step 1 completed for user 604702c8-5d97-49cd-8f42-42f89cce1b36\n\nstdout | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Token Management > maintains session consistency across step saves\nOnboarding step 2 completed for user 604702c8-5d97-49cd-8f42-42f89cce1b36\n\n ✓ tests/api/onboarding/save-step/save-step.test.ts (23 tests) 9901ms\n   ✓ /api/onboarding/save-step > Core Functionality > handles POST requests with valid authentication  712ms\n   ✓ /api/onboarding/save-step > Core Functionality > saves step completion data correctly  505ms\n   ✓ /api/onboarding/save-step > Core Functionality > handles final step completion  528ms\n   ✓ /api/onboarding/save-step > Error States > validates step number range  392ms\n   ✓ /api/onboarding/save-step > Error States > validates step number type  373ms\n   ✓ /api/onboarding/save-step > Security > prevents data injection through step data  493ms\n   ✓ /api/onboarding/save-step > Performance > responds within acceptable time with real authentication  529ms\n   ✓ /api/onboarding/save-step > Performance > handles concurrent requests efficiently  677ms\n   ✓ /api/onboarding/save-step > Database Integrity > maintains user data consistency with real database operations  519ms\n   ✓ /api/onboarding/save-step > Database Integrity > creates proper audit trail for step completions  523ms\n   ✓ /api/onboarding/save-step > Integration Scenarios > integrates with onboarding progression workflow  518ms\n   ✓ /api/onboarding/save-step > Integration Scenarios > handles step progression through onboarding flow  779ms\n   ✓ /api/onboarding/save-step > Compliance > meets API standards with proper authentication  532ms\n   ✓ /api/onboarding/save-step > Compliance > follows REST API conventions  540ms\n   ✓ /api/onboarding/save-step > Edge Cases > handles requests with malformed JSON  386ms\n   ✓ /api/onboarding/save-step > Edge Cases > handles requests with missing step parameter  360ms\n   ✓ /api/onboarding/save-step > Edge Cases > handles null data for non-personal info steps  535ms\n   ✓ /api/onboarding/save-step > Token Management > validates access token structure and claims  481ms\n   ✓ /api/onboarding/save-step > Token Management > maintains session consistency across step saves  511ms\n ✓ tests/api/assets/assets.test.ts (21 tests) 11478ms\n   ✓ /api/assets > Core Functionality > handles GET requests to retrieve user assets  854ms\n   ✓ /api/assets > Core Functionality > handles POST requests to create new assets  490ms\n   ✓ /api/assets > Error States > returns 400 for POST with missing required fields  460ms\n   ✓ /api/assets > Error States > handles database errors gracefully  444ms\n   ✓ /api/assets > Security > prevents access to other users' assets  586ms\n   ✓ /api/assets > Security > validates asset type enum values  447ms\n   ✓ /api/assets > Security > prevents XSS in asset metadata  441ms\n   ✓ /api/assets > Performance > responds within acceptable time for asset retrieval  1594ms\n   ✓ /api/assets > Performance > handles concurrent asset creation efficiently  654ms\n   ✓ /api/assets > Database Integrity > maintains asset-user relationship integrity  485ms\n   ✓ /api/assets > Database Integrity > handles asset metadata JSON storage correctly  473ms\n   ✓ /api/assets > Integration Scenarios > integrates with asset categorization system  843ms\n   ✓ /api/assets > Integration Scenarios > supports asset valuation workflow  476ms\n   ✓ /api/assets > Compliance > meets API standards for asset management  602ms\n   ✓ /api/assets > Compliance > follows REST API conventions for assets  705ms\n   ✓ /api/assets > Edge Cases > handles assets with zero value  476ms\n   ✓ /api/assets > Edge Cases > handles very long asset names  409ms\n   ✓ /api/assets > Edge Cases > handles empty asset lists gracefully  552ms\n   ✓ /api/assets > Edge Cases > handles unicode characters in asset names  484ms\n\n Test Files  26 failed | 13 passed (39)\n      Tests  99 failed | 348 passed (447)\n   Start at  19:38:07\n   Duration  28.50s (transform 694ms, setup 8.64s, collect 14.99s, tests 139.15s, environment 9.84s, prepare 2.94s)\n\nstderr | tests/api/onboarding/signature/signature.test.ts > /api/onboarding > Edge Cases > handles malformed requests appropriately\nSignature save error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/signature/route.ts:74:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/signature/signature.test.ts:188:26\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/beneficiaries/beneficiaries.test.ts > /api/beneficiaries > Edge Cases > handles malformed requests appropriately\nError creating beneficiary: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/beneficiaries/route.ts:107:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/beneficiaries/beneficiaries.test.ts:188:26\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/rules.test.ts > /api/rules > Edge Cases > handles malformed JSON appropriately\nError creating rule: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/route.ts:130:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/rules.test.ts:148:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Core Functionality > handles GET requests with valid authentication\nError fetching rule: DrizzleQueryError: Failed query: select \"id\", \"user_id\", \"name\", \"description\", \"rule_definition\", \"priority\", \"is_active\", \"created_at\", \"updated_at\" from \"inheritance_rules\" where (\"inheritance_rules\".\"id\" = $1 and \"inheritance_rules\".\"user_id\" = $2)\nparams: test-id-123,\n    at PostgresJsPreparedQuery.queryWithCache \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/drizzle-orm@0.44.4_@types+pg@8.15.5_postgres@3.4.7/node_modules/\u001b[4msrc\u001b[24m/pg-core/session.ts:73:11\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/drizzle-orm@0.44.4_@types+pg@8.15.5_postgres@3.4.7/node_modules/\u001b[4msrc\u001b[24m/postgres-js/session.ts:58:17\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:54:20\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:27:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20 {\n  query: \u001b[32m'select \"id\", \"user_id\", \"name\", \"description\", \"rule_definition\", \"priority\", \"is_active\", \"created_at\", \"updated_at\" from \"inheritance_rules\" where (\"inheritance_rules\".\"id\" = $1 and \"inheritance_rules\".\"user_id\" = $2)'\u001b[39m,\n  params: [ \u001b[32m'test-id-123'\u001b[39m, \u001b[90mundefined\u001b[39m ],\n  cause: Error: UNDEFINED_VALUE: Undefined values are not allowed\n      at handleValue \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/types.js:83:20\u001b[90m)\u001b[39m\n      at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/connection.js:225:38\n      at Array.forEach (<anonymous>)\n      at build \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/connection.js:225:25\u001b[90m)\u001b[39m\n      at Object.execute \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/connection.js:167:7\u001b[90m)\u001b[39m\n      at go \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/index.js:345:14\u001b[90m)\u001b[39m\n      at Query.handler \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/index.js:334:14\u001b[90m)\u001b[39m\n      at Query.handle \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/query.js:140:65\u001b[90m)\u001b[39m\n  \u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m {\n    code: \u001b[32m'UNDEFINED_VALUE'\u001b[39m\n  }\n}\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Core Functionality > handles PUT requests with valid data\nError updating rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.PUT \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:108:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:43:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Core Functionality > handles DELETE requests with authentication\nError deleting rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.DELETE \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:267:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:52:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Error States > returns proper error for unauthenticated requests\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:64:27\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Security > requires valid JWT authentication\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:74:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Security > validates JWT signature integrity\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:87:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Performance > responds within acceptable time with real authentication\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:99:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Database Integrity > maintains data consistency with real database operations\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:112:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Integration Scenarios > integrates with authentication workflow\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:123:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/validate-allocation/validate-allocation.test.ts > /api/rules/validate-allocation > Edge Cases > handles malformed JSON appropriately\nError validating allocation: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/validate-allocation/route.ts:45:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/validate-allocation/validate-allocation.test.ts:148:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Compliance > meets API standards with proper authentication\nError fetching rule: TypeError: Cannot read properties of undefined (reading 'id')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/rules/[id]/route.ts:58:76\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/rules/[id]/[id].test.ts:134:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Edge Cases > handles requests with malformed JSON\nPersonal info save error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/personal-info/route.ts:184:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/personal-info/personal-info.test.ts:412:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Core Functionality > handles POST requests with valid data\nAudit logging error: DrizzleQueryError: Failed query: insert into \"audit_events\" (\"id\", \"user_id\", \"event_type\", \"event_action\", \"resource_type\", \"resource_id\", \"event_data\", \"old_data\", \"new_data\", \"ip_address\", \"user_agent\", \"session_id\", \"event_time\") values (default, $1, default, default, default, default, $2, default, default, $3, $4, default, default)\nparams: 2dfad42a-4d88-461d-88e8-b4d909ff4fe3,{},unknown,unknown\n    at PostgresJsPreparedQuery.queryWithCache \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/drizzle-orm@0.44.4_@types+pg@8.15.5_postgres@3.4.7/node_modules/\u001b[4msrc\u001b[24m/pg-core/session.ts:73:11\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/audit/log-event/route.ts:33:5\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/audit/log-event/log-event.test.ts:42:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20 {\n  query: \u001b[32m'insert into \"audit_events\" (\"id\", \"user_id\", \"event_type\", \"event_action\", \"resource_type\", \"resource_id\", \"event_data\", \"old_data\", \"new_data\", \"ip_address\", \"user_agent\", \"session_id\", \"event_time\") values (default, $1, default, default, default, default, $2, default, default, $3, $4, default, default)'\u001b[39m,\n  params: [\n    \u001b[32m'2dfad42a-4d88-461d-88e8-b4d909ff4fe3'\u001b[39m,\n    \u001b[32m'{}'\u001b[39m,\n    \u001b[32m'unknown'\u001b[39m,\n    \u001b[32m'unknown'\u001b[39m\n  ],\n  cause: PostgresError: null value in column \"event_type\" of relation \"audit_events\" violates not-null constraint\n      at ErrorResponse \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/connection.js:794:26\u001b[90m)\u001b[39m\n      at handle \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/connection.js:480:6\u001b[90m)\u001b[39m\n      at Socket.data \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/postgres@3.4.7/node_modules/\u001b[4mpostgres\u001b[24m/src/connection.js:315:9\u001b[90m)\u001b[39m\n  \u001b[90m    at Socket.emit (node:events:507:28)\u001b[39m\n  \u001b[90m    at addChunk (node:internal/streams/readable:559:12)\u001b[39m\n  \u001b[90m    at readableAddChunkPushByteMode (node:internal/streams/readable:510:3)\u001b[39m\n  \u001b[90m    at Socket.Readable.push (node:internal/streams/readable:390:5)\u001b[39m\n  \u001b[90m    at TCP.onStreamRead (node:internal/stream_base_commons:189:23)\u001b[39m {\n    severity_local: \u001b[32m'ERROR'\u001b[39m,\n    severity: \u001b[32m'ERROR'\u001b[39m,\n    code: \u001b[32m'23502'\u001b[39m,\n    detail: \u001b[32m'Failing row contains (b048ac34-226a-45ff-bc3d-2e1d3a5160dd, 2dfad42a-4d88-461d-88e8-b4d909ff4fe3, null, null, null, null, {}, null, null, unknown, unknown, null, 2025-09-04 18:38:18.516602).'\u001b[39m,\n    schema_name: \u001b[32m'public'\u001b[39m,\n    table_name: \u001b[32m'audit_events'\u001b[39m,\n    column_name: \u001b[32m'event_type'\u001b[39m,\n    file: \u001b[32m'execMain.c'\u001b[39m,\n    line: \u001b[32m'1982'\u001b[39m,\n    routine: \u001b[32m'ExecConstraints'\u001b[39m\n  }\n}\n\nstderr | tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Core Functionality > handles POST requests with valid data\nPhoto upload error: DOMException [InvalidStateError]: Failed to construct FormData object: The \"content-type\" header is neither \"application/x-www-form-urlencoded\" nor \"multipart/form-data\".\n    at NextRequest.formData \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:473:9\u001b[90m)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/beneficiaries/photo/route.ts:18:36\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/beneficiaries/photo/photo.test.ts:42:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Edge Cases > handles malformed JSON appropriately\nAudit logging error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/audit/log-event/route.ts:10:7\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/audit/log-event/log-event.test.ts:148:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Edge Cases > handles malformed JSON appropriately\nPhoto upload error: DOMException [InvalidStateError]: Failed to construct FormData object: The \"content-type\" header is neither \"application/x-www-form-urlencoded\" nor \"multipart/form-data\".\n    at NextRequest.formData \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:473:9\u001b[90m)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/beneficiaries/photo/route.ts:18:36\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/beneficiaries/photo/photo.test.ts:148:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Edge Cases > handles malformed JSON appropriately\nConsent signature save error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/consent-signature/route.ts:27:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/consent-signature/consent-signature.test.ts:148:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/auth/register/register.test.ts > /api/auth > Edge Cases > handles malformed requests appropriately\nRegistration error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at registerHandler \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/auth/register/route.ts:11:54\u001b[90m)\u001b[39m\n    at Module.<anonymous> \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/lib/rate-limit.ts:111:22\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/auth/register/register.test.ts:188:26\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/onboarding/photo/photo.test.ts > /api/onboarding > Core Functionality > handles POST requests with valid data\nPhoto upload error: DOMException [InvalidStateError]: Failed to construct FormData object: The \"content-type\" header is neither \"application/x-www-form-urlencoded\" nor \"multipart/form-data\".\n    at NextRequest.formData \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:473:9\u001b[90m)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/photo/route.ts:18:36\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/photo/photo.test.ts:52:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/auth/login/login.test.ts > /api/auth > Edge Cases > handles malformed requests appropriately\nLogin error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at loginHandler \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/auth/login/route.ts:11:33\u001b[90m)\u001b[39m\n    at Module.<anonymous> \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/lib/rate-limit.ts:111:22\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/auth/login/login.test.ts:188:26\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/onboarding/photo/photo.test.ts > /api/onboarding > Edge Cases > handles malformed requests appropriately\nPhoto upload error: DOMException [InvalidStateError]: Failed to construct FormData object: The \"content-type\" header is neither \"application/x-www-form-urlencoded\" nor \"multipart/form-data\".\n    at NextRequest.formData \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:473:9\u001b[90m)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/photo/route.ts:18:36\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/photo/photo.test.ts:188:26\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/assets/categories/categories.test.ts > /api/assets/categories > Edge Cases > handles edge cases appropriately\nAsset categories fetch error: TypeError: Cannot read properties of undefined (reading 'isAuthenticated')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/assets/categories/route.ts:16:18\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/assets/categories/categories.test.ts:134:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/test-db/test-db.test.ts > /api/test-db > Error States > handles database failures gracefully\nDatabase connection test failed: Error: Database connection failed\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/test-db/test-db.test.ts:112:23\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:155:11\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:26\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:1897:20\n    at new Promise (<anonymous>)\n    at runWithTimeout \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:1863:10\u001b[90m)\u001b[39m\n    at runTest \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:1574:12\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:1729:8\u001b[90m)\u001b[39m\n    at runSuite \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:1729:8\u001b[90m)\u001b[39m\n\nstderr | tests/api/test-db/test-db.test.ts > /api/test-db > Security > validates authentication when required\nDatabase connection test failed: TypeError: Cannot read properties of undefined (reading '0')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/test-db/route.ts:14:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/test-db/test-db.test.ts:144:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/test-db/test-db.test.ts > /api/test-db > Compliance > meets API standards\nDatabase connection test failed: TypeError: Cannot read properties of undefined (reading '0')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/test-db/route.ts:14:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/test-db/test-db.test.ts:223:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/test-db/test-db.test.ts > /api/test-db > Edge Cases > handles empty requests\nDatabase connection test failed: TypeError: Cannot read properties of undefined (reading '0')\n    at Module.GET \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/test-db/route.ts:14:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/test-db/test-db.test.ts:236:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\nstderr | tests/api/onboarding/save-step/save-step.test.ts > /api/onboarding/save-step > Edge Cases > handles requests with malformed JSON\nSave step error: SyntaxError: Unexpected token 'j', \"{\"malformed\": json}\" is not valid JSON\n    at JSON.parse (<anonymous>)\n    at NextRequest.json \u001b[90m(file:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/happy-dom@18.0.1/node_modules/\u001b[4mhappy-dom\u001b[24m/src/fetch/Request.ts:419:15\u001b[90m)\u001b[39m\n\u001b[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)\u001b[39m\n    at Module.POST \u001b[90m(/Users/dean/code/Herit/\u001b[39mapp/api/onboarding/save-step/route.ts:20:18\u001b[90m)\u001b[39m\n    at \u001b[90m/Users/dean/code/Herit/\u001b[39mtests/api/onboarding/save-step/save-step.test.ts:383:24\n    at \u001b[90mfile:///Users/dean/code/Herit/\u001b[39mnode_modules/\u001b[4m.pnpm\u001b[24m/@vitest+runner@3.2.4/node_modules/\u001b[4m@vitest\u001b[24m/runner/dist/chunk-hooks.js:752:20\n\n\n⎯⎯⎯⎯⎯⎯ Failed Tests 99 ⎯⎯⎯⎯⎯⎯⎯\n\n FAIL  tests/api/debug-user/debug-user.test.ts > /api/debug-user > Core Functionality > handles GET requests with valid authentication\nAssertionError: expected 400 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/debug-user/debug-user.test.ts:28:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/99]⎯\n\n FAIL  tests/api/debug-user/debug-user.test.ts > /api/debug-user > Core Functionality > handles POST requests with valid data\nTypeError: POST is not a function\n ❯ tests/api/debug-user/debug-user.test.ts:42:44\n     40|       }, authContext);\n     41| \n     42|       const response = await routeHandlers.POST(request);\n       |                                            ^\n     43|       \n     44|       TestAssertions.expectSuccessfulResponse(response);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/99]⎯\n\n FAIL  tests/api/debug-user/debug-user.test.ts > /api/debug-user > Error States > returns proper error for unauthenticated requests\nTypeError: POST is not a function\n ❯ tests/api/debug-user/debug-user.test.ts:61:48\n     59|         body: JSON.stringify({}),\n     60|       });\n     61|       const postResponse = await routeHandlers.POST(postRequest);\n       |                                                ^\n     62|       expect(postResponse.status).toBeGreaterThanOrEqual(400);\n     63|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/99]⎯\n\n FAIL  tests/api/debug-user/debug-user.test.ts > /api/debug-user > Edge Cases > handles malformed JSON appropriately\nTypeError: POST is not a function\n ❯ tests/api/debug-user/debug-user.test.ts:148:44\n    146|       }, authContext);\n    147| \n    148|       const response = await routeHandlers.POST(request);\n       |                                            ^\n    149|       expect(response).toBeDefined();\n    150|       expect(response.status).toBeGreaterThanOrEqual(400);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/99]⎯\n\n FAIL  tests/api/rules/rules.test.ts > /api/rules > Core Functionality > handles POST requests with valid data\nAssertionError: expected 400 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/rules/rules.test.ts:44:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/99]⎯\n\n FAIL  tests/api/beneficiaries/beneficiaries.test.ts > /api/beneficiaries > Core Functionality > handles POST requests with valid data\nAssertionError: expected 400 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/beneficiaries/beneficiaries.test.ts:53:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/99]⎯\n\n FAIL  tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Core Functionality > handles GET requests with valid authentication\nTypeError: GET is not a function\n ❯ tests/api/audit/log-event/log-event.test.ts:26:44\n     24|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n     25| \n     26|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     27|       \n     28|       TestAssertions.expectSuccessfulResponse(response);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/99]⎯\n\n FAIL  tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Error States > returns proper error for unauthenticated requests\nTypeError: GET is not a function\n ❯ tests/api/audit/log-event/log-event.test.ts:53:47\n     51|       \n     52|       const getRequest = new NextRequest(url, { method: 'GET' });\n     53|       const getResponse = await routeHandlers.GET(getRequest);\n       |                                               ^\n     54|       expect(getResponse.status).toBeGreaterThanOrEqual(400);\n     55|       \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/99]⎯\n\n FAIL  tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Security > requires valid JWT authentication\nTypeError: GET is not a function\n ❯ tests/api/audit/log-event/log-event.test.ts:71:44\n     69|       \n     70|       const request = new NextRequest(url, { method: 'GET' });\n     71|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     72|       expect(response.status).toBeGreaterThanOrEqual(400);\n     73|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/99]⎯\n\n FAIL  tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Security > validates JWT signature integrity\nTypeError: GET is not a function\n ❯ tests/api/audit/log-event/log-event.test.ts:84:44\n     82|         }\n     83|       });\n     84|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     85|       expect(response.status).toBeGreaterThanOrEqual(400);\n     86|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/99]⎯\n\n FAIL  tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Performance > responds within acceptable time with real authentication\nTypeError: GET is not a function\n ❯ tests/api/audit/log-event/log-event.test.ts:96:44\n     94| \n     95|       const startTime = performance.now();\n     96|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     97|       const responseTime = performance.now() - startTime;\n     98|       \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/99]⎯\n\n FAIL  tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Database Integrity > maintains data consistency with real database operations\nTypeError: GET is not a function\n ❯ tests/api/audit/log-event/log-event.test.ts:109:44\n    107|       \n    108|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    109|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    110|       \n    111|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/99]⎯\n\n FAIL  tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Integration Scenarios > integrates with authentication workflow\nTypeError: GET is not a function\n ❯ tests/api/audit/log-event/log-event.test.ts:120:44\n    118|       \n    119|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    120|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    121|       \n    122|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/99]⎯\n\n FAIL  tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Compliance > meets API standards with proper authentication\nTypeError: GET is not a function\n ❯ tests/api/audit/log-event/log-event.test.ts:131:44\n    129|       \n    130|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    131|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    132|       \n    133|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/99]⎯\n\n FAIL  tests/api/audit/log-event/log-event.test.ts > /api/audit/log-event > Edge Cases > handles malformed JSON appropriately\nAssertionError: expected 200 to be greater than or equal to 400\n ❯ tests/api/audit/log-event/log-event.test.ts:150:31\n    148|       const response = await routeHandlers.POST(request);\n    149|       expect(response).toBeDefined();\n    150|       expect(response.status).toBeGreaterThanOrEqual(400);\n       |                               ^\n    151|     });\n    152|   });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[15/99]⎯\n\n FAIL  tests/api/assets/categories/categories.test.ts > /api/assets/categories > Edge Cases > handles edge cases appropriately\nAssertionError: expected 500 to be less than 500\n ❯ tests/api/assets/categories/categories.test.ts:136:31\n    134|       const response = await routeHandlers.GET(new NextRequest('http:/…\n    135|       expect(response).toBeDefined();\n    136|       expect(response.status).toBeLessThan(500); // Should not crash\n       |                               ^\n    137|     });\n    138|   });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[16/99]⎯\n\n FAIL  tests/api/debug/verification/verification.test.ts > /api/debug/verification > Core Functionality > handles POST requests with valid data\nTypeError: POST is not a function\n ❯ tests/api/debug/verification/verification.test.ts:42:44\n     40|       }, authContext);\n     41| \n     42|       const response = await routeHandlers.POST(request);\n       |                                            ^\n     43|       \n     44|       TestAssertions.expectSuccessfulResponse(response);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[17/99]⎯\n\n FAIL  tests/api/debug/verification/verification.test.ts > /api/debug/verification > Error States > returns proper error for unauthenticated requests\nTypeError: POST is not a function\n ❯ tests/api/debug/verification/verification.test.ts:61:48\n     59|         body: JSON.stringify({}),\n     60|       });\n     61|       const postResponse = await routeHandlers.POST(postRequest);\n       |                                                ^\n     62|       expect(postResponse.status).toBeGreaterThanOrEqual(400);\n     63|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[18/99]⎯\n\n FAIL  tests/api/debug/verification/verification.test.ts > /api/debug/verification > Edge Cases > handles malformed JSON appropriately\nTypeError: POST is not a function\n ❯ tests/api/debug/verification/verification.test.ts:148:44\n    146|       }, authContext);\n    147| \n    148|       const response = await routeHandlers.POST(request);\n       |                                            ^\n    149|       expect(response).toBeDefined();\n    150|       expect(response.status).toBeGreaterThanOrEqual(400);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[19/99]⎯\n\n FAIL  tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Core Functionality > handles GET requests with valid authentication\nTypeError: GET is not a function\n ❯ tests/api/onboarding/consent-signature/consent-signature.test.ts:26:44\n     24|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n     25| \n     26|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     27|       \n     28|       TestAssertions.expectSuccessfulResponse(response);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[20/99]⎯\n\n FAIL  tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Core Functionality > handles POST requests with valid data\nAssertionError: expected 400 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/onboarding/consent-signature/consent-signature.test.ts:44:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[21/99]⎯\n\n FAIL  tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Error States > returns proper error for unauthenticated requests\nTypeError: GET is not a function\n ❯ tests/api/onboarding/consent-signature/consent-signature.test.ts:53:47\n     51|       \n     52|       const getRequest = new NextRequest(url, { method: 'GET' });\n     53|       const getResponse = await routeHandlers.GET(getRequest);\n       |                                               ^\n     54|       expect(getResponse.status).toBeGreaterThanOrEqual(400);\n     55|       \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[22/99]⎯\n\n FAIL  tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Security > requires valid JWT authentication\nTypeError: GET is not a function\n ❯ tests/api/onboarding/consent-signature/consent-signature.test.ts:71:44\n     69|       \n     70|       const request = new NextRequest(url, { method: 'GET' });\n     71|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     72|       expect(response.status).toBeGreaterThanOrEqual(400);\n     73|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[23/99]⎯\n\n FAIL  tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Security > validates JWT signature integrity\nTypeError: GET is not a function\n ❯ tests/api/onboarding/consent-signature/consent-signature.test.ts:84:44\n     82|         }\n     83|       });\n     84|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     85|       expect(response.status).toBeGreaterThanOrEqual(400);\n     86|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[24/99]⎯\n\n FAIL  tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Performance > responds within acceptable time with real authentication\nTypeError: GET is not a function\n ❯ tests/api/onboarding/consent-signature/consent-signature.test.ts:96:44\n     94| \n     95|       const startTime = performance.now();\n     96|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     97|       const responseTime = performance.now() - startTime;\n     98|       \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[25/99]⎯\n\n FAIL  tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Database Integrity > maintains data consistency with real database operations\nTypeError: GET is not a function\n ❯ tests/api/onboarding/consent-signature/consent-signature.test.ts:109:44\n    107|       \n    108|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    109|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    110|       \n    111|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[26/99]⎯\n\n FAIL  tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Integration Scenarios > integrates with authentication workflow\nTypeError: GET is not a function\n ❯ tests/api/onboarding/consent-signature/consent-signature.test.ts:120:44\n    118|       \n    119|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    120|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    121|       \n    122|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[27/99]⎯\n\n FAIL  tests/api/onboarding/consent-signature/consent-signature.test.ts > /api/onboarding/consent-signature > Compliance > meets API standards with proper authentication\nTypeError: GET is not a function\n ❯ tests/api/onboarding/consent-signature/consent-signature.test.ts:131:44\n    129|       \n    130|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    131|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    132|       \n    133|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[28/99]⎯\n\n FAIL  tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Security > prevents OAuth email tampering\nError: Failed query: insert into \"app_users\" (\"id\", \"email\", \"password_hash\", \"first_name\", \"last_name\", \"phone_number\", \"date_of_birth\", \"pps_number\", \"profile_photo_url\", \"address_line_1\", \"address_line_2\", \"city\", \"county\", \"eircode\", \"onboarding_status\", \"onboarding_current_step\", \"onboarding_completed_at\", \"personal_info_completed\", \"personal_info_completed_at\", \"signature_completed\", \"signature_completed_at\", \"legal_consent_completed\", \"legal_consent_completed_at\", \"legal_consents\", \"verification_completed\", \"verification_completed_at\", \"verification_session_id\", \"verification_status\", \"auth_provider\", \"auth_provider_id\", \"created_at\", \"updated_at\") values ($1, $2, default, $3, $4, default, default, default, default, default, default, default, default, default, default, default, default, $5, default, $6, default, $7, default, default, $8, default, default, $9, default, default, default, default) returning \"id\", \"email\", \"password_hash\", \"first_name\", \"last_name\", \"phone_number\", \"date_of_birth\", \"pps_number\", \"profile_photo_url\", \"address_line_1\", \"address_line_2\", \"city\", \"county\", \"eircode\", \"onboarding_status\", \"onboarding_current_step\", \"onboarding_completed_at\", \"personal_info_completed\", \"personal_info_completed_at\", \"signature_completed\", \"signature_completed_at\", \"legal_consent_completed\", \"legal_consent_completed_at\", \"legal_consents\", \"verification_completed\", \"verification_completed_at\", \"verification_session_id\", \"verification_status\", \"onboarding_completed\", \"auth_provider\", \"auth_provider_id\", \"created_at\", \"updated_at\"\nparams: 8701e781-5a43-4ae8-becd-1b0819e6ddaa,original@example.com,Test,User,true,true,true,true,verified\n ❯ PostgresJsPreparedQuery.queryWithCache node_modules/.pnpm/drizzle-orm@0.44.4_@types+pg@8.15.5_postgres@3.4.7/node_modules/src/pg-core/session.ts:73:11\n ❯ node_modules/.pnpm/drizzle-orm@0.44.4_@types+pg@8.15.5_postgres@3.4.7/node_modules/src/postgres-js/session.ts:58:17\n ❯ Function.createTestUser tests/test-database-utils.ts:35:20\n     33|     verification_status?: string;\n     34|   }) {\n     35|     const [user] = await db.insert(users).values({\n       |                    ^\n     36|       id: randomUUID(),\n     37|       email: userData.email,\n ❯ Function.createAuthenticatedTestUser tests/test-auth-utils.ts:55:18\n ❯ setupAuthenticatedTest tests/test-setup-real-auth.ts:30:23\n ❯ tests/api/onboarding/personal-info/personal-info.test.ts:191:27\n\nCaused by: PostgresError: duplicate key value violates unique constraint \"app_users_email_unique\"\n ❯ ErrorResponse node_modules/.pnpm/postgres@3.4.7/node_modules/postgres/src/connection.js:794:26\n ❯ handle node_modules/.pnpm/postgres@3.4.7/node_modules/postgres/src/connection.js:480:6\n ❯ Socket.data node_modules/.pnpm/postgres@3.4.7/node_modules/postgres/src/connection.js:315:9\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯\nSerialized Error: { severity_local: 'ERROR', severity: 'ERROR', code: '23505', detail: 'Key (email)=(original@example.com) already exists.', schema_name: 'public', table_name: 'app_users', constraint_name: 'app_users_email_unique', file: 'nbtinsert.c', routine: '_bt_check_unique', query: 'insert into \"app_users\" (\"id\", \"email\", \"password_hash\", \"first_name\", \"last_name\", \"phone_number\", \"date_of_birth\", \"pps_number\", \"profile_photo_url\", \"address_line_1\", \"address_line_2\", \"city\", \"county\", \"eircode\", \"onboarding_status\", \"onboarding_current_step\", \"onboarding_completed_at\", \"personal_info_completed\", \"personal_info_completed_at\", \"signature_completed\", \"signature_completed_at\", \"legal_consent_completed\", \"legal_consent_completed_at\", \"legal_consents\", \"verification_completed\", \"verification_completed_at\", \"verification_session_id\", \"verification_status\", \"auth_provider\", \"auth_provider_id\", \"created_at\", \"updated_at\") values ($1, $2, default, $3, $4, default, default, default, default, default, default, default, default, default, default, default, default, $5, default, $6, default, $7, default, default, $8, default, default, $9, default, default, default, default) returning \"id\", \"email\", \"password_hash\", \"first_name\", \"last_name\", \"phone_number\", \"date_of_birth\", \"pps_number\", \"profile_photo_url\", \"address_line_1\", \"address_line_2\", \"city\", \"county\", \"eircode\", \"onboarding_status\", \"onboarding_current_step\", \"onboarding_completed_at\", \"personal_info_completed\", \"personal_info_completed_at\", \"signature_completed\", \"signature_completed_at\", \"legal_consent_completed\", \"legal_consent_completed_at\", \"legal_consents\", \"verification_completed\", \"verification_completed_at\", \"verification_session_id\", \"verification_status\", \"onboarding_completed\", \"auth_provider\", \"auth_provider_id\", \"created_at\", \"updated_at\"', parameters: [ '8701e781-5a43-4ae8-becd-1b0819e6ddaa', 'original@example.com', 'Test', 'User', 't', 't', 't', 't', 'verified' ], args: [ '8701e781-5a43-4ae8-becd-1b0819e6ddaa', 'original@example.com', 'Test', 'User', true, true, true, true, 'verified' ], types: [ 2950, 1043, 1043, 1043, 16, 16, 16, 16, 46250 ] }\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[29/99]⎯\n\n FAIL  tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Integration Scenarios > integrates with OAuth data source tracking\nAssertionError: expected false to be true // Object.is equality\n\n\u001b[32m- Expected\u001b[39m\n\u001b[31m+ Received\u001b[39m\n\n\u001b[32m- true\u001b[39m\n\u001b[31m+ false\u001b[39m\n\n ❯ tests/api/onboarding/personal-info/personal-info.test.ts:315:42\n    313|       \n    314|       const data = await response.json();\n    315|       expect(data.dataSource.from_oauth).toBe(true);\n       |                                          ^\n    316|       expect(data.dataSource.provider).toBe('google');\n    317|       expect(data.dataSource.has_profile_photo).toBe(true);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[30/99]⎯\n\n FAIL  tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Compliance > validates Irish compliance requirements\nAssertionError: expected 400 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/onboarding/personal-info/personal-info.test.ts:399:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[31/99]⎯\n\n FAIL  tests/api/onboarding/personal-info/personal-info.test.ts > /api/onboarding/personal-info > Edge Cases > handles users with incomplete profile data\nAssertionError: expected 'Test' to be '' // Object.is equality\n\n\u001b[32m- Expected\u001b[39m\n\u001b[31m+ Received\u001b[39m\n\n\u001b[31m+ Test\u001b[39m\n\n ❯ tests/api/onboarding/personal-info/personal-info.test.ts:461:44\n    459|       \n    460|       const data = await response.json();\n    461|       expect(data.personalInfo.first_name).toBe('');\n       |                                            ^\n    462|       expect(data.personalInfo.last_name).toBe('');\n    463|       expect(data.personalInfo.phone_number).toBe('');\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[32/99]⎯\n\n FAIL  tests/api/onboarding/photo/photo.test.ts > /api/onboarding > Core Functionality > handles POST requests with valid data\nAssertionError: expected 500 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/onboarding/photo/photo.test.ts:53:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[33/99]⎯\n\n FAIL  tests/api/onboarding/signature/signature.test.ts > /api/onboarding > Core Functionality > handles POST requests with valid data\nAssertionError: expected 400 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/onboarding/signature/signature.test.ts:53:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[34/99]⎯\n\n FAIL  tests/api/onboarding/verification/verification.test.ts > /api/onboarding > Core Functionality > handles POST requests with valid data\nAssertionError: expected 400 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/onboarding/verification/verification.test.ts:53:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[35/99]⎯\n\n FAIL  tests/api/stripe/webhook/webhook.test.ts > /api/stripe/webhook > Core Functionality > handles POST requests with valid data\nAssertionError: expected 400 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/stripe/webhook/webhook.test.ts:33:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[36/99]⎯\n\n FAIL  tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Core Functionality > handles GET requests with valid authentication\nAssertionError: expected 500 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/rules/[id]/[id].test.ts:29:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[37/99]⎯\n\n FAIL  tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Core Functionality > handles PUT requests with valid data\nAssertionError: expected 500 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/rules/[id]/[id].test.ts:45:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[38/99]⎯\n\n FAIL  tests/api/rules/[id]/[id].test.ts > /api/rules/[id] > Core Functionality > handles DELETE requests with authentication\nAssertionError: expected 500 to be less than 500\n ❯ tests/api/rules/[id]/[id].test.ts:55:31\n     53|       \n     54|       expect(response).toBeDefined();\n     55|       expect(response.status).toBeLessThan(500);\n       |                               ^\n     56|     });\n     57|   });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[39/99]⎯\n\n FAIL  tests/api/rules/validate-allocation/validate-allocation.test.ts > /api/rules/validate-allocation > Core Functionality > handles GET requests with valid authentication\nTypeError: GET is not a function\n ❯ tests/api/rules/validate-allocation/validate-allocation.test.ts:26:44\n     24|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n     25| \n     26|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     27|       \n     28|       TestAssertions.expectSuccessfulResponse(response);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[40/99]⎯\n\n FAIL  tests/api/rules/validate-allocation/validate-allocation.test.ts > /api/rules/validate-allocation > Core Functionality > handles POST requests with valid data\nAssertionError: expected 400 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/rules/validate-allocation/validate-allocation.test.ts:44:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[41/99]⎯\n\n FAIL  tests/api/rules/validate-allocation/validate-allocation.test.ts > /api/rules/validate-allocation > Error States > returns proper error for unauthenticated requests\nTypeError: GET is not a function\n ❯ tests/api/rules/validate-allocation/validate-allocation.test.ts:53:47\n     51|       \n     52|       const getRequest = new NextRequest(url, { method: 'GET' });\n     53|       const getResponse = await routeHandlers.GET(getRequest);\n       |                                               ^\n     54|       expect(getResponse.status).toBeGreaterThanOrEqual(400);\n     55|       \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[42/99]⎯\n\n FAIL  tests/api/rules/validate-allocation/validate-allocation.test.ts > /api/rules/validate-allocation > Security > requires valid JWT authentication\nTypeError: GET is not a function\n ❯ tests/api/rules/validate-allocation/validate-allocation.test.ts:71:44\n     69|       \n     70|       const request = new NextRequest(url, { method: 'GET' });\n     71|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     72|       expect(response.status).toBeGreaterThanOrEqual(400);\n     73|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[43/99]⎯\n\n FAIL  tests/api/rules/validate-allocation/validate-allocation.test.ts > /api/rules/validate-allocation > Security > validates JWT signature integrity\nTypeError: GET is not a function\n ❯ tests/api/rules/validate-allocation/validate-allocation.test.ts:84:44\n     82|         }\n     83|       });\n     84|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     85|       expect(response.status).toBeGreaterThanOrEqual(400);\n     86|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[44/99]⎯\n\n FAIL  tests/api/rules/validate-allocation/validate-allocation.test.ts > /api/rules/validate-allocation > Performance > responds within acceptable time with real authentication\nTypeError: GET is not a function\n ❯ tests/api/rules/validate-allocation/validate-allocation.test.ts:96:44\n     94| \n     95|       const startTime = performance.now();\n     96|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     97|       const responseTime = performance.now() - startTime;\n     98|       \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[45/99]⎯\n\n FAIL  tests/api/rules/validate-allocation/validate-allocation.test.ts > /api/rules/validate-allocation > Database Integrity > maintains data consistency with real database operations\nTypeError: GET is not a function\n ❯ tests/api/rules/validate-allocation/validate-allocation.test.ts:109:44\n    107|       \n    108|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    109|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    110|       \n    111|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[46/99]⎯\n\n FAIL  tests/api/rules/validate-allocation/validate-allocation.test.ts > /api/rules/validate-allocation > Integration Scenarios > integrates with authentication workflow\nTypeError: GET is not a function\n ❯ tests/api/rules/validate-allocation/validate-allocation.test.ts:120:44\n    118|       \n    119|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    120|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    121|       \n    122|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[47/99]⎯\n\n FAIL  tests/api/rules/validate-allocation/validate-allocation.test.ts > /api/rules/validate-allocation > Compliance > meets API standards with proper authentication\nTypeError: GET is not a function\n ❯ tests/api/rules/validate-allocation/validate-allocation.test.ts:131:44\n    129|       \n    130|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    131|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    132|       \n    133|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[48/99]⎯\n\n FAIL  tests/api/will/status/status.test.ts > /api/will/status > Core Functionality > handles POST requests with valid data\nAssertionError: expected 404 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/will/status/status.test.ts:44:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[49/99]⎯\n\n FAIL  tests/api/beneficiaries/count/count.test.ts > /api/beneficiaries/count > Edge Cases > handles edge cases appropriately\nAssertionError: expected 500 to be less than 500\n ❯ tests/api/beneficiaries/count/count.test.ts:136:31\n    134|       const response = await routeHandlers.GET(new NextRequest('http:/…\n    135|       expect(response).toBeDefined();\n    136|       expect(response.status).toBeLessThan(500); // Should not crash\n       |                               ^\n    137|     });\n    138|   });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[50/99]⎯\n\n FAIL  tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Core Functionality > handles GET requests with valid authentication\nTypeError: GET is not a function\n ❯ tests/api/beneficiaries/photo/photo.test.ts:26:44\n     24|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n     25| \n     26|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     27|       \n     28|       TestAssertions.expectSuccessfulResponse(response);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[51/99]⎯\n\n FAIL  tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Core Functionality > handles POST requests with valid data\nAssertionError: expected 500 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/beneficiaries/photo/photo.test.ts:44:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[52/99]⎯\n\n FAIL  tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Error States > returns proper error for unauthenticated requests\nTypeError: GET is not a function\n ❯ tests/api/beneficiaries/photo/photo.test.ts:53:47\n     51|       \n     52|       const getRequest = new NextRequest(url, { method: 'GET' });\n     53|       const getResponse = await routeHandlers.GET(getRequest);\n       |                                               ^\n     54|       expect(getResponse.status).toBeGreaterThanOrEqual(400);\n     55|       \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[53/99]⎯\n\n FAIL  tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Security > requires valid JWT authentication\nTypeError: GET is not a function\n ❯ tests/api/beneficiaries/photo/photo.test.ts:71:44\n     69|       \n     70|       const request = new NextRequest(url, { method: 'GET' });\n     71|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     72|       expect(response.status).toBeGreaterThanOrEqual(400);\n     73|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[54/99]⎯\n\n FAIL  tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Security > validates JWT signature integrity\nTypeError: GET is not a function\n ❯ tests/api/beneficiaries/photo/photo.test.ts:84:44\n     82|         }\n     83|       });\n     84|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     85|       expect(response.status).toBeGreaterThanOrEqual(400);\n     86|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[55/99]⎯\n\n FAIL  tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Performance > responds within acceptable time with real authentication\nTypeError: GET is not a function\n ❯ tests/api/beneficiaries/photo/photo.test.ts:96:44\n     94| \n     95|       const startTime = performance.now();\n     96|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     97|       const responseTime = performance.now() - startTime;\n     98|       \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[56/99]⎯\n\n FAIL  tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Database Integrity > maintains data consistency with real database operations\nTypeError: GET is not a function\n ❯ tests/api/beneficiaries/photo/photo.test.ts:109:44\n    107|       \n    108|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    109|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    110|       \n    111|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[57/99]⎯\n\n FAIL  tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Integration Scenarios > integrates with authentication workflow\nTypeError: GET is not a function\n ❯ tests/api/beneficiaries/photo/photo.test.ts:120:44\n    118|       \n    119|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    120|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    121|       \n    122|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[58/99]⎯\n\n FAIL  tests/api/beneficiaries/photo/photo.test.ts > /api/beneficiaries/photo > Compliance > meets API standards with proper authentication\nTypeError: GET is not a function\n ❯ tests/api/beneficiaries/photo/photo.test.ts:131:44\n    129|       \n    130|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    131|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    132|       \n    133|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[59/99]⎯\n\n FAIL  tests/api/auth/create-test-user/create-test-user.test.ts > /api/auth/create-test-user > Error States > returns proper error for unauthenticated requests\nAssertionError: expected 200 to be greater than or equal to 400\n ❯ tests/api/auth/create-test-user/create-test-user.test.ts:54:34\n     52|       const getRequest = new NextRequest(url, { method: 'GET' });\n     53|       const getResponse = await routeHandlers.GET(getRequest);\n     54|       expect(getResponse.status).toBeGreaterThanOrEqual(400);\n       |                                  ^\n     55|       \n     56|       const postRequest = new NextRequest(url, {\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[60/99]⎯\n\n FAIL  tests/api/auth/create-test-user/create-test-user.test.ts > /api/auth/create-test-user > Security > requires valid JWT authentication\nAssertionError: expected 200 to be greater than or equal to 400\n ❯ tests/api/auth/create-test-user/create-test-user.test.ts:72:31\n     70|       const request = new NextRequest(url, { method: 'GET' });\n     71|       const response = await routeHandlers.GET(request);\n     72|       expect(response.status).toBeGreaterThanOrEqual(400);\n       |                               ^\n     73|     });\n     74| \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[61/99]⎯\n\n FAIL  tests/api/auth/create-test-user/create-test-user.test.ts > /api/auth/create-test-user > Security > validates JWT signature integrity\nAssertionError: expected 200 to be greater than or equal to 400\n ❯ tests/api/auth/create-test-user/create-test-user.test.ts:85:31\n     83|       });\n     84|       const response = await routeHandlers.GET(request);\n     85|       expect(response.status).toBeGreaterThanOrEqual(400);\n       |                               ^\n     86|     });\n     87|   });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[62/99]⎯\n\n FAIL  tests/api/auth/create-test-user/create-test-user.test.ts > /api/auth/create-test-user > Edge Cases > handles malformed JSON appropriately\nAssertionError: expected 200 to be greater than or equal to 400\n ❯ tests/api/auth/create-test-user/create-test-user.test.ts:150:31\n    148|       const response = await routeHandlers.POST(request);\n    149|       expect(response).toBeDefined();\n    150|       expect(response.status).toBeGreaterThanOrEqual(400);\n       |                               ^\n    151|     });\n    152|   });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[63/99]⎯\n\n FAIL  tests/api/auth/google/google.test.ts > /api/auth/google > Core Functionality > handles GET requests with valid authentication\nAssertionError: expected 307 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/auth/google/google.test.ts:28:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[64/99]⎯\n\n FAIL  tests/api/auth/google/google.test.ts > /api/auth/google > Core Functionality > handles POST requests with valid data\nTypeError: POST is not a function\n ❯ tests/api/auth/google/google.test.ts:42:44\n     40|       }, authContext);\n     41| \n     42|       const response = await routeHandlers.POST(request);\n       |                                            ^\n     43|       \n     44|       TestAssertions.expectSuccessfulResponse(response);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[65/99]⎯\n\n FAIL  tests/api/auth/google/google.test.ts > /api/auth/google > Error States > returns proper error for unauthenticated requests\nAssertionError: expected 307 to be greater than or equal to 400\n ❯ tests/api/auth/google/google.test.ts:54:34\n     52|       const getRequest = new NextRequest(url, { method: 'GET' });\n     53|       const getResponse = await routeHandlers.GET(getRequest);\n     54|       expect(getResponse.status).toBeGreaterThanOrEqual(400);\n       |                                  ^\n     55|       \n     56|       const postRequest = new NextRequest(url, {\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[66/99]⎯\n\n FAIL  tests/api/auth/google/google.test.ts > /api/auth/google > Security > requires valid JWT authentication\nAssertionError: expected 307 to be greater than or equal to 400\n ❯ tests/api/auth/google/google.test.ts:72:31\n     70|       const request = new NextRequest(url, { method: 'GET' });\n     71|       const response = await routeHandlers.GET(request);\n     72|       expect(response.status).toBeGreaterThanOrEqual(400);\n       |                               ^\n     73|     });\n     74| \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[67/99]⎯\n\n FAIL  tests/api/auth/google/google.test.ts > /api/auth/google > Security > validates JWT signature integrity\nAssertionError: expected 307 to be greater than or equal to 400\n ❯ tests/api/auth/google/google.test.ts:85:31\n     83|       });\n     84|       const response = await routeHandlers.GET(request);\n     85|       expect(response.status).toBeGreaterThanOrEqual(400);\n       |                               ^\n     86|     });\n     87|   });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[68/99]⎯\n\n FAIL  tests/api/auth/google/google.test.ts > /api/auth/google > Edge Cases > handles malformed JSON appropriately\nTypeError: POST is not a function\n ❯ tests/api/auth/google/google.test.ts:148:44\n    146|       }, authContext);\n    147| \n    148|       const response = await routeHandlers.POST(request);\n       |                                            ^\n    149|       expect(response).toBeDefined();\n    150|       expect(response.status).toBeGreaterThanOrEqual(400);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[69/99]⎯\n\n FAIL  tests/api/auth/login/login.test.ts > /api/auth > Core Functionality > handles POST requests with valid data\nAssertionError: expected 400 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/auth/login/login.test.ts:53:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[70/99]⎯\n\n FAIL  tests/api/auth/logout/logout.test.ts > /api/auth/logout > Core Functionality > handles GET requests with valid authentication\nTypeError: GET is not a function\n ❯ tests/api/auth/logout/logout.test.ts:26:44\n     24|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n     25| \n     26|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     27|       \n     28|       TestAssertions.expectSuccessfulResponse(response);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[71/99]⎯\n\n FAIL  tests/api/auth/logout/logout.test.ts > /api/auth/logout > Error States > returns proper error for unauthenticated requests\nTypeError: GET is not a function\n ❯ tests/api/auth/logout/logout.test.ts:53:47\n     51|       \n     52|       const getRequest = new NextRequest(url, { method: 'GET' });\n     53|       const getResponse = await routeHandlers.GET(getRequest);\n       |                                               ^\n     54|       expect(getResponse.status).toBeGreaterThanOrEqual(400);\n     55|       \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[72/99]⎯\n\n FAIL  tests/api/auth/logout/logout.test.ts > /api/auth/logout > Security > requires valid JWT authentication\nTypeError: GET is not a function\n ❯ tests/api/auth/logout/logout.test.ts:71:44\n     69|       \n     70|       const request = new NextRequest(url, { method: 'GET' });\n     71|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     72|       expect(response.status).toBeGreaterThanOrEqual(400);\n     73|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[73/99]⎯\n\n FAIL  tests/api/auth/logout/logout.test.ts > /api/auth/logout > Security > validates JWT signature integrity\nTypeError: GET is not a function\n ❯ tests/api/auth/logout/logout.test.ts:84:44\n     82|         }\n     83|       });\n     84|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     85|       expect(response.status).toBeGreaterThanOrEqual(400);\n     86|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[74/99]⎯\n\n FAIL  tests/api/auth/logout/logout.test.ts > /api/auth/logout > Performance > responds within acceptable time with real authentication\nTypeError: GET is not a function\n ❯ tests/api/auth/logout/logout.test.ts:96:44\n     94| \n     95|       const startTime = performance.now();\n     96|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     97|       const responseTime = performance.now() - startTime;\n     98|       \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[75/99]⎯\n\n FAIL  tests/api/auth/logout/logout.test.ts > /api/auth/logout > Database Integrity > maintains data consistency with real database operations\nTypeError: GET is not a function\n ❯ tests/api/auth/logout/logout.test.ts:109:44\n    107|       \n    108|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    109|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    110|       \n    111|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[76/99]⎯\n\n FAIL  tests/api/auth/logout/logout.test.ts > /api/auth/logout > Integration Scenarios > integrates with authentication workflow\nTypeError: GET is not a function\n ❯ tests/api/auth/logout/logout.test.ts:120:44\n    118|       \n    119|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    120|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    121|       \n    122|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[77/99]⎯\n\n FAIL  tests/api/auth/logout/logout.test.ts > /api/auth/logout > Compliance > meets API standards with proper authentication\nTypeError: GET is not a function\n ❯ tests/api/auth/logout/logout.test.ts:131:44\n    129|       \n    130|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    131|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    132|       \n    133|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[78/99]⎯\n\n FAIL  tests/api/auth/logout/logout.test.ts > /api/auth/logout > Edge Cases > handles malformed JSON appropriately\nAssertionError: expected 200 to be greater than or equal to 400\n ❯ tests/api/auth/logout/logout.test.ts:150:31\n    148|       const response = await routeHandlers.POST(request);\n    149|       expect(response).toBeDefined();\n    150|       expect(response.status).toBeGreaterThanOrEqual(400);\n       |                               ^\n    151|     });\n    152|   });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[79/99]⎯\n\n FAIL  tests/api/auth/refresh/refresh.test.ts > /api/auth > Core Functionality > handles POST requests with valid data\nAssertionError: expected 401 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/auth/refresh/refresh.test.ts:53:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[80/99]⎯\n\n FAIL  tests/api/auth/register/register.test.ts > /api/auth > Core Functionality > handles POST requests with valid data\nAssertionError: expected 400 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/auth/register/register.test.ts:53:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[81/99]⎯\n\n FAIL  tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Core Functionality > handles GET requests with valid authentication\nTypeError: GET is not a function\n ❯ tests/api/onboarding/complete/complete.test.ts:26:44\n     24|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n     25| \n     26|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     27|       \n     28|       TestAssertions.expectSuccessfulResponse(response);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[82/99]⎯\n\n FAIL  tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Error States > returns proper error for unauthenticated requests\nTypeError: GET is not a function\n ❯ tests/api/onboarding/complete/complete.test.ts:53:47\n     51|       \n     52|       const getRequest = new NextRequest(url, { method: 'GET' });\n     53|       const getResponse = await routeHandlers.GET(getRequest);\n       |                                               ^\n     54|       expect(getResponse.status).toBeGreaterThanOrEqual(400);\n     55|       \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[83/99]⎯\n\n FAIL  tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Security > requires valid JWT authentication\nTypeError: GET is not a function\n ❯ tests/api/onboarding/complete/complete.test.ts:71:44\n     69|       \n     70|       const request = new NextRequest(url, { method: 'GET' });\n     71|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     72|       expect(response.status).toBeGreaterThanOrEqual(400);\n     73|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[84/99]⎯\n\n FAIL  tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Security > validates JWT signature integrity\nTypeError: GET is not a function\n ❯ tests/api/onboarding/complete/complete.test.ts:84:44\n     82|         }\n     83|       });\n     84|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     85|       expect(response.status).toBeGreaterThanOrEqual(400);\n     86|     });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[85/99]⎯\n\n FAIL  tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Performance > responds within acceptable time with real authentication\nTypeError: GET is not a function\n ❯ tests/api/onboarding/complete/complete.test.ts:96:44\n     94| \n     95|       const startTime = performance.now();\n     96|       const response = await routeHandlers.GET(request);\n       |                                            ^\n     97|       const responseTime = performance.now() - startTime;\n     98|       \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[86/99]⎯\n\n FAIL  tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Database Integrity > maintains data consistency with real database operations\nTypeError: GET is not a function\n ❯ tests/api/onboarding/complete/complete.test.ts:109:44\n    107|       \n    108|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    109|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    110|       \n    111|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[87/99]⎯\n\n FAIL  tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Integration Scenarios > integrates with authentication workflow\nTypeError: GET is not a function\n ❯ tests/api/onboarding/complete/complete.test.ts:120:44\n    118|       \n    119|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    120|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    121|       \n    122|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[88/99]⎯\n\n FAIL  tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Compliance > meets API standards with proper authentication\nTypeError: GET is not a function\n ❯ tests/api/onboarding/complete/complete.test.ts:131:44\n    129|       \n    130|       const request = createAuthenticatedRequest(url, { method: 'GET' …\n    131|       const response = await routeHandlers.GET(request);\n       |                                            ^\n    132|       \n    133|       expect(response).toBeDefined();\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[89/99]⎯\n\n FAIL  tests/api/onboarding/complete/complete.test.ts > /api/onboarding/complete > Edge Cases > handles malformed JSON appropriately\nAssertionError: expected 200 to be greater than or equal to 400\n ❯ tests/api/onboarding/complete/complete.test.ts:150:31\n    148|       const response = await routeHandlers.POST(request);\n    149|       expect(response).toBeDefined();\n    150|       expect(response.status).toBeGreaterThanOrEqual(400);\n       |                               ^\n    151|     });\n    152|   });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[90/99]⎯\n\n FAIL  tests/api/documents/requirements/[type]/[type].test.ts > /api/documents/requirements/[type] > Error States > returns proper error for unauthenticated requests\nAssertionError: expected 200 to be greater than or equal to 400\n ❯ tests/api/documents/requirements/[type]/[type].test.ts:54:34\n     52|       const getRequest = new NextRequest(url, { method: 'GET' });\n     53|       const getResponse = await routeHandlers.GET(getRequest, { params…\n     54|       expect(getResponse.status).toBeGreaterThanOrEqual(400);\n       |                                  ^\n     55|       \n     56|       // This route only supports GET\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[91/99]⎯\n\n FAIL  tests/api/documents/requirements/[type]/[type].test.ts > /api/documents/requirements/[type] > Security > requires valid JWT authentication\nAssertionError: expected 200 to be greater than or equal to 400\n ❯ tests/api/documents/requirements/[type]/[type].test.ts:66:31\n     64|       const request = new NextRequest(url, { method: 'GET' });\n     65|       const response = await routeHandlers.GET(request, { params: Prom…\n     66|       expect(response.status).toBeGreaterThanOrEqual(400);\n       |                               ^\n     67|     });\n     68| \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[92/99]⎯\n\n FAIL  tests/api/documents/requirements/[type]/[type].test.ts > /api/documents/requirements/[type] > Security > validates JWT signature integrity\nAssertionError: expected 200 to be greater than or equal to 400\n ❯ tests/api/documents/requirements/[type]/[type].test.ts:79:31\n     77|       });\n     78|       const response = await routeHandlers.GET(request, { params: Prom…\n     79|       expect(response.status).toBeGreaterThanOrEqual(400);\n       |                               ^\n     80|     });\n     81|   });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[93/99]⎯\n\n FAIL  tests/api/auth/google/callback/callback.test.ts > /api/auth/google/callback > Core Functionality > handles GET requests with valid authentication\nAssertionError: expected 307 to be less than 300\n ❯ Object.expectSuccessfulResponse tests/test-setup-real-auth.ts:238:29\n    236|   expectSuccessfulResponse(response: Response) {\n    237|     expect(response.status).toBeGreaterThanOrEqual(200);\n    238|     expect(response.status).toBeLessThan(300);\n       |                             ^\n    239|   },\n    240|   \n ❯ tests/api/auth/google/callback/callback.test.ts:28:22\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[94/99]⎯\n\n FAIL  tests/api/auth/google/callback/callback.test.ts > /api/auth/google/callback > Core Functionality > handles POST requests with valid data\nTypeError: POST is not a function\n ❯ tests/api/auth/google/callback/callback.test.ts:42:44\n     40|       }, authContext);\n     41| \n     42|       const response = await routeHandlers.POST(request);\n       |                                            ^\n     43|       \n     44|       TestAssertions.expectSuccessfulResponse(response);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[95/99]⎯\n\n FAIL  tests/api/auth/google/callback/callback.test.ts > /api/auth/google/callback > Error States > returns proper error for unauthenticated requests\nAssertionError: expected 307 to be greater than or equal to 400\n ❯ tests/api/auth/google/callback/callback.test.ts:54:34\n     52|       const getRequest = new NextRequest(url, { method: 'GET' });\n     53|       const getResponse = await routeHandlers.GET(getRequest);\n     54|       expect(getResponse.status).toBeGreaterThanOrEqual(400);\n       |                                  ^\n     55|       \n     56|       const postRequest = new NextRequest(url, {\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[96/99]⎯\n\n FAIL  tests/api/auth/google/callback/callback.test.ts > /api/auth/google/callback > Security > requires valid JWT authentication\nAssertionError: expected 307 to be greater than or equal to 400\n ❯ tests/api/auth/google/callback/callback.test.ts:72:31\n     70|       const request = new NextRequest(url, { method: 'GET' });\n     71|       const response = await routeHandlers.GET(request);\n     72|       expect(response.status).toBeGreaterThanOrEqual(400);\n       |                               ^\n     73|     });\n     74| \n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[97/99]⎯\n\n FAIL  tests/api/auth/google/callback/callback.test.ts > /api/auth/google/callback > Security > validates JWT signature integrity\nAssertionError: expected 307 to be greater than or equal to 400\n ❯ tests/api/auth/google/callback/callback.test.ts:85:31\n     83|       });\n     84|       const response = await routeHandlers.GET(request);\n     85|       expect(response.status).toBeGreaterThanOrEqual(400);\n       |                               ^\n     86|     });\n     87|   });\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[98/99]⎯\n\n FAIL  tests/api/auth/google/callback/callback.test.ts > /api/auth/google/callback > Edge Cases > handles malformed JSON appropriately\nTypeError: POST is not a function\n ❯ tests/api/auth/google/callback/callback.test.ts:148:44\n    146|       }, authContext);\n    147| \n    148|       const response = await routeHandlers.POST(request);\n       |                                            ^\n    149|       expect(response).toBeDefined();\n    150|       expect(response.status).toBeGreaterThanOrEqual(400);\n\n⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[99/99]⎯\n\n",
      "startTime": 1757011087189,
      "endTime": 1757011116124,
      "duration": 28935,
      "error": "Process exited with code 1",
      "individualTests": {
        "total": 394,
        "passed": 295,
        "failed": 99,
        "skipped": 0,
        "passRate": 75,
        "progress": 90
      }
    },
    "linting": {
      "command": "npm run lint",
      "status": "pending",
      "output": "",
      "startTime": 1757011087189
    },
    "build": {
      "command": "npm run typecheck",
      "status": "pending",
      "output": "",
      "startTime": 1757011087189
    },
    "componentTestsAccessibility": {
      "command": "npm run test:ct:accessibility",
      "status": "failed",
      "output": "\n> herit@0.1.0 test:ct:accessibility\n> cypress run --component --config video=false,screenshotOnRunFailure=false --quiet --spec 'app/_lib/**/*.cy.tsx,app/components/auth/**/*.cy.tsx,app/components/ui/**/*.cy.tsx,app/components/layout/**/*.cy.tsx,app/components/branding/**/*.cy.tsx,app/components/pages/**/*.cy.tsx,app/components/examples/**/*.cy.tsx'\n\n16 assets\n970 modules\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m in 961 ms\n16 assets\n970 modules\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m in 75 ms\n\n\n  QueryProvider\n    Core Functionality\n      ✓ renders without crashing (53ms)\n      ✓ provides QueryClient context to children (31ms)\n    Error Handling\n      ✓ handles component errors gracefully (29ms)\n    Accessibility\n      ✓ provides accessible context (28ms)\n    Responsive Design\n      ✓ works at different screen sizes (30ms)\n    Integration\n      ✓ works within parent containers (28ms)\n\n\n  6 passing (232ms)\n\n17 assets\n969 modules\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m in 195 ms\n\n\n  Error Component\n    Core Functionality\n      ✓ renders error message and try again button (55ms)\n      (Attempt 1 of 3) calls reset callback when try again button is clicked\n      (Attempt 2 of 3) calls reset callback when try again button is clicked\n      1) calls reset callback when try again button is clicked\n      ✓ logs error to console on component mount (38ms)\n      ✓ handles different error types and messages (41ms)\n    Error States\n      ✓ handles missing error object gracefully (36ms)\n      (Attempt 1 of 3) handles missing reset callback gracefully\n      (Attempt 2 of 3) handles missing reset callback gracefully\n      2) handles missing reset callback gracefully\n      ✓ handles complex error objects (34ms)\n      (Attempt 1 of 3) handles multiple rapid error occurrences\n      (Attempt 2 of 3) handles multiple rapid error occurrences\n      3) handles multiple rapid error occurrences\n    Accessibility\n      (Attempt 1 of 3) should be accessible\n      (Attempt 2 of 3) should be accessible\n      4) should be accessible\n      (Attempt 1 of 3) supports keyboard navigation\n      (Attempt 2 of 3) supports keyboard navigation\n      5) supports keyboard navigation\n      (Attempt 1 of 3) has proper semantic structure\n      (Attempt 2 of 3) has proper semantic structure\n      6) has proper semantic structure\n      ✓ provides clear user guidance (35ms)\n    Performance\n      (Attempt 1 of 3) should render quickly\n      (Attempt 2 of 3) should render quickly\n      7) should render quickly\n      (Attempt 1 of 3) handles large error objects efficiently\n      (Attempt 2 of 3) handles large error objects efficiently\n      8) handles large error objects efficiently\n      (Attempt 1 of 3) handles rapid reset button clicks efficiently\n      (Attempt 2 of 3) handles rapid reset button clicks efficiently\n      9) handles rapid reset button clicks efficiently\n    Responsive Design\n      ✓ should work on all screen sizes (44ms)\n      ✓ maintains proper spacing on mobile (34ms)\n      ✓ handles long error messages on narrow screens (32ms)\n    Integration Scenarios\n      (Attempt 1 of 3) integrates with error boundary workflow\n      (Attempt 2 of 3) integrates with error boundary workflow\n      10) integrates with error boundary workflow\n      ✓ handles error reporting service integration (26ms)\n      (Attempt 1 of 3) works within Next.js app router context\n      (Attempt 2 of 3) works within Next.js app router context\n      11) works within Next.js app router context\n    Edge Cases\n      ✓ handles circular reference errors (31ms)\n      ✓ handles error objects without message (29ms)\n      ✓ handles non-Error objects passed as error (29ms)\n      ✓ handles rapid component remounting (39ms)\n    Security\n      (Attempt 1 of 3) safely handles malicious error messages\n      (Attempt 2 of 3) safely handles malicious error messages\n      12) safely handles malicious error messages\n      ✓ safely handles error properties with XSS attempts (30ms)\n      (Attempt 1 of 3) prevents reset callback injection attacks\n      (Attempt 2 of 3) prevents reset callback injection attacks\n      13) prevents reset callback injection attacks\n      (Attempt 1 of 3) handles error stack traces safely\n      (Attempt 2 of 3) handles error stack traces safely\n      14) handles error stack traces safely\n    Quality Checks\n      (Attempt 1 of 3) should meet performance standards\n      (Attempt 2 of 3) should meet performance standards\n      15) should meet performance standards\n      (Attempt 1 of 3) should be accessible\n      (Attempt 2 of 3) should be accessible\n      16) should be accessible\n      ✓ should handle responsive layouts (17ms)\n\n\n  16 passing (1m)\n  16 failing\n\n  1) Error Component\n       Core Functionality\n         calls reset callback when try again button is clicked:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n  From Your Spec Code:\n      at Object.proxyGetter [as get] (http://localhost:8080/__cypress/runner/cypress_runner.js:80426:22)\n      at exists (http://localhost:8080/__cypress/runner/cypress_runner.js:146470:26)\n      at elExists (http://localhost:8080/__cypress/runner/cypress_runner.js:146485:10)\n      at ensureExistence (http://localhost:8080/__cypress/runner/cypress_runner.js:146666:22)\n      at onFailFn (http://localhost:8080/__cypress/runner/cypress_runner.js:146695:53)\n\n  2) Error Component\n       Error States\n         handles missing reset callback gracefully:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n  3) Error Component\n       Error States\n         handles multiple rapid error occurrences:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n  4) Error Component\n       Accessibility\n         should be accessible:\n     CypressError: `cy.within()` can only be called on a single element. Your subject contained 2 elements. Narrow down your subject to a single element (using `.first()`, for example) before calling `.within()`.\n\nTo run `.within()` over multiple subjects, use `.each()`.\n\n  `cy.get('div').each($div => {`\n  `  cy.wrap($div).within(() => { ... })`\n  `})`\n\nhttps://on.cypress.io/within\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:135977:72)\n      at __WEBPACK_DEFAULT_EXPORT__ (http://localhost:8080/__cypress/runner/cypress_runner.js:133819:10)\n      at Context.within (http://localhost:8080/__cypress/runner/cypress_runner.js:135970:67)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n  From Your Spec Code:\n      at Object.proxyGetter [as get] (http://localhost:8080/__cypress/runner/cypress_runner.js:80426:22)\n      at exists (http://localhost:8080/__cypress/runner/cypress_runner.js:146470:26)\n      at elExists (http://localhost:8080/__cypress/runner/cypress_runner.js:146485:10)\n      at ensureExistence (http://localhost:8080/__cypress/runner/cypress_runner.js:146666:22)\n      at onFailFn (http://localhost:8080/__cypress/runner/cypress_runner.js:146695:53)\n\n  5) Error Component\n       Accessibility\n         supports keyboard navigation:\n     CypressError: `cy.focus()` can only be called on a single element. Your subject contained 2 elements.\n\nhttps://on.cypress.io/focus\n      at Context.focus (http://localhost:8080/__cypress/runner/cypress_runner.js:114705:70)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n  From Your Spec Code:\n      at Object.proxyGetter [as get] (http://localhost:8080/__cypress/runner/cypress_runner.js:80426:22)\n      at exists (http://localhost:8080/__cypress/runner/cypress_runner.js:146470:26)\n      at elExists (http://localhost:8080/__cypress/runner/cypress_runner.js:146485:10)\n      at ensureExistence (http://localhost:8080/__cypress/runner/cypress_runner.js:146666:22)\n      at onFailFn (http://localhost:8080/__cypress/runner/cypress_runner.js:146695:53)\n\n  6) Error Component\n       Accessibility\n         has proper semantic structure:\n\n      Timed out retrying after 4000ms\n      + expected - actual\n\n      -'DIV'\n      +'BUTTON'\n      \n      at Context.eval (webpack-internal:///./app/_lib/error.cy.tsx:344:46)\n\n  7) Error Component\n       Performance\n         should render quickly:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"button\"]`, but never found it.\n      at Object.measureRenderTime (webpack-internal:///./cypress/support/test-utils.ts:272:31)\n      at Context.eval (webpack-internal:///./app/_lib/error.cy.tsx:374:80)\n\n  8) Error Component\n       Performance\n         handles large error objects efficiently:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"button\"]`, but never found it.\n      at Object.measureRenderTime (webpack-internal:///./cypress/support/test-utils.ts:272:31)\n      at Context.eval (webpack-internal:///./app/_lib/error.cy.tsx:400:80)\n\n  9) Error Component\n       Performance\n         handles rapid reset button clicks efficiently:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n  10) Error Component\n       Integration Scenarios\n         integrates with error boundary workflow:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n  11) Error Component\n       Integration Scenarios\n         works within Next.js app router context:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n  12) Error Component\n       Security\n         safely handles malicious error messages:\n     AssertionError: Timed out retrying after 4000ms: Expected [ <script>, 3 more... ] not to exist in the DOM, but it was continuously found.\n      at Context.eval (webpack-internal:///./app/_lib/error.cy.tsx:835:30)\n\n  13) Error Component\n       Security\n         prevents reset callback injection attacks:\n     CypressError: `cy.click()` can only be called on a single element. Your subject contained 2 elements. Pass `{ multiple: true }` if you want to serially click each element.\n\nhttps://on.cypress.io/click\n      at mouseAction (http://localhost:8080/__cypress/runner/cypress_runner.js:113780:68)\n      at Context.click (http://localhost:8080/__cypress/runner/cypress_runner.js:113947:14)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n  14) Error Component\n       Security\n         handles error stack traces safely:\n     AssertionError: Timed out retrying after 4000ms: Expected [ <script>, 3 more... ] not to exist in the DOM, but it was continuously found.\n      at Context.eval (webpack-internal:///./app/_lib/error.cy.tsx:905:30)\n\n  15) Error Component\n       Quality Checks\n         should meet performance standards:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"button\"]`, but never found it.\n      at Object.measureRenderTime (webpack-internal:///./cypress/support/test-utils.ts:272:31)\n      at Context.eval (webpack-internal:///./app/_lib/error.cy.tsx:913:80)\n\n  16) Error Component\n       Quality Checks\n         should be accessible:\n     CypressError: `cy.within()` can only be called on a single element. Your subject contained 2 elements. Narrow down your subject to a single element (using `.first()`, for example) before calling `.within()`.\n\nTo run `.within()` over multiple subjects, use `.each()`.\n\n  `cy.get('div').each($div => {`\n  `  cy.wrap($div).within(() => { ... })`\n  `})`\n\nhttps://on.cypress.io/within\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:135977:72)\n      at __WEBPACK_DEFAULT_EXPORT__ (http://localhost:8080/__cypress/runner/cypress_runner.js:133819:10)\n      at Context.within (http://localhost:8080/__cypress/runner/cypress_runner.js:135970:67)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:147554:15)\n      at tryCatcher (http://localhost:8080/__cypress/runner/cypress_runner.js:1777:23)\n      at Promise._settlePromiseFromHandler (http://localhost:8080/__cypress/runner/cypress_runner.js:1489:31)\n      at Promise._settlePromise (http://localhost:8080/__cypress/runner/cypress_runner.js:1546:18)\n      at Promise._settlePromiseCtx (http://localhost:8080/__cypress/runner/cypress_runner.js:1583:10)\n      at _drainQueueStep (http://localhost:8080/__cypress/runner/cypress_runner.js:2381:12)\n      at _drainQueue (http://localhost:8080/__cypress/runner/cypress_runner.js:2370:9)\n      at Async._drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2386:5)\n      at Async.drainQueues (http://localhost:8080/__cypress/runner/cypress_runner.js:2256:14)\n\n\n\n16 assets\n968 modules\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m in 286 ms\n\n\n  providers\n    Core Functionality\n      (Attempt 1 of 3) renders without crashing\n      (Attempt 2 of 3) renders without crashing\n      1) renders without crashing\n      (Attempt 1 of 3) displays content correctly\n      (Attempt 2 of 3) displays content correctly\n      2) displays content correctly\n      (Attempt 1 of 3) handles props correctly\n      (Attempt 2 of 3) handles props correctly\n      3) handles props correctly\n    Accessibility\n      (Attempt 1 of 3) meets basic accessibility standards\n      (Attempt 2 of 3) meets basic accessibility standards\n      4) meets basic accessibility standards\n      (Attempt 1 of 3) supports keyboard navigation\n      (Attempt 2 of 3) supports keyboard navigation\n      5) supports keyboard navigation\n    Responsive Design\n      (Attempt 1 of 3) adapts to different screen sizes\n      (Attempt 2 of 3) adapts to different screen sizes\n      6) adapts to different screen sizes\n    Integration\n      (Attempt 1 of 3) works within parent containers\n      (Attempt 2 of 3) works within parent containers\n      7) works within parent containers\n\n\n  0 passing (1m)\n  7 failing\n\n  1) providers\n       Core Functionality\n         renders without crashing:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"providers\"], [data-testid=\"providers\"]`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:38:76)\n\n  2) providers\n       Core Functionality\n         displays content correctly:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"providers\"], [data-testid=\"providers\"]`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:58:76)\n\n  3) providers\n       Core Functionality\n         handles props correctly:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"providers\"], [data-testid=\"providers\"]`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:81:76)\n\n  4) providers\n       Accessibility\n         meets basic accessibility standards:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `button, input, [tabindex], [role=\"button\"]`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:104:16)\n\n  5) providers\n       Accessibility\n         supports keyboard navigation:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `focused`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:134:26)\n\n  6) providers\n       Responsive Design\n         adapts to different screen sizes:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"providers\"], [data-testid=\"providers\"]`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:164:76)\n\n  7) providers\n       Integration\n         works within parent containers:\n     AssertionError: Timed out retrying after 4000ms: Expected to find element: `[data-testid=\"providers\"], [data-testid=\"providers\"]`, but never found it.\n      at Context.eval (webpack-internal:///./app/_lib/providers.cy.tsx:203:80)\n      at withinFn (http://localhost:8080/__cypress/runner/cypress_runner.js:135903:8)\n      at <unknown> (http://localhost:8080/__cypress/runner/cypress_runner.js:135984:16)\n      at __WEBPACK_DEFAULT_EXPORT__ (http://localhost:8080/__cypress/runner/cypress_runner.js:133819:10)\n      at Context.within (http://localhost:8080/__cypress/runner/cypress_runner.js:135970:67)\n      at wrapped (http://localhost:8080/__cypress/runner/cypress_runner.js:141618:19)\n\n\n\n15 assets\n969 modules\n\n\u001b[1m\u001b[31mERROR\u001b[39m\u001b[22m in \u001b[1m./app/components/auth/AuthErrorHandler.cy.tsx\u001b[39m\u001b[22m\nModule build failed (from ./node_modules/.pnpm/next@15.4.6_@babel+core@7.28.3_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js):\nError:   \u001b[31mx\u001b[0m Expected '}', got '<eof>'\n     ,-[\u001b[36;1;4m/Users/dean/code/Herit/app/components/auth/AuthErrorHandler.cy.tsx\u001b[0m:131:1]\n \u001b[2m128\u001b[0m |       });\n \u001b[2m129\u001b[0m |     });\n \u001b[2m130\u001b[0m |   });\n \u001b[2m131\u001b[0m | });\n     : \u001b[35;1m ^\u001b[0m\n     `----\n  \u001b[31mx\u001b[0m Unexpected eof\n     ,-[\u001b[36;1;4m/Users/dean/code/Herit/app/components/auth/AuthErrorHandler.cy.tsx\u001b[0m:131:5]\n \u001b[2m129\u001b[0m |     });\n \u001b[2m130\u001b[0m |   });\n \u001b[2m131\u001b[0m | });\n     `----\n\n\nCaused by:\n    Syntax Error\n\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled with \u001b[1m\u001b[31m1 error\u001b[39m\u001b[22m in 285 ms\n\n\n  (Attempt 1 of 2) An uncaught error was detected outside of a test\n  1) An uncaught error was detected outside of a test\n\n  0 passing (21ms)\n  1 failing\n\n  1) An uncaught error was detected outside of a test:\n     Error: The following error originated from your test code, not from Cypress.\n\n  > Module build failed (from ./node_modules/.pnpm/next@15.4.6_@babel+core@7.28.3_react-dom@19.1.1_react@19.1.1__react@19.1.1/node_modules/next/dist/build/webpack/loaders/next-swc-loader.js):\nError:   x Expected '}', got '<eof>'\n     ,-[/Users/dean/code/Herit/app/components/auth/AuthErrorHandler.cy.tsx:131:1]\n 128 |       });\n 129 |     });\n 130 |   });\n 131 | });\n     :  ^\n     `----\n  x Unexpected eof\n     ,-[/Users/dean/code/Herit/app/components/auth/AuthErrorHandler.cy.tsx:131:5]\n 129 |     });\n 130 |   });\n 131 | });\n     `----\n\nCaused by:\n    Syntax Error\n\nWhen Cypress detects uncaught errors originating from your test code it will automatically fail the current test.\n\nCypress could not associate this error to any specific test.\n\nWe dynamically generated a new test to display this failure.\n      at ./app/components/auth/AuthErrorHandler.cy.tsx (http://localhost:8080/__cypress/src/spec-0.js:17:7)\n      at __webpack_require__ (http://localhost:8080/__cypress/src/webpack.js:25:43)\n      at __webpack_require__.t (http://localhost:8080/__cypress/src/webpack.js:97:38)\n\n\n\n18 assets\n1269 modules\n\u001b[1mclient\u001b[39m\u001b[22m (webpack 5.98.0) compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m in 678 ms\n\n\n  EmailLoginForm\n    Core Functionality\n      (Attempt 1 of 3) renders without crashing\n      (Attempt 2 of 3) renders without crashing\nwrite EPIPE\nError: write EPIPE\n    at afterWriteDispatched (node:internal/stream_base_commons:159:15)\n    at writeGeneric (node:internal/stream_base_commons:150:3)\n    at Socket._writeGeneric (node:net:971:11)\n    at Socket._write (node:net:983:8)\n    at writeOrBuffer (node:internal/streams/writable:572:12)\n    at _write (node:internal/streams/writable:501:10)\n    at Writable.write (node:internal/streams/writable:510:10)\n    at execSync (node:child_process:967:20)\n    at node:electron/js2c/node_init:2:17313\n    at <embedded>:1245:1069694\n    at process.processTicksAndRejections (node:internal/process/task_queues:85:11)\n[52998:0904/193807.667307:ERROR:electron/shell/common/node_bindings.cc:411] Most NODE_OPTIONs are not supported in packaged apps. See documentation for more details.\n[52998:0904/193807.667325:ERROR:electron/shell/common/node_bindings.cc:411] Most NODE_OPTIONs are not supported in packaged apps. See documentation for more details.\n\nDevTools listening on ws://127.0.0.1:58709/devtools/browser/949f0c44-ef69-40bd-b100-62e3f1871a34\n<<<CYPRESS.STDERR.START>>><i> [webpack-dev-server] Project is running at:\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-server] Loopback: \u001b[36mhttp://127.0.0.1:8080/\u001b[39m\n<i> [webpack-dev-server] Content not from webpack is served from '\u001b[36m/Users/dean/code/Herit/public\u001b[39m' directory\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-middleware] wait until bundle finished: /__cypress/src/index.html\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-middleware] wait until bundle finished: /__cypress/src/index.html\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-middleware] wait until bundle finished: /__cypress/src/index.html\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-middleware] wait until bundle finished: /__cypress/src/webpack.js\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-middleware] wait until bundle finished: /__cypress/src/main.js\n<<<CYPRESS.STDERR.END>>><<<CYPRESS.STDERR.START>>><i> [webpack-dev-middleware] wait until bundle finished: /__cypress/src/index.html\n<<<CYPRESS.STDERR.END>>>",
      "startTime": 1757011087190,
      "endTime": 1757011267660,
      "duration": 180470,
      "error": "Process was terminated (SIGTERM) due to timeout",
      "individualTests": {
        "total": 6,
        "passed": 6,
        "failed": 0,
        "skipped": 0,
        "passRate": 100,
        "progress": 100
      }
    },
    "componentTestsCore": {
      "command": "npm run test:ct:core",
      "status": "failed",
      "output": "\n> herit@0.1.0 test:ct:core\n> cypress run --component --config video=false,screenshotOnRunFailure=false --quiet --spec 'app/components/beneficiaries/**/*.cy.tsx,app/components/documents/**/*.cy.tsx,app/components/shared/**/*.cy.tsx,app/components/dashboard/**/*.cy.tsx,app/(dashboard)/**/*.cy.tsx,app/(auth)/**/*.cy.tsx,components/**/*.cy.tsx'\n\nYour configFile threw an error from: cypress.config.js\n\nWe stopped running your tests because your config file crashed.\n\nError: listen EADDRINUSE: address already in use 127.0.0.1:8080\n    at Server.setupListenHandle [as _listen2] (node:net:1937:16)\n    at listenInCluster (node:net:1994:12)\n    at node:net:2203:7\n    at process.processTicksAndRejections (node:internal/process/task_queues:90:21)\n[52999:0904/193807.686083:ERROR:electron/shell/common/node_bindings.cc:411] Most NODE_OPTIONs are not supported in packaged apps. See documentation for more details.\n[52999:0904/193807.686098:ERROR:electron/shell/common/node_bindings.cc:411] Most NODE_OPTIONs are not supported in packaged apps. See documentation for more details.\n\nDevTools listening on ws://127.0.0.1:58710/devtools/browser/14ec9edc-b0ab-48b5-9974-7fc73e490679\n",
      "startTime": 1757011087190,
      "endTime": 1757011090235,
      "duration": 3045,
      "error": "Process exited with code 1",
      "individualTests": {
        "total": 1,
        "passed": 0,
        "failed": 1,
        "skipped": 0,
        "passRate": 0,
        "progress": 25
      }
    }
  }
}